import{r as J,g as V}from"./phaser-xmrzIA0s.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var ee=J();const m=V(ee),te="/assets";function a(w){const e=w.startsWith("/")?w:`/${w}`,t=`${te}${e}`;return console.log("Asset path requested:",{original:w,normalized:e,full:t}),t}class Ce extends m.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),this.sprite=e.add.sprite(0,0,i),this.add(this.sprite),e.physics.world.enable(this),this.body.setCollideWorldBounds(!0),this.stats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.powerUpBitmask=0,this.powerUpTypes={LIFE:1,CRAFT:2,SPEED:4,BULLETS:8},this.init()}init(){this.sprite.setScale(this.stats.craftSize),this.body.setSize(this.sprite.width*this.stats.craftSize,this.sprite.height*this.stats.craftSize),this.body.setOffset(-this.sprite.width*this.stats.craftSize/2,-this.sprite.height*this.stats.craftSize/2)}update(e,t,s){if(!this.active)return;const i=this.stats.speed*s/1e3;(e.left.isDown||t.left.isDown)&&this.x>40&&(this.x-=i),(e.right.isDown||t.right.isDown)&&this.x<760&&(this.x+=i),(e.up.isDown||t.up.isDown)&&this.y>40&&(this.y-=i),(e.down.isDown||t.down.isDown)&&this.y<560&&(this.y+=i),this.body.setPosition(this.x,this.y)}addPowerUp(e){this.powerUpBitmask|=e,this.updateStats()}updateStats(){this.stats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.powerUpBitmask&this.powerUpTypes.LIFE&&(this.stats.life+=2),this.powerUpBitmask&this.powerUpTypes.CRAFT&&(this.stats.craftSize=1.2,this.sprite.setScale(this.stats.craftSize),this.body.setSize(this.sprite.width*this.stats.craftSize,this.sprite.height*this.stats.craftSize)),this.powerUpBitmask&this.powerUpTypes.SPEED&&(this.stats.speed+=100),this.powerUpBitmask&this.powerUpTypes.BULLETS&&(this.stats.bulletSpeed+=200,this.stats.fireRate+=2)}takeDamage(){return this.stats.life--,this.scene.tweens.add({targets:this.sprite,alpha:0,duration:100,yoyo:!0,repeat:2}),this.stats.life<=0}getStats(){return{...this.stats}}getPowerUpBitmask(){return this.powerUpBitmask}setPowerUpBitmask(e){this.powerUpBitmask=e,this.updateStats()}reset(){this.powerUpBitmask=0,this.updateStats(),this.sprite.setAlpha(1),this.setActive(!0)}}class Ie extends m.GameObjects.Container{constructor(e,t,s,i,o){super(e,t,s),e.add.existing(this),this.config=o,this.isInteractive=!0,this.sprite=e.add.sprite(0,0,i),this.add(this.sprite),this.box=e.add.rectangle(0,0,this.sprite.width+20,this.sprite.height+20,3355443,.8),this.add(this.box),this.sendToBack(this.box),this.border=e.add.rectangle(0,0,this.sprite.width+20,this.sprite.height+20,65280,0),this.border.setStrokeStyle(2,65280),this.add(this.border),this.sendToBack(this.border),this.setSize(this.sprite.width+20,this.sprite.height+20),this.setInteractive(),this.on("pointerover",this.onHover.bind(this)),this.on("pointerout",this.onHoverOut.bind(this)),this.on("pointerdown",this.onClick.bind(this)),this.isAnswered=!1,this.isCorrect=!1}onHover(){this.isInteractive&&(this.scene.tweens.add({targets:[this.sprite,this.box,this.border],scaleX:1.1,scaleY:1.1,duration:100}),this.config.tooltip&&this.showTooltip())}onHoverOut(){this.isInteractive&&(this.scene.tweens.add({targets:[this.sprite,this.box,this.border],scaleX:1,scaleY:1,duration:100}),this.hideTooltip())}onClick(){this.isInteractive&&this.emit("iconclick",{id:this.config.id,category:this.config.category,questionType:this.config.questionType})}showTooltip(){if(this.tooltip)return;this.tooltip=this.scene.add.container(0,-60);const e=this.scene.add.rectangle(0,0,200,40,0,.8),t=this.scene.add.text(0,0,this.config.tooltip,{fontSize:"16px",fill:"#ffffff"}).setOrigin(.5);this.tooltip.add([e,t]),this.add(this.tooltip),this.scene.tweens.add({targets:this.tooltip,alpha:{from:0,to:1},duration:200})}hideTooltip(){this.tooltip&&this.scene.tweens.add({targets:this.tooltip,alpha:0,duration:200,onComplete:()=>{this.tooltip.destroy(),this.tooltip=null}})}setAnswered(e){this.isAnswered=!0,this.isCorrect=e,this.isInteractive=!1;const t=e?65280:16711680;this.border.setStrokeStyle(2,t),e?this.showCorrectAnimation():this.showIncorrectAnimation()}showCorrectAnimation(){const e=this.scene.add.particles(this.x,this.y,"particle",{speed:{min:-100,max:100},angle:{min:0,max:360},scale:{start:1,end:0},blendMode:"ADD",lifespan:1e3,gravityY:0,quantity:20,tint:65280});this.scene.time.delayedCall(1e3,()=>{e.destroy()})}showIncorrectAnimation(){this.scene.tweens.add({targets:[this.sprite,this.box],alpha:.5,duration:100,yoyo:!0,repeat:3})}reset(){this.isAnswered=!1,this.isCorrect=!1,this.isInteractive=!0,this.border.setStrokeStyle(2,65280),this.setAlpha(1),this.setScale(1),this.tooltip&&this.hideTooltip()}destroy(){this.tooltip&&this.tooltip.destroy(),super.destroy()}}class be extends m.GameObjects.Rectangle{constructor(e,t=800,s=m.Math.Between(0,100)){super(e,t,s,98,32,16777215),e.add.existing(this);const i=1/m.Math.Between(1,3);this.setScale(i),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:800,to:-100},duration:2e3/this.scale,onComplete:()=>{this.destroy()}})}}class Be extends m.GameObjects.Rectangle{constructor(e,t=800,s=m.Math.Between(32,368)){super(e,t,s,32,32,16711680),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1);const i=1/m.Math.Between(1,3);this.setScale(i),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:820,to:-100},duration:2e3,onComplete:()=>{this.destroy()}}),this.body.setVelocityX(-200)}handleCollision(e,t){this.scene.gameOver()}}class Ee extends m.GameObjects.Sprite{constructor(e,t=800,s=m.Math.Between(32,368)){super(e,t,s,"coin"),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1);const i=1/m.Math.Between(1,3);this.setScale(i),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:820,to:-100},duration:2e3,onComplete:()=>{this.destroy()}}),this.scene.anims.create({key:"coin_anim",frames:this.scene.anims.generateFrameNumbers("coin",{start:0,end:7}),frameRate:8,repeat:-1}),this.play({key:"coin_anim",repeat:-1})}collectCoin(e,t){this.scene.score+=50,this.scene.updateScore(),this.scene.playSound("coinCollect"),e.destroy()}}class Pe extends m.GameObjects.Rectangle{constructor(e,t=800,s=m.Math.Between(100,500)){super(e,t,s,32,32,65280),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1),this.setInteractive(),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:1024,to:-100},duration:2e3,onComplete:()=>{this.destroy()}}),this.setInteractive(),this.on("pointerdown",()=>{console.log("Button Clicked"),this.scene.togglePause()})}}class S{constructor(){this.progress={score:0,powerUpBitmask:0,currentMap:1,lastCompletedScene:null,powerUpStats:{life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2}},this.loadProgress()}loadProgress(){try{const e=localStorage.getItem("gameProgress");if(e){const t=JSON.parse(e);this.progress={...this.progress,...t}}return this.progress}catch(e){return console.error("Error loading progress:",e),this.progress}}saveProgress(e={}){try{return this.progress={...this.progress,...e},this.updatePowerUpStats(),localStorage.setItem("gameProgress",JSON.stringify(this.progress)),!0}catch(t){return console.error("Error saving progress:",t),!1}}updatePowerUpStats(){this.progress.powerUpStats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.progress.powerUpBitmask&1&&(this.progress.powerUpStats.life+=2),this.progress.powerUpBitmask&2&&(this.progress.powerUpStats.craftSize=1.2),this.progress.powerUpBitmask&4&&(this.progress.powerUpStats.speed+=100),this.progress.powerUpBitmask&8&&(this.progress.powerUpStats.bulletSpeed+=200,this.progress.powerUpStats.fireRate+=2)}getPowerUpStats(){return this.progress.powerUpStats}updateScore(e){return this.progress.score+=e,this.saveProgress(),this.progress.score}setCurrentMap(e){this.progress.currentMap=e,this.saveProgress()}getCurrentMap(){return this.progress.currentMap}setLastCompletedScene(e){this.progress.lastCompletedScene=e,this.saveProgress()}getLastCompletedScene(){return this.progress.lastCompletedScene}addPowerUp(e){this.progress.powerUpBitmask|=e,this.updatePowerUpStats(),this.saveProgress()}hasPowerUp(e){return(this.progress.powerUpBitmask&e)!==0}resetProgress(){this.progress={score:0,powerUpBitmask:0,currentMap:1,lastCompletedScene:null,powerUpStats:{life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2}},this.saveProgress()}getProgress(){return{...this.progress}}}const H=new S;class se extends m.Scene{constructor(){super({key:"bootscene"}),this.nextScene=null,this.nextSceneData=null}init(e){this.nextScene=e.nextScene||"mainmenu",this.nextSceneData=e.nextSceneData||{}}preload(){const e=this.cameras.main.width,t=this.cameras.main.height,s=this.add.graphics(),i=this.add.graphics();i.fillStyle(2236962,.8),i.fillRect(e/4,t/2-30,e/2,50);const o=this.add.text(e/2,t/2-50,"Loading...",{font:"20px monospace",fill:"#ffffff"}).setOrigin(.5,.5),n=this.add.text(e/2,t/2+70,"0%",{font:"18px monospace",fill:"#ffffff"}).setOrigin(.5,.5);this.load.on("progress",c=>{s.clear(),s.fillStyle(65280,1),s.fillRect(e/4+10,t/2-20,(e/2-20)*c,30),n.setText(parseInt(c*100)+"%")}),this.load.on("complete",()=>{s.destroy(),i.destroy(),o.destroy(),n.destroy()}),this.load.on("loaderror",c=>{console.warn("Error loading file:",c.key,c.src),this.handleAssetError(c)}),this.loadEssentialAssets()}handleAssetError(e){switch(e.type){case"image":this.createFallbackImage(e.key);break;case"audio":this.createSilentAudio(e.key);break;case"json":this.createFallbackJSON(e.key);break}}createFallbackImage(e){const t=this.add.graphics();if(e.includes("correct_icon"))t.fillStyle(65280),t.fillCircle(0,0,20);else if(e.includes("wrong_icon"))t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10);else if(e.includes("aws_")){t.fillStyle(16750848),t.fillRect(0,0,48,48),t.lineStyle(2,2305854),t.strokeRect(0,0,48,48);const s=this.add.text(24,24,"AWS",{font:"12px Arial",fill:"#232F3E"}).setOrigin(.5);t.generateTexture(e,48,48),s.destroy()}else t.fillStyle(6710886),t.fillRect(0,0,64,64),t.lineStyle(2,16777215),t.strokeRect(0,0,64,64);t.generateTexture(e,64,64),t.destroy()}createSilentAudio(e){const t=this.game.sound.context;if(t){const s=t.createBuffer(2,44100,44100);this.cache.audio.add(e,s),console.log(`Created silent audio fallback for: ${e}`)}}createFallbackJSON(e){e==="questions"&&this.cache.json.add(e,{questions:[{question:"Placeholder question",correct_answer:"Correct",incorrect_answers:["Wrong 1","Wrong 2","Wrong 3"]}]})}loadEssentialAssets(){try{["background","logo","correct_icon","wrong_icon"].forEach(s=>{this.load.image(s,a(`images/${s}.png`))}),["Buzzer","click","correct","wrong","fail","satellite_destroy","laser","theme","dead","jump"].forEach(s=>{this.load.audio(s,[a(`sounds/${s}.mp3`),a(`sounds/${s}.ogg`)])}),this.load.json("questions",a("data/questions.json")),this.load.bitmapFont("arcade",a("fonts/arcade.png"),a("fonts/arcade.xml"))}catch(e){console.error("Error in loadEssentialAssets:",e)}}create(){if(this.add.rectangle(400,300,800,600,0),this.load.isReady())this.add.text(400,300,"Loading Complete!",{font:"32px monospace",fill:"#ffffff"}).setOrigin(.5,.5),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start(this.nextScene||"mainmenu",this.nextSceneData)})});else{const e=this.add.text(400,300,"Still Loading...",{font:"32px monospace",fill:"#ffffff"}).setOrigin(.5,.5);this.load.once("complete",()=>{e.setText("Loading Complete!"),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start(this.nextScene||"mainmenu",this.nextSceneData)})})})}}}class ie extends m.Scene{constructor(){super({key:"gameover"})}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1}create(){this.add.rectangle(400,300,800,600,0,.9),this.add.text(400,150,"GAME OVER",{fontSize:"64px",fill:"#ff0000",fontStyle:"bold"}).setOrigin(.5),this.add.text(400,250,`Final Score: ${this.score}`,{fontSize:"32px",fill:"#ffffff"}).setOrigin(.5);const e=[];this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),this.add.text(400,300,`Power-ups: ${e.join(" ")}`,{fontSize:"24px",fill:"#00ff00"}).setOrigin(.5);const t=this.add.container(400,400),s=this.add.rectangle(0,0,200,50,65280).setInteractive(),i=this.add.text(0,0,"Try Again",{fontSize:"24px",fill:"#000000"}).setOrigin(.5),o=this.add.rectangle(0,70,200,50,6710886).setInteractive(),n=this.add.text(0,70,"Main Menu",{fontSize:"24px",fill:"#ffffff"}).setOrigin(.5);s.on("pointerover",()=>{s.setFillStyle(52224),i.setScale(1.1)}),s.on("pointerout",()=>{s.setFillStyle(65280),i.setScale(1)}),o.on("pointerover",()=>{o.setFillStyle(8947848),n.setScale(1.1)}),o.on("pointerout",()=>{o.setFillStyle(6710886),n.setScale(1)}),s.on("pointerdown",()=>{this.sound.play("button_click"),this.retryGame()}),o.on("pointerdown",()=>{this.sound.play("button_click"),this.returnToMenu()}),t.add([s,i,o,n]);const c=this.getHighScore();this.score>c?(this.setHighScore(this.score),this.add.text(400,500,"New High Score!",{fontSize:"32px",fill:"#ffff00"}).setOrigin(.5)):c>0&&this.add.text(400,500,`High Score: ${c}`,{fontSize:"24px",fill:"#ffffff"}).setOrigin(.5)}retryGame(){H.resetProgress(),this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start("sort_selection",{score:0,powerUpBitmask:0,currentMap:1})})}returnToMenu(){H.resetProgress(),this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start("mainmenu")})}getHighScore(){try{const e=localStorage.getItem("highScore");return e?parseInt(e):0}catch(e){return console.error("Error getting high score:",e),0}}setHighScore(e){try{localStorage.setItem("highScore",e.toString())}catch(t){console.error("Error setting high score:",t)}}}const b={IDLE:"idle",TRANSITIONING:"transitioning",FADING:"fading",ERROR:"error"};class v{constructor(){this.state=b.IDLE,this.currentScene=null,this.nextScene=null,this.transitionData=null,this.progressManager=new S,this.transitionHistory=[]}setCurrentScene(e){this.currentScene=e,this.state=b.IDLE}getState(){return this.state}getTransitionHistory(){return this.transitionHistory}fadeIn(e,t=500){if(!e||!e.cameras){console.error("Invalid scene for fadeIn");return}this.state=b.FADING,e.cameras.main.fadeIn(t),e.cameras.main.once("camerafadeincomplete",()=>{this.state=b.IDLE})}fadeOut(e,t,s=500){if(!e||!e.cameras){console.error("Invalid scene for fadeOut");return}this.state=b.FADING,e.cameras.main.fadeOut(s),e.cameras.main.once("camerafadeoutcomplete",()=>{t&&t(),this.state=b.TRANSITIONING})}getNextSceneInSequence(e){const t=["map1scene1","space_invaders","map1scene2","space_invaders","map1scene3","space_invaders","map1scene4","space_invaders","map2scene1","space_invaders","map2scene2","space_invaders","map2scene3","space_invaders","map2scene4","space_invaders","map3scene1","space_invaders","map3scene2","space_invaders","map3scene3","space_invaders","map3scene4","space_invaders","map4scene1","space_invaders","map4scene2","space_invaders","map4scene3","space_invaders","map4scene4","space_invaders","gameover"],s=t.indexOf(e);return s!==-1&&s<t.length-1?t[s+1]:null}getNextTransition(e,t){var i;if(e==="bootscene")return"mainmenu";if(e==="mainmenu")return t==="sort_selection"?"sort_selection":t==="space_invaders"?"space_invaders":"map1scene1";if(e==="sort_selection"||e==="gameover")return"mainmenu";if(e==="space_invaders"){const o=t||((i=this.transitionData)==null?void 0:i.nextScene);return o||"mainmenu"}const s=this.getNextSceneInSequence(e);return s||(console.error("Invalid scene transition:",{fromScene:e,toScene:t}),"mainmenu")}to(e,t,s={}){if(this.state===b.TRANSITIONING){console.warn("Scene transition already in progress");return}if(!e||!e.scene||!t){console.error("Invalid scene parameters"),this.state=b.ERROR;return}this.state=b.TRANSITIONING,this.nextScene=t,this.transitionData=s,this.progressManager.saveProgress({lastCompletedScene:e.scene.key,score:s.score||0,powerUpBitmask:s.powerUpBitmask||0,currentMap:s.currentMap||1}),this.transitionHistory.push({from:e.scene.key,to:t,timestamp:Date.now(),data:{...s}}),e.events.emit("sceneCleanup"),e.events.emit("sceneEnd"),this.fadeOut(e,()=>{e.scene.start(t,{...s,fromScene:e.scene.key}),this.setCurrentScene(t)})}toSpaceInvaders(e,t,s={}){if(this.state===b.TRANSITIONING){console.warn("Scene transition already in progress");return}const i=this.progressManager.loadProgress(),o={score:s.score||i.score||0,powerUpBitmask:s.powerUpBitmask||i.powerUpBitmask||0,nextScene:t,fromScene:e.scene.key,currentMap:s.currentMap||i.currentMap||1};e.events.emit("scenePause"),this.to(e,"space_invaders",o)}fromSpaceInvaders(e,t={}){const s=t.nextScene;if(!s){console.error("No next scene specified for space invaders transition"),this.state=b.ERROR;return}const i={score:t.score||0,powerUpBitmask:t.powerUpBitmask||0,currentMap:t.currentMap||1,fromScene:"space_invaders"};s==="gameover"?this.toGameOver(e,i):this.to(e,s,i)}toMainMenu(e,t={}){e.events.emit("sceneCleanup"),this.to(e,"mainmenu",t)}toGameOver(e,t={}){const s=this.progressManager.loadProgress(),i={score:t.score||s.score||0,powerUpBitmask:t.powerUpBitmask||s.powerUpBitmask||0,currentMap:t.currentMap||s.currentMap||1,fromScene:e.scene.key};e.events.emit("sceneCleanup"),this.to(e,"gameover",i)}reset(){this.state=b.IDLE,this.nextScene=null,this.transitionData=null}}class oe extends m.Scene{constructor(){super({key:"mainmenu"}),this.menuButtons=[],this.isTransitioning=!1,console.log("MainMenu: Constructor called")}init(e){var t,s;console.log("MainMenu: Init called"),this.progressManager=((t=window.gameManager)==null?void 0:t.progressManager)||new S,this.sceneTransition=((s=window.gameManager)==null?void 0:s.sceneTransition)||new v(this.scene),this.menuButtons=[],this.isTransitioning=!1}preload(){console.log("MainMenu: Preload started"),this.load.image("logo",a("images/logo.png")),this.load.image("background",a("images/background.png"))}create(){console.log("MainMenu: Create started"),this.add.image(400,300,"background").setDisplaySize(800,600),this.add.image(400,150,"logo").setScale(.5),this.createButtons(),console.log("MainMenu: Create completed")}createButtons(){var t;[{text:"New Game",y:277,callback:()=>this.startNewGame()},{text:"Continue",y:347,callback:()=>this.continueGame()},{text:"Sort Selection",y:417,callback:()=>this.startSortSelection()},{text:"Space Invaders",y:487,callback:()=>this.startSpaceInvaders()}].forEach(({text:s,y:i,callback:o})=>{const n=this.add.rectangle(400,i,200,40,3355443).setInteractive({useHandCursor:!0});n.on("pointerover",()=>{n.setFillStyle(6710886)}),n.on("pointerout",()=>{n.setFillStyle(3355443)}),n.on("pointerdown",o),this.add.text(400,i,s,{fontSize:"24px",fill:"#fff",backgroundColor:null}).setOrigin(.5),this.menuButtons.push(n)}),(t=this.progressManager.loadProgress())!=null&&t.lastCompletedScene||this.menuButtons[1].setAlpha(.5).disableInteractive()}startNewGame(){this.isTransitioning||(this.isTransitioning=!0,console.log("Starting new game..."),this.scene.start("trivia_master",{mapNumber:1,sceneNumber:1,isNewGame:!0,score:0,powerUpBitmask:0,currentMap:1}))}continueGame(){if(this.isTransitioning)return;this.isTransitioning=!0,console.log("Continuing game...");const e=this.progressManager.loadProgress();if(e!=null&&e.lastCompletedScene){const t=e.lastCompletedScene.match(/map(\d+)scene(\d+)/);if(t){const[s,i,o]=t;console.log("Continuing from:",{mapNumber:i,sceneNumber:o,savedData:e}),this.scene.start("trivia_master",{mapNumber:parseInt(i),sceneNumber:parseInt(o),score:e.score,powerUpBitmask:e.powerUpBitmask,currentMap:e.currentMap})}else{console.warn("Invalid save format, attempting fallback to continue game");const s=e.currentMap||1,i=1;console.log("Continuing (fallback) from map:",s,"scene:",i),this.scene.start("trivia_master",{mapNumber:parseInt(s),sceneNumber:i,score:e.score,powerUpBitmask:e.powerUpBitmask,currentMap:parseInt(s)})}}else console.warn("No save data found, starting new game"),this.startNewGame()}startSortSelection(){this.isTransitioning||(this.isTransitioning=!0,this.sceneTransition.to(this,"sort_selection",{fromMainMenu:!0}))}startSpaceInvaders(){this.isTransitioning||(this.isTransitioning=!0,this.sceneTransition.to(this,"space_invaders",{fromMainMenu:!0}))}shutdown(){this.isTransitioning=!1,this.menuButtons.forEach(e=>e.destroy()),this.menuButtons=[]}}class Q{constructor(){this.progressManager=new S,this.POWERUP_TYPES={LIFE:1,SHIELD:2,SPEED:4,FIRE:8,BULLET_SPEED:16,CRAFT_SIZE:32,POWER_UP_COLLECT:64,BONUS_POINTS:128},this.BASE_STATS={health:3,shield:0,speed:200,fireRate:2,bulletSpeed:400,craftSize:1,powerUpCollectRadius:50,pointsMultiplier:1},this.powerUpBitmask=this.loadPowerUps(),this.tempPowerUps={fireRate:0,speed:0,shield:0,bulletSpeed:0},this.sceneCorrectAnswers=0}loadPowerUps(){const e=localStorage.getItem("powerUpState");return e?parseInt(e,10):0}savePowerUps(){localStorage.setItem("powerUpState",this.powerUpBitmask.toString()),this.progressManager.saveProgress({powerUpBitmask:this.powerUpBitmask})}applyUpgrade(e){return this.powerUpBitmask|=e,this.savePowerUps(),this.getUpgradedStats()}removeUpgrade(e){return this.powerUpBitmask&=~e,this.savePowerUps(),this.getUpgradedStats()}hasUpgrade(e){return(this.powerUpBitmask&e)!==0}getFireRate(){const e=this.BASE_STATS.fireRate,t=this.hasUpgrade(this.POWERUP_TYPES.FIRE)?e*.5:0,s=this.tempPowerUps.fireRate*.2*e;return e+t+s}handleCorrectAnswer(){if(this.sceneCorrectAnswers++,console.log("Correct answers this scene:",this.sceneCorrectAnswers),this.sceneCorrectAnswers>=5){console.log("All questions correct! Applying permanent upgrade"),this.sceneCorrectAnswers=0;const e=this.applyRandomPermanentUpgrade();if(e)return console.log("Applied upgrade:",e),this.savePowerUps(),e}return null}applyRandomPermanentUpgrade(){const e=Object.entries(this.POWERUP_TYPES).filter(([t,s])=>!this.hasUpgrade(s)).map(([t,s])=>({name:t,type:s}));if(e.length>0){const t=e[Math.floor(Math.random()*e.length)];return console.log("Applying upgrade:",t.name),this.powerUpBitmask|=t.type,this.savePowerUps(),t.name}return null}updatePowerUpStats(){console.log("Updating power-up stats, current bitmask:",this.powerUpBitmask.toString(2));const e={...this.BASE_STATS};return this.powerUpBitmask&this.POWERUP_TYPES.LIFE&&(e.health+=2,console.log("Applied LIFE upgrade")),this.powerUpBitmask&this.POWERUP_TYPES.SHIELD&&(e.shield+=1,console.log("Applied SHIELD upgrade")),this.powerUpBitmask&this.POWERUP_TYPES.SPEED&&(e.speed+=100,console.log("Applied SPEED upgrade")),this.powerUpBitmask&this.POWERUP_TYPES.FIRE&&(e.fireRate+=2,console.log("Applied FIRE upgrade")),this.progressManager.progress.powerUpStats=e,this.savePowerUps(),e}getUpgradedStats(){this.updatePowerUpStats();const e={...this.progressManager.progress.powerUpStats};return e.fireRate+=this.tempPowerUps.fireRate*.2*this.BASE_STATS.fireRate,e.speed+=this.tempPowerUps.speed*50,e.shield+=this.tempPowerUps.shield,e.bulletSpeed+=this.tempPowerUps.bulletSpeed*100,e}getPowerUpText(){const e=[];return Object.entries(this.POWERUP_TYPES).forEach(([t,s])=>{this.hasUpgrade(s)&&e.push(`${t}+`)}),e.join(" ")}reset(){return this.powerUpBitmask=0,this.savePowerUps(),this.getUpgradedStats()}resetSceneProgress(){this.sceneCorrectAnswers=0,this.tempPowerUps={fireRate:0,speed:0,shield:0,bulletSpeed:0}}addTemporaryPowerUp(e,t){return this.tempPowerUps.hasOwnProperty(e)?(this.tempPowerUps[e]++,!0):!1}removeTemporaryPowerUp(e){return this.tempPowerUps.hasOwnProperty(e)&&this.tempPowerUps[e]>0?(this.tempPowerUps[e]--,!0):!1}}class ne extends m.Scene{constructor(){super({key:"space_invaders"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.powerUpBitmask=0,this.progressManager=null,this.sceneTransition=null,this.bullets=[],this.asteroids=[],this.satellites=[],this.powerUps=[],this.starSprites=[],this.stars=[],this.nextScene=null,this.fromScene=null,this.isPractice=!1,this.baseHealth=3,this.health=0,this.isGameOver=!1,this.lastAsteroidSpawn=0,this.asteroidSpawnDelay=2e3,this.minAsteroidSpawnDelay=800,this.asteroidSpeedMultiplier=1,this.tempBonuses={shield:0,speed:0,fireRate:0},this.powerUpManager=new Q;const e=200,t=2,s=400;this.upgrades={health:3,shield:this.powerUpBitmask&2?1:0,speed:e+(this.powerUpBitmask&4?e*.25:0),fireRate:t+(this.powerUpBitmask&8?t*.5:0),bulletSpeed:s+(this.powerUpBitmask&8?s*.25:0),craftSize:this.powerUpBitmask&2?.8:1};for(let i=0;i<100;i++)this.stars.push({x:m.Math.Between(0,800),y:m.Math.Between(0,600),speed:m.Math.Between(50,150),char:[".","*","+","·","°"][m.Math.Between(0,4)]})}init(e){this.progressManager=window.progressManager,this.sceneTransition=window.sceneTransition,this.powerUpManager=new Q;const t=this.powerUpManager.getUpgradedStats();this.score=(e==null?void 0:e.score)||0,this.baseHealth=t.health,this.health=this.baseHealth,this.upgrades=t,this.asteroidSpeedMultiplier=1,this.lastAsteroidSpawn=0,this.asteroidSpawnDelay=2e3,this.nextScene=(e==null?void 0:e.nextScene)||"mainmenu",this.fromScene=e==null?void 0:e.fromScene,this.fromMainMenu=this.fromScene==="mainmenu",this.powerUpManager.resetSceneProgress(),this.resetGame(),this.cameras.main.fadeIn(500)}resetGame(){this.player={x:this.width/2,y:this.height-80,width:60,height:40,lives:this.upgrades.health,shield:this.upgrades.shield,score:0,speed:300,fireRate:this.upgrades.fireRate,bulletSpeed:this.upgrades.bulletSpeed,multiShot:this.upgrades.multiShot},this.bullets=[],this.asteroids=[],this.satellites=[],this.powerUps=[],this.score=0,this.scoreText=null,this.powerUpText=null,this.isGameOver=!1,this.powerUpTypes={LIFE:1,CRAFT:2,SPEED:4,BULLETS:8},this.powerUpStats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.sceneTransition=new v}preload(){this.load.audio("shoot",a("sounds/laser.mp3")),this.load.audio("explosion",a("sounds/dead.mp3")),this.load.audio("powerup",a("sounds/jump.mp3")),this.load.audio("satellite_destroy",a("sounds/satellite_destroy.mp3")),this.load.audio("buzzer",a("sounds/boowomp.mp3"))}create(){this.gameStarted=!1,this.stars.forEach(s=>{const i=this.add.text(s.x,s.y,s.char,{fontFamily:"Courier",fontSize:s.char==="*"?"16px":"12px",fill:"#ffffff"}).setAlpha(.5);i.speed=s.speed,this.starSprites.push(i)});const e=["^","/|\\","<=+=>","\\|/"];this.player=this.add.container(400,500),e.forEach((s,i)=>{const o=this.add.text(0,i*14,s,{fontFamily:"Courier",fontSize:"16px",fill:"#ffffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.player.add(o)}),this.updateShieldVisuals(),this.player.setScale(this.upgrades.craftSize),this.cursors=this.input.keyboard.createCursorKeys(),this.wasdKeys={left:this.input.keyboard.addKey(m.Input.Keyboard.KeyCodes.A),right:this.input.keyboard.addKey(m.Input.Keyboard.KeyCodes.D)},this.spaceKey=this.input.keyboard.addKey(m.Input.Keyboard.KeyCodes.SPACE),this.lastShot=0,this.createHUD(),this.time.delayedCall(500,()=>{this.gameStarted=!0,this.startGameLoop()}),this.cameras.main.fadeIn(500),this.powerUpManager=this.scene.get("PowerUpManager"),this.tempPowerUps={shield:0,speed:0,fireRate:0,bulletSpeed:0};const t=this.powerUpManager.getUpgradedStats();t.shield>0&&(this.tempPowerUps.shield=t.shield,this.updateShieldDisplay())}createHUD(){this.add.rectangle(400,40,780,60,0,.5).setDepth(100),this.scoreText=this.add.text(16,16,`Score: ${this.score}`,{fontSize:"32px",fill:"#fff",fontFamily:"Courier"}).setDepth(101),this.powerUpText=this.add.text(16,56,`Power-ups: ${this.getPowerUpText()}`,{fontSize:"24px",fill:"#00ff00",fontFamily:"Courier"}).setDepth(101),this.healthText=this.add.text(16,96,`Health: ${this.health}`,{fontSize:"24px",fill:"#ff0000",fontFamily:"Courier"}).setDepth(101),this.upgrades.shield>0&&(this.shieldText=this.add.text(200,96,`Shield: ${this.upgrades.shield}`,{fontSize:"24px",fill:"#0000ff",fontFamily:"Courier"}).setDepth(101))}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Shield+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),e.join(" ")}startGameLoop(){const e=this.progressManager?this.progressManager.loadProgress():null,t=e&&e.currentMap||1;this.time.addEvent({delay:100,callback:()=>{if(!this.isGameOver){const i=this.time.now;i-this.lastAsteroidSpawn>=this.asteroidSpawnDelay&&(this.spawnAsteroid(),this.lastAsteroidSpawn=i,this.asteroidSpawnDelay=Math.max(this.minAsteroidSpawnDelay,this.asteroidSpawnDelay*.98),this.asteroidSpeedMultiplier*=1.01)}},loop:!0}),this.powerUpTimer=this.time.addEvent({delay:15e3,callback:()=>{!this.isGameOver&&Math.random()<.5&&this.spawnPowerUp()},loop:!0});const s=Math.max(8e3-t*1e3,4e3);this.satelliteTimer=this.time.addEvent({delay:s,callback:()=>{if(!this.isGameOver){const i=Math.min(t+1,4);for(let o=0;o<i;o++)this.time.delayedCall(o*400,()=>this.spawnSatellite())}},loop:!0})}spawnPowerUp(){const e=[{type:"temp_shield",char:"S",color:"#00ffff",duration:15e3},{type:"temp_speed",char:">",color:"#00ff00",duration:1e4},{type:"temp_fire",char:"!",color:"#ffff00",duration:12e3}],t=e[m.Math.Between(0,e.length-1)],s=this.add.text(m.Math.Between(40,760),-20,t.char,{fontFamily:"Courier",fontSize:"24px",fill:t.color}).setOrigin(.5);this.powerUps.push({sprite:s,type:t.type,duration:t.duration,speed:100})}shoot(){const e=this.time.now,t=1e3/this.powerUpManager.getFireRate();if(e-this.lastShot>=t){this.lastShot=e;const s=this.powerUpManager.getUpgradedStats(),i=this.powerUpManager.BASE_STATS.fireRate,o=Math.min(5,Math.max(1,Math.floor((s.fireRate-i)/2)+1));let n;switch(o){case 1:n=[{char:"↑",offset:0}];break;case 2:n=[{char:"↑",offset:-8},{char:"↑",offset:8}];break;case 3:n=[{char:"↗",offset:-16},{char:"↑",offset:0},{char:"↖",offset:16}];break;case 4:n=[{char:"↖",offset:-24},{char:"↑",offset:-8},{char:"↑",offset:8},{char:"↗",offset:24}];break;case 5:n=[{char:"↖",offset:-32},{char:"↖",offset:-16},{char:"↑",offset:0},{char:"↗",offset:16},{char:"↗",offset:32}];break}n.forEach(c=>{const r=this.add.text(this.player.x+c.offset,this.player.y-20,c.char,{fontFamily:"Arial",fontSize:"24px",fill:"#ffffff",stroke:"#00ff00",strokeThickness:2}).setOrigin(.5);r.setBlendMode(m.BlendModes.ADD),r.preFX.addGlow(65280,4),r.setData("speed",-this.upgrades.bulletSpeed),this.bullets.push(r)}),this.sound.play("shoot",{volume:.5})}}update(e,t){if(!this.gameStarted||this.isGameOver)return;this.starSprites.forEach(i=>{i.y+=i.speed*t/1e3,i.y>600&&(i.y=-10,i.x=m.Math.Between(0,800))});const s=this.getPlayerStats();if(this.bullets&&this.bullets.length&&this.updateBullets(t),this.asteroids&&this.asteroids.length&&this.updateAsteroids(t),this.satellites&&this.satellites.length&&this.updateSatellites(t),this.powerUps&&this.powerUps.length&&this.updatePowerUps(t),this.player){const i=s.speed*(t/1e3);(this.cursors.left.isDown||this.wasdKeys.left.isDown)&&(this.player.x=Math.max(30,this.player.x-i)),(this.cursors.right.isDown||this.wasdKeys.right.isDown)&&(this.player.x=Math.min(770,this.player.x+i)),this.spaceKey.isDown&&e>this.lastShot+1e3/s.fireRate&&(this.shoot(),this.lastShot=e)}this.checkCollisions()}applyPowerUps(){this.powerUpStats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.powerUpBitmask&this.powerUpTypes.LIFE&&(this.powerUpStats.life+=2),this.powerUpBitmask&this.powerUpTypes.CRAFT&&(this.powerUpStats.craftSize=1.2),this.powerUpBitmask&this.powerUpTypes.SPEED&&(this.powerUpStats.speed+=100),this.powerUpBitmask&this.powerUpTypes.BULLETS&&(this.powerUpStats.bulletSpeed+=200,this.powerUpStats.fireRate+=2),this.updatePowerUpText()}updatePowerUpText(){const e=[];this.powerUpBitmask&this.powerUpTypes.LIFE&&e.push("Life+"),this.powerUpBitmask&this.powerUpTypes.CRAFT&&e.push("Size+"),this.powerUpBitmask&this.powerUpTypes.SPEED&&e.push("Speed+"),this.powerUpBitmask&this.powerUpTypes.BULLETS&&e.push("Fire+"),this.powerUpText&&this.powerUpText.setText("Power-ups: "+e.join(" "))}updateBullets(e){for(let t=this.bullets.length-1;t>=0;t--){const s=this.bullets[t];s.y+=s.getData("speed")*e/1e3,s.y<-10&&(s.destroy(),this.bullets.splice(t,1))}}spawnAsteroid(){const e=[[" /==\\ ","|====|"," \\==/ "],["  /\\  ","<====>","  \\/  "],[" /##\\ ","{####}"," \\##/ "],[" /-\\ ","{***}"," \\-/ "]],t=e[m.Math.Between(0,e.length-1)],s=this.add.container(m.Math.Between(40,760),-40);t.forEach((i,o)=>{const n=this.add.text(0,o*16,i,{fontFamily:"Courier",fontSize:"24px",fill:"#cccccc",stroke:"#666666",strokeThickness:1}).setOrigin(.5);s.add(n)}),this.asteroids.push({sprite:s,speed:m.Math.Between(150,300)*this.asteroidSpeedMultiplier,rotationSpeed:m.Math.Between(-3,3),type:"asteroid"})}updateAsteroids(e){for(let t=this.asteroids.length-1;t>=0;t--){const s=this.asteroids[t];s.sprite.y+=s.speed*e/1e3,s.sprite.rotation+=s.rotationSpeed*e/1e3,s.sprite.y>620&&(s.sprite.destroy(),this.asteroids.splice(t,1))}}spawnSatellite(){const e=[{pattern:"sine",char:"[-o-]",color:"#ff0000",speed:200},{pattern:"zigzag",char:"{=o=}",color:"#ff3300",speed:250},{pattern:"chase",char:"<-o->",color:"#ff6600",speed:300}],t=e[m.Math.Between(0,e.length-1)],s=this.add.text(m.Math.Between(40,760),-20,t.char,{fontFamily:"Courier",fontSize:"20px",fill:t.color,stroke:"#000000",strokeThickness:1}).setOrigin(.5);this.satellites.push({sprite:s,speed:t.speed+m.Math.Between(0,50),horizontalSpeed:m.Math.Between(-150,150),pattern:t.pattern,type:"satellite",timeOffset:Date.now()})}updateSatellites(e){for(let t=this.satellites.length-1;t>=0;t--){const s=this.satellites[t];switch(s.sprite.y+=s.speed*e/1e3,s.pattern){case"sine":s.sprite.x=s.sprite.x+Math.sin((Date.now()-s.timeOffset)*.003)*(e/1e3)*100;break;case"zigzag":s.direction||(s.direction=1),s.sprite.x+=s.direction*(150*e/1e3),(s.sprite.x<40||s.sprite.x>760)&&(s.direction*=-1);break;case"chase":if(this.player){const n=this.player.x-s.sprite.x;s.sprite.x+=Math.sign(n)*(100*e/1e3)}break}s.sprite.x=m.Math.Clamp(s.sprite.x,40,760),s.sprite.y>620&&(s.sprite.destroy(),this.satellites.splice(t,1))}}updatePowerUps(e){for(let t=this.powerUps.length-1;t>=0;t--){const s=this.powerUps[t];s.sprite.y+=s.speed*(e/1e3),s.sprite.y>this.height+50&&(s.sprite.destroy(),this.powerUps.splice(t,1))}}collectPowerUp(e){switch(this.score+=25,this.scoreText.setText(`Score: ${this.score}`),e.type){case"temp_shield":this.powerUpManager.addTemporaryPowerUp("shield",e.duration),this.updateShieldDisplay(),this.time.delayedCall(e.duration,()=>{this.powerUpManager.removeTemporaryPowerUp("shield"),this.updateShieldDisplay()});break;case"temp_speed":this.powerUpManager.addTemporaryPowerUp("speed",e.duration),this.time.delayedCall(e.duration,()=>{this.powerUpManager.removeTemporaryPowerUp("speed")});break;case"temp_fire":this.powerUpManager.addTemporaryPowerUp("fireRate",e.duration),this.time.delayedCall(e.duration,()=>{this.powerUpManager.removeTemporaryPowerUp("fireRate")});break}this.sound.play("powerup",{volume:.5}),e.sprite.destroy();const t=this.add.text(e.sprite.x,e.sprite.y,"+25",{fontFamily:"Courier",fontSize:"24px",fill:"#00ff00",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:t,y:t.y-50,alpha:0,duration:1e3,onComplete:()=>t.destroy()})}updateBonusText(){const e=[];this.tempBonuses.shield>0&&e.push(`Shield(${this.tempBonuses.shield})`),this.tempBonuses.speed>0&&e.push(`Speed(${this.tempBonuses.speed}×)`),this.tempBonuses.fireRate>0&&e.push(`Fire(${this.tempBonuses.fireRate}×)`),this.powerUpText&&this.powerUpText.setText("Active Bonuses: "+(e.length?e.join(" "):"None"))}getPlayerStats(){return this.powerUpManager.getUpgradedStats()}checkCollisions(){this.bullets=this.bullets.filter(e=>e&&!e.destroyed),this.asteroids=this.asteroids.filter(e=>e&&e.sprite&&!e.sprite.destroyed),this.satellites=this.satellites.filter(e=>e&&e.sprite&&!e.sprite.destroyed);for(let e=this.bullets.length-1;e>=0;e--){const t=this.bullets[e];if(!(!t||t.destroyed)){for(let s=this.asteroids.length-1;s>=0;s--){const i=this.asteroids[s];if(!(!i||!i.sprite||i.sprite.destroyed)&&this.checkOverlap(t,i.sprite)){this.handleCollision(t,i,10);break}}if(!t.destroyed)for(let s=this.satellites.length-1;s>=0;s--){const i=this.satellites[s];if(!(!i||!i.sprite||i.sprite.destroyed)&&this.checkOverlap(t,i.sprite)){this.handleCollision(t,i,20);break}}}}if(this.player&&!this.player.destroyed){for(let e=this.asteroids.length-1;e>=0;e--){const t=this.asteroids[e];!t||!t.sprite||t.sprite.destroyed||this.checkOverlap(this.player,t.sprite)&&(t.sprite.destroy(),this.asteroids.splice(e,1),this.handlePlayerHit())}for(let e=this.satellites.length-1;e>=0;e--){const t=this.satellites[e];!t||!t.sprite||t.sprite.destroyed||this.checkOverlap(this.player,t.sprite)&&(t.sprite.destroy(),this.satellites.splice(e,1),this.handlePlayerHit())}for(let e=this.powerUps.length-1;e>=0;e--){const t=this.powerUps[e];!t||!t.sprite||t.sprite.destroyed||this.checkOverlap(this.player,t.sprite)&&(this.collectPowerUp(t),this.powerUps.splice(e,1))}}}handlePlayerHit(){if(this.isInvulnerable)return;if(this.powerUpManager.getUpgradedStats().shield>0){this.showShieldEffect(),this.powerUpManager.tempPowerUps.shield=Math.max(0,this.powerUpManager.tempPowerUps.shield-1),this.score=Math.max(0,this.score-25),this.scoreText.setText(`Score: ${this.score}`);const t=this.add.text(this.player.x,this.player.y-60,"-25 SHIELD BREAK!",{fontFamily:"Courier",fontSize:"24px",fill:"#ff0000",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:t,y:t.y-50,alpha:0,duration:1e3,onComplete:()=>t.destroy()});return}this.health--,this.showDamageEffect(),this.health<=0?this.handleGameOver():(this.isInvulnerable=!0,this.player.setAlpha(.5),this.time.delayedCall(1e3,()=>{this.isInvulnerable=!1,this.player.setAlpha(1)}))}showDamageEffect(){this.player&&this.player.list&&this.player.list.forEach(e=>{e.setFillStyle&&(e.setFillStyle("#ff0000"),this.time.delayedCall(100,()=>{e.setFillStyle("#ffffff")}))})}showShieldEffect(){const e=this.add.circle(this.player.x,this.player.y,40,65280,.3);e.setStrokeStyle(2,65280);const t=this.add.text(this.player.x,this.player.y-40,"SHIELD BREAK!",{fontFamily:"Courier",fontSize:"24px",fill:"#00ffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:[e,t],alpha:0,scale:1.5,duration:500,onComplete:()=>{e.destroy(),t.destroy()}}),this.sound.get("shield")&&this.sound.play("shield",{volume:.3}),this.updateShieldDisplay()}checkOverlap(e,t){if(!e||!t)return!1;let s,i;return e.list&&e.list.length>0,s=e.getBounds(),t.list&&t.list.length>0,i=t.getBounds(),!s||!i?!1:m.Geom.Rectangle.Overlaps(s,i)}showGameOver(){if(this.isGameOver||!this.gameStarted)return;this.isGameOver=!0,this.clearGameEntities();const e=this.add.rectangle(0,0,this.game.config.width,this.game.config.height,0,0);e.setOrigin(0).setDepth(1e3),this.tweens.add({targets:e,alpha:.7,duration:500,ease:"Power2",onComplete:()=>{if(this.sceneTransition)if(this.fromMainMenu)this.sceneTransition.toMainMenu(this,{score:this.score,powerUpBitmask:this.powerUpManager.powerUpBitmask,currentMap:this.currentMap});else if(this.nextScene)this.sceneTransition.to(this,this.nextScene,{score:this.score,powerUpBitmask:this.powerUpManager.powerUpBitmask,currentMap:this.currentMap,fromSpaceInvaders:!0});else{const t=this.sceneTransition.getNextTransition(this.scene.key,"space_invaders");this.sceneTransition.to(this,t||"mainmenu",{score:this.score,powerUpBitmask:this.powerUpManager.powerUpBitmask,currentMap:this.currentMap,fromSpaceInvaders:!0})}else this.transitionToScene(this.nextScene||"mainmenu")}})}clearGameEntities(){var e,t,s,i;(e=this.asteroids)==null||e.forEach(o=>{var n;return(n=o.sprite)==null?void 0:n.destroy()}),(t=this.satellites)==null||t.forEach(o=>{var n;return(n=o.sprite)==null?void 0:n.destroy()}),(s=this.bullets)==null||s.forEach(o=>o.destroy()),(i=this.powerUps)==null||i.forEach(o=>{var n;return(n=o.sprite)==null?void 0:n.destroy()}),this.asteroids=[],this.satellites=[],this.bullets=[],this.powerUps=[]}updateShieldVisuals(){this.player.list.forEach(t=>{t.shieldLayer&&t.destroy()}),this.getPlayerStats();const e=this.tempBonuses.shield+(this.upgrades.shield||0);if(e>0)for(let t=0;t<e;t++){const s=(t+1)*4,i=t<this.upgrades.shield?"#4444ff":"#44ffff",o=this.add.text(0,-2-s,`/${" ".repeat(2+t)}\\`,{fontFamily:"Courier",fontSize:"16px",fill:i,stroke:"#000000",strokeThickness:1}).setOrigin(.5);o.shieldLayer=!0,this.player.add(o);const n=this.add.text(0,44+s,`\\${" ".repeat(2+t)}/`,{fontFamily:"Courier",fontSize:"16px",fill:i,stroke:"#000000",strokeThickness:1}).setOrigin(.5);n.shieldLayer=!0,this.player.add(n);const c=20+t*4,r=this.add.text(-c,20,")",{fontFamily:"Courier",fontSize:"16px",fill:i,stroke:"#000000",strokeThickness:1}).setOrigin(.5);r.shieldLayer=!0,this.player.add(r);const l=this.add.text(c,20,"(",{fontFamily:"Courier",fontSize:"16px",fill:i,stroke:"#000000",strokeThickness:1}).setOrigin(.5);l.shieldLayer=!0,this.player.add(l)}}handleCollision(e,t,s){if(e.destroy(),t.sprite.destroy(),t.type==="satellite"){if(this.score=Math.max(0,this.score-75),this.scoreText.setText(`Score: ${this.score}`),this.health-=2,this.healthText.setText(`Health: ${this.health}`),this.health<=0){this.showGameOver();return}this.showDamageEffect(),this.sound.play("satellite_destroy",{volume:.5});const n=this.add.text(t.sprite.x,t.sprite.y,"-75 CRITICAL! -2 HP",{fontFamily:"Courier",fontSize:"24px",fill:"#ff0000",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:n,y:n.y-50,alpha:0,duration:1e3,onComplete:()=>n.destroy()})}else{if(Math.random()<.03){const r=this.powerUpManager.applyRandomPermanentUpgrade();r&&this.showUpgradeNotification(r)}const n=["\\   /"," \\*/ ","* * *"," /*\\ ","/   \\"],c=this.add.container(t.sprite.x,t.sprite.y);c.setDepth(100),n.forEach((r,l)=>{const p=this.add.text(0,(l-2)*16,r,{fontFamily:"Courier",fontSize:"24px",fill:"#ffff00",stroke:"#ff4400",strokeThickness:2}).setOrigin(.5);c.add(p)}),this.tweens.add({targets:c,alpha:0,duration:400,delay:100,onComplete:()=>c.destroy()}),this.score+=s,this.scoreText.setText(`Score: ${this.score}`),this.sound.play("explosion",{volume:.3})}const i=this.bullets.indexOf(e);i>-1&&this.bullets.splice(i,1);const o=t.type==="asteroid"?this.asteroids.indexOf(t):this.satellites.indexOf(t);o>-1&&(t.type==="asteroid"?this.asteroids.splice(o,1):this.satellites.splice(o,1))}showUpgradeNotification(e){const t={[this.powerUpManager.POWERUP_TYPES.LIFE]:"LIFE UPGRADE!",[this.powerUpManager.POWERUP_TYPES.SHIELD]:"SHIELD UPGRADE!",[this.powerUpManager.POWERUP_TYPES.SPEED]:"SPEED UPGRADE!",[this.powerUpManager.POWERUP_TYPES.FIRE]:"FIRE RATE UPGRADE!"},s=this.add.text(400,300,t[e],{fontSize:"32px",fill:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(1e3);this.tweens.add({targets:s,y:200,alpha:0,duration:2e3,ease:"Power2",onComplete:()=>s.destroy()})}transitionToNextScene(){var o;if(this.isTransitioning)return;this.isTransitioning=!0;const e=(o=this.nextScene)==null?void 0:o.match(/map(\d+)scene(\d+)/);if(!e){console.error("Invalid next scene format:",this.nextScene);return}const[t,s,i]=e;this.scene.start("trivia_master",{mapNumber:parseInt(s),sceneNumber:parseInt(i),score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}showQuestion(e,t){const s=this.add.rectangle(400,300,800,600,0,.8).setOrigin(.5).setDepth(100),i=this.add.container(400,300);i.setDepth(101);const o=this.add.text(0,-100,e.question,{fontSize:"24px",fill:"#fff",wordWrap:{width:600},align:"center",fontFamily:"Courier"}).setOrigin(.5);i.add(o);const n=[...e.incorrect_answers,e.correct_answer];this.shuffleArray(n),n.forEach((c,r)=>{const l=r*60-50,p=this.add.rectangle(0,l,550,50,3355443).setInteractive({useHandCursor:!0}),h=this.add.text(0,l,c,{fontSize:"20px",fill:"#fff",fontFamily:"Courier"}).setOrigin(.5);p.on("pointerover",()=>{p.setFillStyle(6710886),h.setFill("#00ff00")}),p.on("pointerout",()=>{p.setFillStyle(3355443),h.setFill("#ffffff")}),p.on("pointerdown",()=>{const u=c===e.correct_answer,d=this.add.text(p.x+300,p.y,u?"✓":"✗",{fontSize:"32px",fill:u?"#00ff00":"#ff0000",fontFamily:"Arial"}).setOrigin(.5).setDepth(102);i.list.forEach(f=>{f.removeInteractive&&f.removeInteractive()}),this.time.delayedCall(1e3,()=>{i.destroy(),s.destroy(),d.destroy(),u&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`),t.setTint(65280))})}),i.add([p,h])})}handleGameOver(){var t;if(this.isTransitioning)return;this.isTransitioning=!0,this.progressManager.saveProgress({score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap});const e=(t=this.transitionData)==null?void 0:t.nextScene;if(!e){console.error("No next scene specified in transition data"),this.scene.start("mainmenu");return}this.add.text(400,300,"Game Over",{fontSize:"48px",fill:"#fff"}).setOrigin(.5),this.add.text(400,350,`Final Score: ${this.score}`,{fontSize:"24px",fill:"#fff"}).setOrigin(.5),this.time.delayedCall(2e3,()=>{this.sceneTransition?this.sceneTransition.to(this,e,{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap,fromScene:"space_invaders"}):this.scene.start(e,{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap,fromScene:"space_invaders"})})}updateShieldDisplay(){this.tempPowerUps.shield>0?(this.shieldText||(this.shieldText=this.add.text(16,50,"",{fontFamily:"Courier",fontSize:"20px",fill:"#00ff00"})),this.shieldText.setText(`Shield: ${this.tempPowerUps.shield}`)):this.shieldText&&(this.shieldText.destroy(),this.shieldText=null)}}class ae extends m.Scene{constructor(){super({key:"sort_selection"}),this.score=0,this.currentMap=1,this.selected=null,this.thumbnails=[],this.connections=[],this.sortSpeed=500,this.isTransitioning=!1,this.sortData={thumbnails:[],sortedScenes:[],selected:null},this.gameState={score:0},this.timingInfo={startTime:0,endTime:0,totalTime:0,animationStartTime:0,animationEndTime:0},this.sceneTransition=null,this.progressManager=null,this.sceneManager=null,this.computeTime="0.0000"}init(e){this.score=(e==null?void 0:e.score)||this.registry.get("score")||0,this.currentMap=(e==null?void 0:e.currentMap)||this.registry.get("currentMap")||1,this.progress=(e==null?void 0:e.progress)||this.registry.get("progress")||0,this.powerUpBitmask=e.powerUpBitmask||0,this.fromScene=e.fromScene,this.registry.set("score",this.score),this.registry.set("currentMap",this.currentMap),this.registry.set("progress",this.progress),this.sceneTransition=window.sceneTransition,this.progressManager=window.progressManager,window.sceneManager&&(this.sceneManager=window.sceneManager),this.isTransitioning=!1,this.isAnimating=!1,this.registry.events.on("changedata",this.handleRegistryChange,this)}handleRegistryChange(e,t,s){switch(t){case"score":this.score=s;break;case"currentMap":this.currentMap=s;break;case"progress":this.progress=s;break}}preload(){this.load.image("map1scene164",a("images/map1scene164.png")),this.load.image("map1scene264",a("images/map1scene264.png")),this.load.image("map1scene364",a("images/map1scene364.png")),this.load.image("map1scene464",a("images/map1scene464.png")),this.load.image("map2scene164",a("images/map2scene164.png")),this.load.image("map2scene264",a("images/map2scene264.png")),this.load.image("map2scene364",a("images/map2scene364.png")),this.load.image("map2scene464",a("images/map2scene464.png")),this.load.image("map3scene164",a("images/map3scene164.png")),this.load.image("map3scene264",a("images/map3scene264.png")),this.load.image("map3scene364",a("images/map3scene364.png")),this.load.image("map3scene464",a("images/map3scene464.png")),this.load.image("map4scene364",a("images/map4scene364.png")),this.load.image("map4scene464",a("images/map4scene464.png")),this.load.json("map-config",a("data/map1/map-config.json")),this.load.json("questions",a("data/questions.json")),this.load.bitmapFont("arcade",a("fonts/arcade.png"),a("fonts/arcade.xml")),this.load.json("map-config4",a("data/map1/map-config64.json")),this.load.image("background",a("images/backgrounds/space-background.png")),console.log("Loading sound effects..."),this.load.audio("fail",a("sounds/cartoon_fail.mp3")).on("filecomplete",()=>console.log("Fail sound loaded successfully")).on("loaderror",e=>console.error("Failed to load fail sound:",e)),this.load.audio("buzzer",a("sounds/buzzer.mp3")).on("filecomplete",()=>console.log("Buzzer sound loaded successfully")).on("loaderror",e=>console.error("Failed to load buzzer sound:",e)),this.load.on("complete",()=>{console.log("All assets loaded. Sound cache status:",{fail:this.cache.audio.exists("fail"),buzzer:this.cache.audio.exists("buzzer")})})}createSilentSound(e){if(this.game.sound.context){const t=this.game.sound.context.createBuffer(1,44100,44100);this.cache.audio.add(e,t)}}playSound(e){console.log(`Attempting to play sound: ${e}`);try{this.sound.locked?(console.log("Audio system is locked. Waiting for user interaction..."),this.sound.once("unlocked",()=>{this.playSound(e)})):(this.sound.stopAll(),this.sound.add(e,{volume:.5}).play(),console.log(`Playing sound: ${e}`))}catch(t){console.error(`Error playing sound ${e}:`,t)}}create(){this.add.image(400,300,"background").setAlpha(.3);const t=this.add.graphics();t.fillGradientStyle(0,0,1122884,1122884,.7),t.fillRect(0,0,800,600),this.add.text(20,20,"Score: "+this.score,{fontSize:"24px",fill:"#fff"}),this.statsText=this.add.text(20,150,"",{fontSize:"16px",fill:"#fff",fontFamily:"monospace"});const s=600,i=5;this.add.text(s,i,"Color Key:",{fontSize:"18px",fill:"#fff"}),[{color:16711680,label:"Pivot/Current"},{color:255,label:"Comparing"},{color:65280,label:"Sorted/Default"}].forEach((T,I)=>{const B=i+30+I*25;this.add.rectangle(s,B,20,20,T.color),this.add.text(s+15,B,T.label,{fontSize:"14px",fill:"#fff"}).setOrigin(0,.5)}),this.add.text(400,50,"Sort Selection",{fontSize:"32px",fill:"#fff"}).setOrigin(.5),this.container=this.add.container(425,250);const n=["map1scene164","map1scene264","map1scene364","map1scene464","map2scene164","map2scene264","map2scene364","map2scene464","map3scene164","map3scene264","map3scene364","map3scene464","map4scene364","map4scene464"],c=7,r=64,l=64,p=20,h=20,u=-568/2,d=-148/2;this.initialPositions=[],n.forEach((T,I)=>{const B=Math.floor(I/c),N=I%c,D=u+N*(r+p),O=d+B*(l+h);this.initialPositions[I]={x:D,y:O};const M=this.add.image(D,O,T).setScale(.8).setInteractive();M.on("pointerover",()=>{this.tweens.add({targets:M,scaleX:1,scaleY:1,duration:200})}),M.on("pointerout",()=>{this.tweens.add({targets:M,scaleX:.8,scaleY:.8,duration:200})}),this.thumbnails.push(M),this.container.add(M)});const f=[{text:"Bubble Sort",method:"bubble",color:4886754,complexity:"O(n²)",description:"Compares adjacent elements and swaps them if in the wrong order."},{text:"Quick Sort",method:"quick",color:5301186,complexity:"O(n log n)",description:"Uses a pivot element to partition the array."},{text:"Merge Sort",method:"merge",color:14897263,complexity:"O(n log n)",description:"Divides array, sorts subarrays, and merges them."},{text:"Insertion Sort",method:"insertion",color:14917968,complexity:"O(n²)",description:"Builds sorted array one item at a time."},{text:"Selection Sort",method:"selection",color:10181046,complexity:"O(n²)",description:"Finds the minimum element and places it first."},{text:"Heap Sort",method:"heap",color:1752220,complexity:"O(n log n)",description:"Uses a binary heap to sort elements."}],g=(T,I,B)=>{const N=this.add.container(T,I-70),D=this.add.rectangle(0,0,320,80,0,.7).setStrokeStyle(1,16777215,.3),O=this.add.text(0,0,`Time Complexity: ${B.complexity}
${B.description}`,{fontSize:"14px",fill:"#ffffff",align:"center",padding:{x:10,y:5},wordWrap:{width:300}}).setOrigin(.5);return N.add([D,O]),N.setDepth(0),N},x=525,y=this.add.container(400,x-110),k=180,C=40,P=40,A=20,j=3,K=-620/2;f.forEach((T,I)=>{const B=Math.floor(I/j),N=I%j,D=K+N*(k+P)+k/2,O=B*(C+A),M=this.add.container(D,O),E=this.add.rectangle(0,0,k,C,T.color,.8).setStrokeStyle(2,16777215).setInteractive({useHandCursor:!0});E.name=`${T.method}-sort-button`;const Z=this.add.text(0,0,T.text,{fontSize:"18px",fill:"#ffffff",fontFamily:"Arial"}).setOrigin(.5);M.add([E,Z]),y.add(M),E.on("pointerover",()=>{E.setFillStyle(T.color,1),this.tweens.add({targets:M,scaleX:1.05,scaleY:1.05,duration:100}),M.tooltip=g(M.x+y.x,M.y+y.y,T)}),E.on("pointerout",()=>{E.setFillStyle(T.color,.8),this.tweens.add({targets:M,scaleX:1,scaleY:1,duration:100}),M.tooltip&&(M.tooltip.destroy(),M.tooltip=null)}),E.on("pointerdown",()=>{E.setFillStyle(T.color,.6),this.selectSort(T.method)}),E.on("pointerup",()=>{E.setFillStyle(T.color,1)})});const $=400,F=x+20;this.add.rectangle(400,x+20,600,60,0,.5).setStrokeStyle(1,16777215,.3);const q=this.add.container(180,x+20),z=this.add.rectangle(0,0,100,40,0,.6).setInteractive({useHandCursor:!0}).setStrokeStyle(2,65280,.8),Y=this.add.text(0,0,"Back",{fontSize:"18px",fill:"#fff"}).setOrigin(.5),_=this.add.text(0,-30,"Please wait for sorting to finish",{fontSize:"14px",fill:"#ff0000",backgroundColor:"#000000",padding:{x:5,y:2}}).setOrigin(.5).setVisible(!1);q.add([z,Y,_]),z.on("pointerover",()=>{if(this.isAnimating){_.setVisible(!0);return}z.setFillStyle(4473924),this.tweens.add({targets:q,scaleX:1.05,scaleY:1.05,duration:100})}),z.on("pointerout",()=>{_.setVisible(!1),!this.isAnimating&&(z.setFillStyle(3355443),this.tweens.add({targets:q,scaleX:1,scaleY:1,duration:100}))}),z.on("pointerdown",()=>{if(this.isAnimating){this.tweens.add({targets:_,alpha:0,duration:200,yoyo:!0,repeat:1});return}z.setFillStyle(2236962),this.backToMenu()}),q.setDepth(50),this.add.text($-165,F,"Speed:",{fontSize:"18px",fill:"#fff"}).setOrigin(0,.5);const G=this.add.rectangle($,F,200,10,6710886).setInteractive({useHandCursor:!0}),L=this.add.circle($,F,10,16777215).setInteractive({useHandCursor:!0}).setDepth(1);let R=!1;const X=200,W=T=>{const I=G.getBounds();L.x=m.Math.Clamp(T,I.left,I.right);const B=(L.x-I.left)/I.width;this.sortSpeed=Math.max(X,1e3-B*700)};L.on("pointerdown",()=>{R=!0}),this.input.on("pointermove",T=>{R&&W(T.x)}),this.input.on("pointerup",()=>{R=!1}),G.on("pointerdown",T=>{W(T.x)}),this.cleanupAnimations=()=>{this.tweens.killAll(),this.thumbnails&&this.thumbnails.forEach(T=>{T.clearTint(),T.setScale(.8)})},this.shuffleThumbnails()}selectSort(e){if(this.isAnimating)return;this.isAnimating=!0,this.selected=e,this.statsText&&this.statsText.destroy(),this.statsText=this.add.text(20,60,"Sorting...",{fontSize:"16px",fill:"#fff",fontFamily:"monospace"}),this.timingInfo.startTime=performance.now();const t=this.thumbnails,s=this.initializeElements(t),i=performance.now(),o=[...s];switch(this.timingInfo={startTime:i,endTime:null,totalTime:0,animationStartTime:null,animationEndTime:null},e){case"bubble":for(let h=0;h<o.length;h++)for(let u=0;u<o.length-h-1;u++)o[u].value>o[u+1].value&&([o[u],o[u+1]]=[o[u+1],o[u]]);break;case"quick":const c=(h,u,d)=>{if(u>=d)return;let f=h[d],g=u-1;for(let x=u;x<d;x++)h[x].value<=f.value&&(g++,[h[g],h[x]]=[h[x],h[g]]);[h[g+1],h[d]]=[h[d],h[g+1]],c(h,u,g),c(h,g+2,d)};c(o,0,o.length-1);break;case"insertion":for(let h=1;h<o.length;h++){let u=o[h],d=h-1;for(;d>=0&&o[d].value>u.value;)o[d+1]=o[d],d--;o[d+1]=u}break;case"selection":for(let h=0;h<o.length-1;h++){let u=h;for(let d=h+1;d<o.length;d++)o[d].value<o[u].value&&(u=d);u!==h&&([o[h],o[u]]=[o[u],o[h]])}break;case"heap":const r=(h,u,d)=>{let f=d;const g=2*d+1,x=2*d+2;g<u&&h[g].value>h[f].value&&(f=g),x<u&&h[x].value>h[f].value&&(f=x),f!==d&&([h[d],h[f]]=[h[f],h[d]],r(h,u,f))};for(let h=Math.floor(o.length/2)-1;h>=0;h--)r(o,o.length,h);for(let h=o.length-1;h>0;h--)[o[0],o[h]]=[o[h],o[0]],r(o,h,0);break;case"merge":const l=(h,u,d,f)=>{const g=[];let x=u,y=d+1,k=0;for(;x<=d&&y<=f;)h[x].value<=h[y].value?g[k++]=h[x++]:g[k++]=h[y++];for(;x<=d;)g[k++]=h[x++];for(;y<=f;)g[k++]=h[y++];for(x=0;x<k;x++)h[u+x]=g[x]},p=(h,u,d)=>{if(u<d){const f=Math.floor((u+d)/2);p(h,u,f),p(h,f+1,d),l(h,u,f,d)}};p(o,0,o.length-1);break}this.timingInfo.endTime=performance.now(),this.timingInfo.totalTime=this.timingInfo.endTime-this.timingInfo.startTime;const n=(this.timingInfo.totalTime*1e3).toFixed(5);switch(console.log(`Compute time: ${n}µs`),this.computeTime=this.timingInfo.totalTime.toFixed(6),console.log(`${e} Sort Time: ${this.computeTime}ms`),this.statsText.setText(`Computing sort... ${this.computeTime}ms`),this.timingInfo.animationStartTime=performance.now(),e){case"bubble":this.animateBubbleSort(s);break;case"quick":this.animateQuickSort(s,0,s.length-1);break;case"merge":this.animateMergeSort(s);break;case"insertion":this.animateInsertionSort(s);break;case"selection":this.animateSelectionSort(s);break;case"heap":this.animateHeapSort(s);break}}initializeElements(e){return e.map((t,s)=>({sprite:t,originalIndex:s,originalX:t.x,currentX:t.x,value:s}))}async animateSwap(e,t,s){const i=this.initialPositions[t],o=this.initialPositions[s];return[e[t],e[s]]=[e[s],e[t]],e[t].currentX=i.x,e[s].currentX=o.x,new Promise(n=>{let c=0;const r=()=>{c++,c===2&&n()};this.tweens.add({targets:e[t].sprite,x:i.x,y:i.y,duration:this.sortSpeed,onComplete:r}),this.tweens.add({targets:e[s].sprite,x:o.x,y:o.y,duration:this.sortSpeed,onComplete:r})})}async animateBubbleSort(e){for(let t=0;t<e.length;t++){for(let s=0;s<e.length-t-1;s++)e[s].sprite.setTint(255),e[s+1].sprite.setTint(255),await new Promise(i=>this.time.delayedCall(this.sortSpeed/2,i)),e[s].value>e[s+1].value&&(e[s].sprite.setTint(16711680),e[s+1].sprite.setTint(16711680),await this.animateSwap(e,s,s+1)),e[s].sprite.clearTint(),e[s+1].sprite.clearTint();e[e.length-t-1].sprite.setTint(65280)}e[0].sprite.setTint(65280),this.finishSort(e.map(t=>t.sprite))}async animateQuickSort(e,t,s){if(t>=s){t===s&&e[t].sprite.setTint(65280);return}const i=e[s];i.sprite.setTint(16711680);let o=t-1;for(let n=t;n<s;n++)e[n].sprite.setTint(255),await new Promise(c=>this.time.delayedCall(this.sortSpeed/2,c)),e[n].value<=i.value&&(o++,o!==n&&await this.animateSwap(e,o,n),e[o].sprite.setTint(65280)),e[n].sprite.clearTint();o+1!==s&&await this.animateSwap(e,o+1,s),i.sprite.clearTint(),e[o+1].sprite.setTint(65280),await this.animateQuickSort(e,t,o),await this.animateQuickSort(e,o+2,s);for(let n=t;n<=s;n++)e[n].sprite.setTint(65280);t===0&&s===e.length-1&&this.finishSort(e.map(n=>n.sprite))}async animateInsertionSort(e){e[0].sprite.setTint(65280);for(let t=1;t<e.length;t++){const s=e[t];s.sprite.setTint(16711680);let i=t-1;for(await new Promise(o=>this.time.delayedCall(this.sortSpeed/2,o));i>=0&&e[i].value>s.value;)e[i].sprite.setTint(255),await this.animateSwap(e,i+1,i),e[i+1].sprite.setTint(65280),i--;e[i+1].sprite.setTint(65280)}this.finishSort(e.map(t=>t.sprite))}async animateSelectionSort(e){for(let t=0;t<e.length-1;t++){let s=t;e[t].sprite.setTint(16711680);for(let i=t+1;i<e.length;i++)e[i].sprite.setTint(255),await new Promise(o=>this.time.delayedCall(this.sortSpeed/2,o)),e[i].value<e[s].value?(s!==t&&e[s].sprite.clearTint(),s=i,e[s].sprite.setTint(16711680)):e[i].sprite.clearTint();s!==t&&await this.animateSwap(e,t,s),e[t].sprite.setTint(65280)}e[e.length-1].sprite.setTint(65280),this.finishSort(e.map(t=>t.sprite))}async animateHeapSort(e){const t=async(s,i)=>{let o=i;const n=2*i+1,c=2*i+2;e[i].sprite.setTint(16711680),n<s&&e[n].sprite.setTint(255),c<s&&e[c].sprite.setTint(255),await new Promise(r=>this.time.delayedCall(this.sortSpeed/2,r)),n<s&&e[n].value>e[o].value&&(o=n),c<s&&e[c].value>e[o].value&&(o=c),o!==i&&(await this.animateSwap(e,i,o),await t(s,o)),e[i].sprite.clearTint(),n<s&&e[n].sprite.clearTint(),c<s&&e[c].sprite.clearTint()};for(let s=Math.floor(e.length/2)-1;s>=0;s--)await t(e.length,s);for(let s=e.length-1;s>0;s--)await this.animateSwap(e,0,s),e[s].sprite.setTint(65280),await t(s,0);e[0].sprite.setTint(65280),this.finishSort(e.map(s=>s.sprite))}async animateMergeSort(e){if(e.length<=1)return e.length===1&&e[0].sprite.setTint(65280),e;const t=Math.floor(e.length/2),s=e.slice(0,t),i=e.slice(t);s.forEach(r=>r.sprite.setTint(255)),i.forEach(r=>r.sprite.setTint(16711680)),await new Promise(r=>this.time.delayedCall(this.sortSpeed/2,r)),s.forEach(r=>r.sprite.clearTint()),i.forEach(r=>r.sprite.clearTint()),await this.animateMergeSort(s),await this.animateMergeSort(i);let o=0,n=0,c=0;for(;o<s.length&&n<i.length;)s[o].sprite.setTint(255),i[n].sprite.setTint(16711680),await new Promise(r=>this.time.delayedCall(this.sortSpeed/2,r)),s[o].value<=i[n].value?(c!==o&&await this.animateSwap(e,c,o),e[c].sprite.setTint(65280),o++):(c!==n+t&&await this.animateSwap(e,c,n+t),e[c].sprite.setTint(65280),n++),c++;for(;o<s.length;)c!==o&&await this.animateSwap(e,c,o),e[c].sprite.setTint(65280),o++,c++;for(;n<i.length;)c!==n+t&&await this.animateSwap(e,c,n+t),e[c].sprite.setTint(65280),n++,c++;return e.length===this.thumbnails.length&&this.finishSort(e.map(r=>r.sprite)),e}finishSort(e){this.timingInfo.animationEndTime=performance.now();const t=(this.timingInfo.animationEndTime-this.timingInfo.animationStartTime).toFixed(6),s=(this.timingInfo.animationEndTime-this.timingInfo.startTime).toFixed(6);this.timingInfo.totalTime>5e3?this.playSound("fail"):this.timingInfo.totalTime>3e3&&this.playSound("buzzer"),this.statsText.setText(`Sort complete!
Compute time: ${this.computeTime}ms
Animation time: ${t}ms
Total time: ${s}ms`),this.fromScene&&this.time.delayedCall(2e3,()=>{this.scene.start(this.fromScene,{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})})}shuffleThumbnails(){if(this.isAnimating)return;this.thumbnails.forEach(t=>{t.clearTint(),t.setScale(.8)});const e=Array.from({length:this.thumbnails.length},(t,s)=>s);for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}e.forEach((t,s)=>{const i=this.initialPositions[t];this.tweens.add({targets:this.thumbnails[s],x:i.x,y:i.y,duration:500,ease:"Power2"})}),this.statsText&&this.statsText.setText("Select a sorting algorithm to begin!"),this.selected=null}startGame(){if(!this.selected||this.isTransitioning||this.isAnimating)return;this.cleanupAnimations&&this.cleanupAnimations(),this.isTransitioning=!0;const e=this.sortData.sortedScenes||[];this.registry.set("dynamicScenes",e),this.registry.set("currentSceneIndex",0),this.registry.set("score",this.score),this.registry.set("currentMap",this.currentMap);const t={score:this.score,currentMap:this.currentMap,fromSort:!0,sortedScenes:e,isDynamicScene:!0,sceneIndex:0};this.events.emit("gameStart",t),this.sceneTransition?this.sceneTransition.to(this,"DynamicGameScene",t):(this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("DynamicGameScene",t)}))}backToMenu(){if(this.isTransitioning||this.isAnimating)return;this.cleanupAnimations&&this.cleanupAnimations(),this.isTransitioning=!0;const e={score:this.score,currentMap:this.currentMap,fromSort:!1};this.registry.set("score",this.score),this.registry.set("currentMap",this.currentMap),this.events.emit("backToMenu",e),this.sceneTransition?this.sceneTransition.to(this,"mainmenu",e):(this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("mainmenu",e)}))}shutdown(){this.cleanupAnimations&&this.cleanupAnimations(),this.isTransitioning=!1,this.isAnimating=!1,this.thumbnails&&(this.thumbnails.forEach(e=>{e.destroy()}),this.thumbnails=[]),this.tweens.killAll(),this.registry.events.off("changedata",this.handleRegistryChange,this),this.events.emit("shutdown")}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{this.questions.find(o=>s.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));const i=`images/services16/${s.category}/48/${s.name}`;console.log("Loading AWS icon:",i),this.load.image(`icon_${s.name}`,a(i))})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}startScene(e,t={}){this.isTransitioning||(this.isTransitioning=!0,window.gameState.lastScene=this.scene.key,this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start(e,{...t,fromScene:this.scene.key,score:this.score,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask})}))}returnToPreviousScene(e={}){this.isTransitioning||!this.fromScene||(this.isTransitioning=!0,window.gameState.lastScene=this.scene.key,this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start(this.fromScene,{...e,score:this.score,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask})}))}launchScene(e,t={}){this.isTransitioning||(this.isTransitioning=!0,window.gameState.lastScene=this.scene.key,this.scene.launch(e,{...t,fromScene:this.scene.key,score:this.score,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask}),this.scene.bringToTop(e),this.time.delayedCall(100,()=>{this.isTransitioning=!1}))}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}}class U extends m.Scene{constructor(e){super(e),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.currentIconIndex=0,this.isMoving=!1,this.paths=[],this.navigationPoints=[],this.spriteConfig={key:"player-sprite",frameWidth:1019,frameHeight:235}}init(e){super.init(e),this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1,this.answeredIcons=e.answeredIcons||[],this.currentIconIndex=e.currentIconIndex||0}preload(){this.loadCoreAssets(),this.load.atlas(this.spriteConfig.key,a("images/spritewalk_animation (1)/spritewalk_animation.png"),a("images/spritewalk_animation (1)/spritewalk_animation.json"))}create(){this.createAnimations(),this.setupScene(),this.createPaths(),this.createPlayer(),this.cursors=this.input.keyboard.createCursorKeys(),this.events.on("shutdown",this.onSceneShutdown,this),this.events.on("wake",this.onSceneWake,this),this.events.on("sleep",this.onSceneSleep,this)}createAnimations(){this.anims.create({key:"walk",frames:this.anims.generateFrameNames(this.spriteConfig.key,{prefix:"spritewalk_animation",start:0,end:7,suffix:".png"}),frameRate:8,repeat:-1})}createPaths(){this.navigationPoints=this.icons.map((e,t)=>({x:e.x,y:e.y,name:e.name,index:t,answered:this.answeredIcons.includes(e.name)})),this.paths=[];for(let e=0;e<this.navigationPoints.length-1;e++)this.paths.push({from:e,to:e+1});this.drawPaths()}drawPaths(){this.pathGraphics&&this.pathGraphics.destroy(),this.pathGraphics=this.add.graphics(),this.pathGraphics.lineStyle(4,16776960,.5),this.paths.forEach(e=>{const t=this.navigationPoints[e.from],s=this.navigationPoints[e.to];this.pathGraphics.beginPath(),this.pathGraphics.moveTo(t.x,t.y),this.pathGraphics.lineTo(s.x,s.y),this.pathGraphics.strokePath()})}createPlayer(){const e=this.navigationPoints[this.currentIconIndex];e&&(this.player=this.add.sprite(e.x,e.y,this.spriteConfig.key),this.player.setScale(.5),this.player.setDepth(100))}update(){if(!this.player||this.isMoving)return;this.navigationPoints[this.currentIconIndex];let e=this.currentIconIndex;if(this.cursors.right.isDown||this.cursors.down.isDown){const t=this.paths.find(s=>s.from===this.currentIconIndex);t&&(e=t.to)}else if(this.cursors.left.isDown||this.cursors.up.isDown){const t=this.paths.find(s=>s.to===this.currentIconIndex);t&&(e=t.from)}if(e!==this.currentIconIndex){const t=this.navigationPoints[e];this.moveToIcon(t,e)}if(m.Input.Keyboard.JustDown(this.cursors.space)){const t=this.icons[this.currentIconIndex];t&&!this.navigationPoints[this.currentIconIndex].answered&&this.handleIconClick(t)}}moveToIcon(e,t){this.isMoving||(this.isMoving=!0,e.x>this.player.x?(this.player.play("walk",!0),this.player.setFlipX(!1)):(this.player.play("walk",!0),this.player.setFlipX(!0)),this.tweens.add({targets:this.player,x:e.x,y:e.y,duration:500,ease:"Linear",onComplete:()=>{this.player.anims.stop(),this.isMoving=!1,this.currentIconIndex=t}}))}markIconAsAnswered(e){const t=this.navigationPoints.find(s=>s.name===e);t&&(t.answered=!0,this.answeredIcons.push(e),this.navigationPoints.every(s=>s.answered)&&this.events.emit("allIconsAnswered"))}initScene(e){}setupLoadErrorHandlers(){this.load.on("loaderror",e=>{console.error("Error loading file:",e.key),e.type==="image"?this.handleImageError(e):e.type==="audio"?this.handleAudioError(e):e.type==="json"&&this.handleConfigError(e)})}handleImageError(e){const t=this.add.graphics();e.key.includes("checkmark")?(t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture(e.key,40,40)):e.key.includes("xmark")&&(t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture(e.key,40,40)),t.destroy()}handleAudioError(e){if(this.game.sound&&this.game.sound.context){const t=this.game.sound.context.createBuffer(2,44100,44100);this.cache.audio.add(e.key,t)}}handleConfigError(e){e.key.includes("map-config")&&(this.mapConfig={zones:[]})}loadCoreAssets(){this.load.json("map-config",a(`data/map${this.currentMap}/map-config.json`)),this.load.json("questions",a("data/questions.json")),this.load.image("checkmark",a("images/checkmark.png")),this.load.image("xmark",a("images/xmark.png"))}loadSceneAssets(){}onAssetsLoaded(){try{if(this.mapConfig=this.cache.json.get("map-config"),this.questions=this.cache.json.get("questions"),!this.mapConfig||!this.mapConfig.zones)throw new Error(`Invalid map config for map ${this.currentMap}`);this.icons=this.mapConfig.zones.map((e,t)=>({x:e.x,y:e.y,name:e.name,index:t,answered:this.answeredIcons.includes(e.name)})),this.isReady=!0,this.events.emit("scene-ready")}catch(e){console.error("Error loading assets:",e),this.handleLoadError(e)}}setupScene(){this.mapConfig&&this.setupMap(this.mapConfig)}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Shield+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),e.join(" ")}onSceneCreate(){this.gameManager&&this.gameManager.setCurrentScene(this),console.log(`Scene ${this.scene.key} created`)}onSceneShutdown(){this.events.off("create",this.onSceneCreate,this),this.events.off("shutdown",this.onSceneShutdown,this),this.events.off("wake",this.onSceneWake,this),this.events.off("sleep",this.onSceneSleep,this),this.cleanup()}onSceneWake(){this.isTransitioning=!1,console.log(`Scene ${this.scene.key} resumed`)}onSceneSleep(){console.log(`Scene ${this.scene.key} paused`)}cleanup(){this.scoreText&&this.scoreText.destroy(),this.player&&this.player.destroy(),this.cleanupScene()}cleanupScene(){}handleLoadError(e){console.error("Scene load error:",e),this.add.text(400,300,"Error loading scene. Restarting...",{fontSize:"24px",fill:"#ff0000",backgroundColor:"#000000",padding:{x:20,y:10}}).setOrigin(.5),this.time.delayedCall(2e3,()=>{this.scene.restart()})}updateScore(e){this.score+=e,this.scoreText&&this.scoreText.setText(`Score: ${this.score}`)}saveProgress(){this.progressManager&&this.progressManager.saveProgress({lastCompletedScene:this.scene.key,score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}setupMap(e){throw new Error("setupMap must be implemented by child class")}getNextSceneKey(){const e=this.scene.key.toLowerCase(),t=e.match(/map(\d+)/),s=e.match(/scene(\d+)/);if(!t||!s)return console.error("Invalid scene key format:",e),"mainmenu";const i=parseInt(t[1]),o=parseInt(s[1]);return o<4?`map${i}scene${o+1}`:i<4?`map${i+1}scene1`:i===4&&o===4?"gameover":"mainmenu"}transitionToNextScene(){if(this.isTransitioning)return;this.isTransitioning=!0,this.saveProgress();const e=this.getNextSceneKey();this.sceneTransition.toSpaceInvaders(this,e,{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap,fromScene:this.scene.key})}showQuestion(e,t){const s=this.add.rectangle(400,300,800,600,0,.9).setDepth(100),i=this.add.container(400,300).setDepth(101),o=this.add.text(0,-150,e.question,{fontSize:"20px",fill:"#ffffff",align:"center",wordWrap:{width:650},lineSpacing:12}).setOrigin(.5).setDepth(101);i.add(o);const n=o.getBounds(),c=this.add.rectangle(0,n.centerY,n.width+60,n.height+40,3355443).setDepth(100);i.add(c),i.sendToBack(c);const r=[...e.incorrect_answers,e.correct_answer];this.shuffleArray(r);const l=c.y+c.height/2+50,p=80,h=r.map((u,d)=>{const f=this.add.text(0,l+d*p,u,{fontSize:"18px",fill:"#ffffff",align:"center",wordWrap:{width:650}}).setOrigin(.5).setDepth(101),g=f.getBounds(),x=this.add.rectangle(0,l+d*p,g.width+40,g.height+20,6710886).setInteractive().setDepth(100);return x.on("pointerover",()=>{x.setFillStyle(8947848),f.setStyle({fill:"#00ff00"})}),x.on("pointerout",()=>{x.setFillStyle(6710886),f.setStyle({fill:"#ffffff"})}),x.on("pointerdown",()=>{const y=u===e.correct_answer;this.handleAnswer(y,t,i,s,e)}),i.add([x,f]),{button:x,text:f}});this.currentQuestion={container:i,background:s,buttons:h}}handleAnswer(e,t,s,i,o){this.currentQuestion.buttons.forEach(({button:p})=>{p.disableInteractive()}),e?(this.updateScore(100),t.setTint(65280)):t.setTint(16711680);const n=this.add.rectangle(400,500,750,120,e?17408:4456448).setDepth(101),c=this.add.text(400,500,o.explanation,{fontSize:"18px",fill:e?"#00ff00":"#ff0000",align:"center",wordWrap:{width:700},lineSpacing:8}).setOrigin(.5).setDepth(102),r=c.getBounds();n.height=r.height+40,n.y=r.centerY;const l=this.add.image(t.x,t.y,e?"checkmark":"xmark").setScale(.5).setDepth(150);t.isAnswered=!0,t.disableInteractive(),this.answeredQuestions++,this.time.delayedCall(4e3,()=>{s.destroy(),i.destroy(),n.destroy(),c.destroy(),l.destroy(),this.answeredQuestions>=5&&this.transitionToNextScene()})}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}}class re extends U{constructor(){super({key:"trivia_master"}),console.log("TriviaMasterScene: Constructor called during scene registration (this is normal)"),this.score=0,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.correctAnswers=0,this.isTransitioning=!1,this.powerUpBitmask=0,this.mapNumber=1,this.sceneNumber=1,this.requiredCorrectAnswers=5,this.boundOnWindowBlur=this.onWindowBlur.bind(this),this.boundOnWindowFocus=this.onWindowFocus.bind(this)}init(e){console.log("TriviaMasterScene: Actually starting scene initialization now",e),this.progressManager=new S,this.sceneTransition=new v,this.powerUpManager=new Q,this.mapNumber=e.mapNumber||1,this.sceneNumber=e.sceneNumber!==void 0?e.sceneNumber:1,this.sceneKey=e.sceneKey||`map${this.mapNumber}scene${this.sceneNumber}`,window.removeEventListener("blur",this.boundOnWindowBlur),window.removeEventListener("focus",this.boundOnWindowFocus),window.addEventListener("blur",this.boundOnWindowBlur),window.addEventListener("focus",this.boundOnWindowFocus),this.events.on("shutdown",this.shutdown,this),this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||this.mapNumber,this.answeredQuestions=0,this.correctAnswers=0,this.powerUpManager.resetSceneProgress(),this.progressManager.saveProgress({lastCompletedScene:this.sceneKey,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),window.removeEventListener("blur",this.boundOnWindowBlur),window.removeEventListener("focus",this.boundOnWindowFocus),window.addEventListener("blur",this.boundOnWindowBlur),window.addEventListener("focus",this.boundOnWindowFocus),console.log("TriviaMasterScene: Scene configuration:",{mapNumber:this.mapNumber,sceneNumber:this.sceneNumber,sceneKey:this.sceneKey})}onWindowBlur(){if(!this.currentQuestion)try{this.scene&&this.scene.isActive&&this.scene.isActive()?this.scene.pause():console.warn("onWindowBlur: Scene is not active, skipping pause.")}catch(e){console.error("Error pausing scene on blur:",e)}}onWindowFocus(){try{this.scene&&this.scene.isPaused&&this.scene.isPaused()?this.scene.resume():console.warn("onWindowFocus: Scene is not paused or not running, skipping resume.")}catch(e){console.error("Error resuming scene on focus:",e)}}preload(){console.log("TriviaMasterScene: Preload started with map:",this.mapNumber,"scene:",this.sceneNumber);const e=`data/map${this.mapNumber}/map-config${this.sceneNumber}.json`;this.load.json("map-config",a(e)),console.log("Loading map config:",e),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png"));const t=`images/map${this.mapNumber}scene${this.sceneNumber}.png`;this.load.image("background",a(t)),console.log("Loading background:",t),this.setupLoadErrorHandlers()}handleAssetLoadError(e){if(console.warn("Creating fallback for:",e.key),e.type==="image"){const t=this.add.graphics();t.fillStyle(6710886),t.fillRect(0,0,64,64),t.lineStyle(2,16777215),t.strokeRect(0,0,64,64);const s=this.add.text(32,32,e.key,{font:"10px Arial",fill:"#ffffff",align:"center"}).setOrigin(.5);t.generateTexture(e.key,64,64),t.destroy(),s.destroy(),console.log("Created fallback image for:",e.key)}else if(e.type==="json"){const t={zones:[{x:400,y:300,icons:[]}]};this.cache.json.add(e.key,t),console.log("Created fallback JSON for:",e.key)}else if(e.type==="audio"){const t=new(window.AudioContext||window.webkitAudioContext),s=t.createBuffer(2,44100,44100),i=t.createBufferSource();i.buffer=s,this.cache.audio.add(e.key,s),console.log("Created silent audio fallback for:",e.key)}}create(){console.log("TriviaMasterScene: Create started");try{const e=this.cache.json.get("map-config");if(this.questions=this.cache.json.get("questions"),!e||!e.zones)throw new Error(`Invalid map config for map${this.mapNumber}scene${this.sceneNumber}`);this.add.image(400,300,"background").setScale(.8),this.setupUI(),this.loadAwsIcons(e),this.progressManager.saveProgress({lastCompletedScene:`map${this.mapNumber}scene${this.sceneNumber}`,currentMap:this.mapNumber,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}catch(e){console.error("Error in create:",e),this.handleSceneError(e)}}setupUI(){this.uiContainer=this.add.container(0,0).setDepth(200);const e=this.add.rectangle(0,0,800,50,0,.7);this.uiContainer.add(e),this.scoreText=this.add.text(10,5,`Score: ${this.score}`,{fontSize:"18px",fill:"#fff",padding:{x:5,y:2}}).setScrollFactor(0),this.uiContainer.add(this.scoreText);const t=this.add.text(400,5,`Map ${this.mapNumber} - Scene ${this.sceneNumber}`,{fontSize:"16px",fill:"#fff",padding:{x:5,y:2}}).setOrigin(.5,0);this.uiContainer.add(t);const s=this.powerUpManager.getPowerUpText().split(" ");let i=600;s.forEach((o,n)=>{const c=this.add.text(i,5,o,{fontSize:"16px",fill:"#00ff00",padding:{x:3,y:2}});i+=c.width+10,this.uiContainer.add(c)}),this.registry.events.on("changedata",this.updateData,this)}updateData(e,t,s){switch(t){case"score":this.score=s,this.scoreText.setText(`Score: ${this.score}`);break;case"powerUpBitmask":this.powerUpBitmask=s,this.powerUpText.setText(this.powerUpManager.getPowerUpText());break;case"currentMap":this.currentMap=s;break}}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5),o=this.add.rectangle(s.x,s.y,48,48,65280,0);o.setStrokeStyle(2,65280),i.box=o,this.setupIconInteraction(i,s),this.icons.push(i)})})}setupIconInteraction(e,t){e.on("pointerover",()=>{e.isAnswered||(e.box.setStrokeStyle(2,16776960),e.setScale(.6),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.box.setStrokeStyle(2,65280),e.setScale(.5),this.hideTooltip())}),e.on("pointerdown",()=>{!e.isAnswered&&!this.isTransitioning&&this.handleIconClick(e,t)})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(o=>i.question.toLowerCase().includes(o.toLowerCase())));s&&this.showQuestion(s,e)}showQuestion(e,t){const s=this.add.container(400,300);s.setDepth(100);const i=this.add.rectangle(0,0,800,600,0,.8);s.add(i);const o=this.add.text(0,-150,e.question,{fontSize:"20px",fill:"#fff",wordWrap:{width:600},align:"center",lineSpacing:5}).setOrigin(.5);s.add(o);let n=[],c="";e.options&&e.answer?(n=Object.entries(e.options).map(([r,l])=>({letter:r,text:l,isCorrect:r===e.answer})),c=e.answer):e.incorrect_answers&&e.correct_answer&&(n=[...e.incorrect_answers,e.correct_answer].map(r=>({text:r,isCorrect:r===e.correct_answer})),c=e.correct_answer),e.options||this.shuffleArray(n),this.currentQuestion={container:s,overlay:i,answers:n,correctAnswer:c},n.forEach((r,l)=>{const p=l*70-50,h=this.add.rectangle(0,p,550,50,3355443).setInteractive({useHandCursor:!0}),u=r.letter?`${r.letter}. ${r.text}`:r.text,d=this.add.text(0,p,u,{fontSize:"16px",fill:"#fff",wordWrap:{width:500},align:"center"}).setOrigin(.5);h.on("pointerover",()=>{h.setFillStyle(6710886),d.setFill("#00ff00")}),h.on("pointerout",()=>{h.setFillStyle(3355443),d.setFill("#fff")}),h.on("pointerdown",()=>{const f=r.isCorrect;this.handleAnswer(f,t,s,e),this.registry.set("score",this.score)}),s.add([h,d])})}handleAnswer(e,t,s,i){if(this.currentQuestion=null,this.answeredQuestions++,e?(this.correctAnswers++,this.score+=100,this.registry.set("score",this.score),this.sound.play("correct")):this.sound.play("wrong"),t.isAnswered=!0,t.setTint(e?65280:16711680),t.disableInteractive(),i.explanation){const o=this.add.text(0,150,i.explanation,{fontSize:"16px",fill:e?"#00ff00":"#ff6666",wordWrap:{width:500},align:"center",backgroundColor:"#000000",padding:{x:6,y:4}}).setOrigin(.5);s.add(o)}this.time.delayedCall(2500,()=>{if(s.destroy(),this.answeredQuestions>=5){if(this.correctAnswers>=this.requiredCorrectAnswers){const o=this.powerUpManager.handleCorrectAnswer();o&&(this.showUpgradeNotification(o),this.registry.set("powerUpBitmask",this.powerUpBitmask))}this.time.delayedCall(1e3,()=>{this.finishQuestions()})}})}showUpgradeNotification(e){const t=this.add.text(400,300,`New Power-Up Unlocked!
${e}`,{fontSize:"32px",fill:"#00ff00",align:"center",backgroundColor:"#000",padding:{x:20,y:10}}).setOrigin(.5).setDepth(1e3);this.tweens.add({targets:t,alpha:{from:1,to:0},duration:2e3,ease:"Power2",onComplete:()=>t.destroy()})}finishQuestions(){const e=`map${this.currentMap}scene${this.sceneNumber}`;if(this.progressManager.setLastCompletedScene(e),this.correctAnswers===5){const s=this.getPowerUpForScene(this.currentMap,this.sceneNumber);s&&(this.progressManager.addPowerUp(s),this.showPowerUpNotification(s))}const t={score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap,fromScene:this.scene.key,nextScene:`map${this.currentMap}scene${this.sceneNumber+1}`};this.sceneTransition?this.sceneTransition.to(this,"space_invaders",t):this.scene.start("space_invaders",t)}getPowerUpForScene(e,t){const s=(e-1)*4+(t-1);return Math.pow(2,s%4)}showPowerUpNotification(e){const t={1:"LIFE +2",2:"CRAFT SIZE +20%",4:"SPEED +100",8:"FIRE RATE +2"},s=this.add.text(400,300,`Perfect Score!
Power-Up Unlocked: ${t[e]}`,{fontSize:"24px",fill:"#fff",align:"center"}).setOrigin(.5);this.tweens.add({targets:s,alpha:{from:1,to:0},y:250,duration:2e3,onComplete:()=>s.destroy()})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(.5).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}handleSceneError(e){console.error("Scene error:",e),this.add.text(400,300,`Error loading scene. Restarting...
`+e.message,{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),console.error("Scene state at error:",{mapNumber:this.mapNumber,sceneNumber:this.sceneNumber,sceneKey:this.sceneKey,assetsLoaded:this.load.isReady()}),this.time.delayedCall(2e3,()=>{this.scene.restart()})}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}setupDiagramScene(){console.log("Setting up diagram scene");const e=`map${this.mapNumber}scene${this.sceneNumber}.png`,t=`map${this.mapNumber}/map-config${this.sceneNumber}.json`;this.add.image(400,300,e).setOrigin(.5);const i=this.cache.json.get(t);if(!i){console.error("Diagram config missing for scene",this.sceneKey);return}this.placeholders=[],i.placeholders.forEach(l=>{const p=this.add.rectangle(l.x,l.y,l.width,l.height,16777215,.2).setStrokeStyle(2,65280);p.expectedIcon=l.expectedIcon,p.filled=!1,this.placeholders.push(p)}),this.diagramIcons=[];const o=i.availableIcons,n=550,c=80,r=100;o.forEach((l,p)=>{const h=`icon_${l}`,u=r+p*c;let d=this.add.image(u,n,h).setInteractive();d.originalX=u,d.originalY=n,this.input.setDraggable(d),d.on("dragstart",()=>{d.setScale(1.2)}),d.on("drag",(f,g,x)=>{d.x=g,d.y=x}),d.on("dragend",(f,g,x,y)=>{let k=null;this.placeholders.forEach(C=>{!C.filled&&Phaser.Geom.Intersects.RectangleToRectangle(d.getBounds(),C.getBounds())&&(k=C)}),k&&d.texture.key.endsWith(k.expectedIcon)?(d.x=k.x,d.y=k.y,d.setScale(1),k.filled=!0,d.disableInteractive()):this.tweens.add({targets:d,x:d.originalX,y:d.originalY,duration:500,ease:"Power2"}),this.checkDiagramCompletion()}),this.diagramIcons.push(d)}),this.time.delayedCall(1e4,()=>{this.placeholders.forEach(l=>{l.filled||(this.add.rectangle(l.x,l.y,l.width,l.height,0).setOrigin(.5).setStrokeStyle(2,16711680),l.filled=!0)}),this.checkDiagramCompletion()},[],this)}checkDiagramCompletion(){this.placeholders.every(t=>t.filled)&&(console.log("Diagram completed successfully"),this.triggerDiagramTransition())}triggerDiagramTransition(){const e=this.getNextSceneKey(),t=e.match(/map(\d+)scene(\d+)/);if(t){const s=parseInt(t[1],10),i=parseInt(t[2],10);this.sceneTransition.to(this,"trivia_master",{mapNumber:s,sceneNumber:i,score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}else console.warn("Invalid nextTriviaSceneKey:",e),this.sceneTransition.toSpaceInvaders(this)}shutdown(){window.removeEventListener("blur",this.boundOnWindowBlur),window.removeEventListener("focus",this.boundOnWindowFocus)}}class ce extends U{constructor(){super({key:"map1scene1"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v,this.isActive=!1,this.isPaused=!1}init(e){this.isActive=!0,this.isPaused=!1,this.fromScene=e==null?void 0:e.fromScene,this.score=(e==null?void 0:e.score)||0,this.powerUpBitmask=(e==null?void 0:e.powerUpBitmask)||0,this.currentMap=(e==null?void 0:e.currentMap)||1,this.events.on("sceneCleanup",this.cleanup,this),this.events.on("scenePause",this.pause,this),this.events.on("sceneResume",this.resume,this),this.events.on("sceneEnd",this.end,this),this.sceneTransition.setCurrentScene(this)}preload(){this.load.image("map1scene1",a("images/map1scene1.png")),this.load.json("map-config",a("data/map1/map-config.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png"));try{this.load.audio("click",a("sounds/click.mp3")),this.load.audio("correct",a("sounds/correct.mp3")),this.load.audio("wrong",a("sounds/wrong.mp3")),this.load.on("loaderror",e=>{console.warn("Error loading audio:",e.key),this.cache.audio.add(e.key,new Audio)})}catch(e){console.warn("Error setting up audio:",e)}}create(){this.add.image(400,300,"map1scene1").setOrigin(.5),this.setupUI();try{this.questions=this.cache.json.get("questions");const t=this.cache.json.get("map-config");if(!t||!t.zones)throw new Error("Invalid map config structure");this.loadAwsIcons(t),this.cameras.main.fadeIn(500)}catch(t){console.error("Error in create:",t),this.add.text(400,300,t.message,{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5)}}setupUI(){const e=this.add.container(0,0),t=this.add.rectangle(400,30,800,60,0,.7);this.scoreText=this.add.text(20,20,`Score: ${this.score}`,{fontSize:"24px",fontStyle:"bold",fill:"#fff"});const s=[];this.powerUpBitmask&1&&s.push("❤️"),this.powerUpBitmask&2&&s.push("⚡"),this.powerUpBitmask&4&&s.push("🛡️"),this.powerUpBitmask&8&&s.push("🔥");const i=this.add.text(200,20,s.join(" "),{fontSize:"24px",fill:"#fff"});e.add([t,this.scoreText,i]),e.setDepth(100)}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon:",s.name,"from path:",i),this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`;console.log("Creating icon:",i);const o=this.add.image(s.x,s.y,i).setInteractive().setScale(1),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setTint(13421772),this.playSound("click"))}),e.on("pointerout",()=>{e.isAnswered||e.setTint(16777215)}),e.on("pointerdown",()=>{!e.isAnswered&&!this.clickCooldown&&(this.handleIconClick(e,t),this.clickCooldown=!0,setTimeout(()=>{this.clickCooldown=!1},500))})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(o=>i.question.toLowerCase().includes(o.toLowerCase())));s&&this.showQuestion(s,e)}showQuestion(e,t){const c=this.add.container(400,300);c.setDepth(100);const r=this.add.text(0,0,e.question,{fontSize:"20px",fontStyle:"bold",fill:"#fff",align:"center",wordWrap:{width:680-20*2}}).setOrigin(.5),l=r.getBounds(),p=this.add.rectangle(0,0,680,l.height+20*2,3355443,.95).setOrigin(.5);r.setY(-600/4),p.setY(r.y);const h=Object.entries(e.options),u=680-20*4;let d=r.y+l.height+20*3;const f=h.map(([x,y])=>{const k=this.add.rectangle(0,d,u,50,6710886).setInteractive(),C=this.add.text(0,d,`${x}: ${y}`,{fontSize:"18px",fontStyle:"bold",fill:"#fff",align:"center"}).setOrigin(.5);return d+=70,this.setupAnswerButton(k,C,x===e.answer,t,c),{button:k,text:C}});c.add([p,r]),f.forEach(({button:x,text:y})=>c.add([x,y])),f.forEach(({button:x,text:y})=>{y.setWordWrapWidth(u-20*2),y.setAlign("center")});const g=this.add.rectangle(800/2,600/2,800,600,0,.7).setDepth(99);c.fullBg=g}setupAnswerButton(e,t,s,i,o){let n=!1;e.on("pointerover",()=>{n||(e.setFillStyle(8947848),t.setColor("#ffff00"),this.playSound("click"))}),e.on("pointerout",()=>{n||(e.setFillStyle(6710886),t.setColor("#ffffff"))}),e.on("pointerdown",()=>{n||(n=!0,e.setFillStyle(s?43520:11141120),t.setColor(s?"#00ff00":"#ff0000"),this.handleAnswer(s,i,o))})}handleAnswer(e,t,s){this.playSound(e?"correct":"wrong"),e?(this.score+=100,this.scoreText.setText(`Score: ${this.score}`),t.setTint(65280),this.add.image(t.x,t.y,"checkMark").setScale(1).setDepth(50)):(t.setTint(16711680),this.add.image(t.x,t.y,"xMark").setScale(1).setDepth(50)),t.isAnswered=!0,t.disableInteractive(),this.time.delayedCall(3e3,()=>{s.fullBg.destroy(),s.destroy(),this.answeredQuestions++,this.answeredQuestions===5&&this.transitionToNextScene()})}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map1scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map1scene2",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}playSound(e){try{this.sound&&this.cache.audio.exists(e)&&this.sound.play(e,{volume:.5})}catch(t){console.warn("Error playing sound:",e,t)}}cleanup(){this.currentQuestion&&(this.currentQuestion.background.destroy(),this.currentQuestion.container.destroy(),this.currentQuestion=null)}pause(){this.isPaused=!0}resume(){this.isPaused=!1}end(){this.isActive=!1,this.cleanup()}}class he extends U{constructor(){super({key:"map1scene2"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1,this.progressManager.saveProgress({lastCompletedScene:"map1scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}preload(){super.preload(),this.load.image("map1scene2",a("images/map1scene2.png")),this.load.json("map-config",a("data/map1/map-config2.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png"));try{this.load.audio("click",a("sounds/click.mp3")),this.load.audio("correct",a("sounds/correct.mp3")),this.load.audio("wrong",a("sounds/wrong.mp3")),this.load.on("loaderror",e=>{console.warn("Error loading audio:",e.key),this.cache.audio.add(e.key,new Audio)})}catch(e){console.warn("Error setting up audio:",e)}}getNextSceneKey(){return"map1scene3"}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config"),t=e.zones[0];this.add.image(t.x,t.y,"map1scene2").setScale(t.scale),this.loadAwsIcons(e),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const i=this.cache.json.get("map-config2");if(!i||!i.zones)throw new Error("Invalid map config structure");const n=i.zones[1]||i.zones[0];if(!n)throw new Error("No valid zone found in config");const c=this.add.image(n.x||400,n.y||300,"map1scene2");c.setOrigin(.5);const r=this.cameras.main.width/c.width,l=this.cameras.main.height/c.height,p=Math.max(r,l);c.setScale(p),this.loadAwsIcons(i),this.sceneTransition.fadeIn()}catch(i){console.error("Error in create:",i),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map1gamescene2")},2e3)}}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon:",s.name,"from path:",i),this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`;console.log("Creating icon:",i);const o=this.add.image(s.x,s.y,i).setInteractive().setScale(.5),n=o.getBounds(),c=this.add.rectangle(s.x,s.y,n.width,n.height,65280,0);c.setStrokeStyle(2,65280),o.box=c,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.inCooldown=!1,this.tweens.add({targets:e,scale:{from:.5,to:.55},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerover",()=>{!e.isAnswered&&!e.inCooldown&&(this.tweens.add({targets:e,scale:.6,duration:200}),e.preFX.addGlow(16777215,.5),this.sound.play("click",{volume:.5}))}),e.on("pointerout",()=>{!e.isAnswered&&!e.inCooldown&&(this.tweens.add({targets:e,scale:.5,duration:200}),e.preFX.clear())})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(.5).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){if(this.isTransitioning)return;const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o);let n=!1;Object.entries(e.options).forEach(([c,r])=>{const l=document.createElement("div");l.className="option";const p=document.createElement("span");p.className="option-letter",p.textContent=c;const h=document.createElement("span");h.className="option-text",h.textContent=r,l.appendChild(p),l.appendChild(h),l.addEventListener("click",()=>{if(n)return;n=!0;const u=c===e.answer;u&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const d=u?"checkMark":"xMark",f=this.add.image(t.x,t.y,d).setScale(.5).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const g=document.createElement("div");g.className="explanation",g.textContent=e.explanation,s.appendChild(g)}this.answeredQuestions===5&&(this.isTransitioning=!0),setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),f.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),this.cameras.main.fade(1e3,0,0,0,!1,(g,x)=>{x===1&&this.scene.start("map1gamescene2",{nextScene:"space_invaders",score:this.score})}))},2e3)}),s.appendChild(l)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,`Score: ${this.score}`,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map1scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map1scene3",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class le extends U{constructor(){super({key:"map1scene3"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1,this.progressManager.saveProgress({lastCompletedScene:"map1scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map1scene3",a("images/map1scene3.png")),this.load.json("map-config3",a("data/map1/map-config3.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config3");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[2]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map1gamescene3");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map1gamescene3")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(n=>s.questionTypes.some(c=>n.question.toLowerCase().includes(c.toLowerCase())));if(i&&i.image)console.log("Loading icon from question:",i.image),this.load.image(`icon_${s.name}`,i.image);else{const n=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon with constructed path:",n),this.load.image(`icon_${s.name}`,n)}const o=`/assets/images/services16/${s.category}/48/${s.name}`;this.load.image(`icon_${s.name}`,o)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);console.log("Creating icon sprite:",s.name),this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map1gamescene4"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map1scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map1scene4",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class de extends U{constructor(){super({key:"map1scene4"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1,this.progressManager.saveProgress({lastCompletedScene:"map1scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map1scene4",a("images/map1scene4.png")),this.load.json("map-config4",a("data/map1/map-config4.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config4");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[3]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map1gamescene4");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map1gamescene4")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(n=>s.questionTypes.some(c=>n.question.toLowerCase().includes(c.toLowerCase())));if(i&&i.image)console.log("Loading icon from question:",i.image),this.load.image(`icon_${s.name}`,i.image);else{const n=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon with constructed path:",n),this.load.image(`icon_${s.name}`,n)}const o=`/assets/images/services16/${s.category}/48/${s.name}`;this.load.image(`icon_${s.name}`,o)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);console.log("Creating icon sprite:",s.name),this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map2gamescene1"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map1scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map2scene1",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class pe extends U{constructor(){super({key:"map2scene1"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=2,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||2,this.progressManager.saveProgress({lastCompletedScene:"map2scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map2scene1",a("images/map2scene1.png")),this.load.json("map-config",a("data/map2/map-config.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config");if(!e||!e.zones)throw new Error("Invalid map config structure");if(!(e.zones[0]||e.zones[0]))throw new Error("No valid zone found in config");const i=this.add.image(400,300,"map2scene1");i.setOrigin(.5);const o=800/i.width,n=600/i.height,c=Math.min(o,n);i.setScale(c),i.x=400,i.y=300,this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map2scene1")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon:",s.name,"from path:",i),this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`;console.log("Creating icon:",i);const o=this.add.image(s.x,s.y,i).setInteractive().setScale(1),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||e.setTint(13421772)}),e.on("pointerout",()=>{e.isAnswered||e.setTint(16777215)}),e.on("pointerdown",()=>{!e.isAnswered&&!this.clickCooldown&&(this.handleIconClick(e,t),this.clickCooldown=!0,setTimeout(()=>{this.clickCooldown=!1},500))})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(o=>i.question.toLowerCase().includes(o.toLowerCase())));s&&this.showQuestion(s,e)}showQuestion(e,t){const s=this.add.rectangle(400,300,800,600,0,.8).setDepth(100),i=this.add.rectangle(400,150,750,100,3355443).setDepth(101),o=this.add.text(400,150,e.question,{fontSize:"24px",fill:"#fff",align:"center",wordWrap:{width:700},lineSpacing:10}).setOrigin(.5).setDepth(102),n=Object.entries(e.options),c=250,r=70;let l=!1;const p=n.map(([h,u],d)=>{const f=c+d*r,g=this.add.rectangle(400,f,600,50,3355443).setInteractive().setDepth(101),x=this.add.text(400,f,`${h}: ${u}`,{fontSize:"20px",fill:"#fff",wordWrap:{width:550},align:"center"}).setOrigin(.5).setDepth(102);return g.on("pointerover",()=>{l||g.setFillStyle(6710886)}),g.on("pointerout",()=>{l||g.setFillStyle(3355443)}),g.on("pointerdown",()=>{if(l)return;l=!0;const y=h===e.answer;y?(this.score+=100,this.scoreText.setText(`Score: ${this.score}`),t.setTint(65280),this.add.image(t.x,t.y,"checkMark").setScale(1).setDepth(50)):(t.setTint(16711680),this.add.image(t.x,t.y,"xMark").setScale(1).setDepth(50)),t.isAnswered=!0,t.disableInteractive();const k=this.add.rectangle(400,500,750,100,y?17408:4456448).setDepth(101),C=this.add.text(400,500,e.explanation,{fontSize:"20px",fill:y?"#00ff00":"#ff0000",align:"center",wordWrap:{width:700},lineSpacing:5}).setOrigin(.5).setDepth(102);setTimeout(()=>{s.destroy(),i.destroy(),o.destroy(),k.destroy(),C.destroy(),p.forEach(({button:P,text:A})=>{P.destroy(),A.destroy()}),this.answeredQuestions++,this.answeredQuestions===5&&this.transitionToNextScene()},3e3)}),{button:g,text:x}})}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map2scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.fadeOut(()=>{this.scene.start("sort_selection",{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}))}}class fe extends U{constructor(){super({key:"map2scene2"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=2,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||2,this.progressManager.saveProgress({lastCompletedScene:"map2scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map2scene2",a("images/map2scene2.png")),this.load.json("map-config2",a("data/map2/map-config2.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config2");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[1]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map2scene2");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map2scene2")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon:",s.name,"from path:",i),this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`;console.log("Creating icon:",i);const o=this.add.image(s.x,s.y,i).setInteractive().setScale(1),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||e.setTint(13421772)}),e.on("pointerout",()=>{e.isAnswered||e.setTint(16777215)}),e.on("pointerdown",()=>{!e.isAnswered&&!this.clickCooldown&&(this.handleIconClick(e,t),this.clickCooldown=!0,setTimeout(()=>{this.clickCooldown=!1},500))})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(o=>i.question.toLowerCase().includes(o.toLowerCase())));s&&this.showQuestion(s,e)}showQuestion(e,t){const s=this.add.rectangle(400,300,800,600,0,.8).setDepth(100),i=this.add.rectangle(400,150,750,100,3355443).setDepth(101),o=this.add.text(400,150,e.question,{fontSize:"24px",fill:"#fff",align:"center",wordWrap:{width:700},lineSpacing:10}).setOrigin(.5).setDepth(102),n=Object.entries(e.options),c=250,r=70;let l=!1;const p=n.map(([h,u],d)=>{const f=c+d*r,g=this.add.rectangle(400,f,600,50,3355443).setInteractive().setDepth(101),x=this.add.text(400,f,`${h}: ${u}`,{fontSize:"20px",fill:"#fff",wordWrap:{width:550},align:"center"}).setOrigin(.5).setDepth(102);return g.on("pointerover",()=>{l||g.setFillStyle(6710886)}),g.on("pointerout",()=>{l||g.setFillStyle(3355443)}),g.on("pointerdown",()=>{if(l)return;l=!0;const y=h===e.answer;y?(this.score+=100,this.scoreText.setText(`Score: ${this.score}`),t.setTint(65280),this.add.image(t.x,t.y,"checkMark").setScale(1).setDepth(50)):(t.setTint(16711680),this.add.image(t.x,t.y,"xMark").setScale(1).setDepth(50)),t.isAnswered=!0,t.disableInteractive();const k=this.add.rectangle(400,500,750,100,y?17408:4456448).setDepth(101),C=this.add.text(400,500,e.explanation,{fontSize:"20px",fill:y?"#00ff00":"#ff0000",align:"center",wordWrap:{width:700},lineSpacing:5}).setOrigin(.5).setDepth(102);setTimeout(()=>{s.destroy(),i.destroy(),o.destroy(),k.destroy(),C.destroy(),p.forEach(({button:P,text:A})=>{P.destroy(),A.destroy()}),this.answeredQuestions++,this.answeredQuestions===5&&this.transitionToNextScene()},3e3)}),{button:g,text:x}})}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map2scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map2scene3",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class ue extends U{constructor(){super({key:"map2scene3"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=2,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||2,this.progressManager.saveProgress({lastCompletedScene:"map2scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map2scene3",a("images/map2scene3.png")),this.load.json("map-config3",a("data/map2/map-config3.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config3");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[2]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map2scene3");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map2scene3")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon:",s.name,"from path:",i),this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`;console.log("Creating icon:",i);const o=this.add.image(s.x,s.y,i).setInteractive().setScale(1),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||e.setTint(13421772)}),e.on("pointerout",()=>{e.isAnswered||e.setTint(16777215)}),e.on("pointerdown",()=>{!e.isAnswered&&!this.clickCooldown&&(this.handleIconClick(e,t),this.clickCooldown=!0,setTimeout(()=>{this.clickCooldown=!1},500))})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(o=>i.question.toLowerCase().includes(o.toLowerCase())));s&&this.showQuestion(s,e)}showQuestion(e,t){const s=this.add.rectangle(400,300,800,600,0,.8).setDepth(100),i=this.add.rectangle(400,150,750,100,3355443).setDepth(101),o=this.add.text(400,150,e.question,{fontSize:"24px",fill:"#fff",align:"center",wordWrap:{width:700},lineSpacing:10}).setOrigin(.5).setDepth(102),n=Object.entries(e.options),c=250,r=70;let l=!1;const p=n.map(([h,u],d)=>{const f=c+d*r,g=this.add.rectangle(400,f,600,50,3355443).setInteractive().setDepth(101),x=this.add.text(400,f,`${h}: ${u}`,{fontSize:"20px",fill:"#fff",wordWrap:{width:550},align:"center"}).setOrigin(.5).setDepth(102);return g.on("pointerover",()=>{l||g.setFillStyle(6710886)}),g.on("pointerout",()=>{l||g.setFillStyle(3355443)}),g.on("pointerdown",()=>{if(l)return;l=!0;const y=h===e.answer;y?(this.score+=100,this.scoreText.setText(`Score: ${this.score}`),t.setTint(65280),this.add.image(t.x,t.y,"checkMark").setScale(1).setDepth(50)):(t.setTint(16711680),this.add.image(t.x,t.y,"xMark").setScale(1).setDepth(50)),t.isAnswered=!0,t.disableInteractive();const k=this.add.rectangle(400,500,750,100,y?17408:4456448).setDepth(101),C=this.add.text(400,500,e.explanation,{fontSize:"20px",fill:y?"#00ff00":"#ff0000",align:"center",wordWrap:{width:700},lineSpacing:5}).setOrigin(.5).setDepth(102);setTimeout(()=>{s.destroy(),i.destroy(),o.destroy(),k.destroy(),C.destroy(),p.forEach(({button:P,text:A})=>{P.destroy(),A.destroy()}),this.answeredQuestions++,this.answeredQuestions===5&&this.transitionToNextScene()},3e3)}),{button:g,text:x}})}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map2scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map2scene4",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class me extends U{constructor(){super({key:"map2scene4"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=2,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||2,this.progressManager.saveProgress({lastCompletedScene:"map2scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map2scene4",a("images/map2scene4.png")),this.load.json("map-config4",a("data/map2/map-config4.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config4");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[3]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map2scene4");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map2scene4")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5),o=this.add.rectangle(s.x,s.y,48,48,65280,0);o.setStrokeStyle(2,65280),i.box=o,this.setupIconInteraction(i,s),this.icons.push(i)})})}setupIconInteraction(e,t){e.on("pointerover",()=>{e.box.setStrokeStyle(2,16776960),e.setScale(.6)}),e.on("pointerout",()=>{e.box.setStrokeStyle(2,65280),e.setScale(.5)}),e.on("pointerdown",()=>{this.clickCooldown||this.handleIconClick(e,t)})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(o=>i.question.toLowerCase().includes(o.toLowerCase())));s&&this.showQuestion(s,i=>{this.handleQuestionAnswered(i),i&&(e.setTint(65280),e.box.setStrokeStyle(2,65280))})}showQuestion(e,t){const s=this.add.rectangle(0,0,800,600,0,.8).setOrigin(0).setDepth(100),i=this.add.container(400,300);i.setDepth(101);const o=this.add.text(0,-100,e.question,{fontSize:"24px",fill:"#fff",wordWrap:{width:600},align:"center"}).setOrigin(.5);i.add(o);const n=[...e.incorrect_answers,e.correct_answer];this.shuffleArray(n),n.forEach((c,r)=>{const l=r*60-90,p=this.createAnswerButton(0,l,c);p.setInteractive({useHandCursor:!0}).on("pointerdown",()=>{const h=c===e.correct_answer;this.add.image(p.x+150,p.y,h?"checkmark":"xmark").setScale(.5),i.list.forEach(u=>{u.removeInteractive&&u.removeInteractive()}),this.time.delayedCall(1e3,()=>{i.destroy(),s.destroy(),t&&t(h)})}),i.add(p)})}createAnswerButton(e,t,s){const i=this.add.container(e,t),o=this.add.rectangle(0,0,400,50,3355443).setStrokeStyle(2,65280),n=this.add.text(0,0,s,{fontSize:"20px",fill:"#fff"}).setOrigin(.5);return i.add([o,n]),o.setInteractive().on("pointerover",()=>{o.setFillStyle(6710886),n.setStyle({fill:"#00ff00"})}).on("pointerout",()=>{o.setFillStyle(3355443),n.setStyle({fill:"#ffffff"})}),i}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map2gamescene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.fadeOut(()=>{this.scene.start("sort_selection",{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}))}}class ge extends U{constructor(){super({key:"map3scene1"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=3,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||3,this.progressManager.saveProgress({lastCompletedScene:"map3scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}preload(){this.load.scene("map3gamescene1",a("images/map3gamescene1.png")),this.load.json("map-config",a("data/map3/map-config.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[0]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map3gamescene1");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map3gamescene1")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(o=>s.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));if(i&&i.image)this.load.image(`icon_${s.name}`,a(i.image));else{const o=`images/services16/${s.category}/48/${s.name}`;this.load.image(`icon_${s.name}`,a(o))}})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5),o=this.add.rectangle(s.x,s.y,48,48,65280,0);o.setStrokeStyle(2,65280),i.box=o,this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map3gamescene2"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map3scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map3scene2",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class xe extends U{constructor(){super({key:"map3scene2"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=3,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||3,this.progressManager.saveProgress({lastCompletedScene:"map3scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}preload(){this.load.scene("map3gamescene2",a("images/map3gamescene2.png")),this.load.json("map-config2",a("data/map3/map-config2.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config2");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[1]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map3gamescene2");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map3gamescene2")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=a(`images/services16/${s.category}/48/${s.name}`);this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`,o=this.add.image(s.x,s.y,i).setInteractive().setScale(.5),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map3gamescene3"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map3scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map3scene3",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class we extends U{constructor(){super({key:"map3scene3"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=3,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||3,this.progressManager.saveProgress({lastCompletedScene:"map3scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}preload(){this.load.scene("map3gamescene3",a("images/map3gamescene3.png")),this.load.json("map-config3",a("data/map3/map-config3.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config3");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[2]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map3gamescene3");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map3gamescene3")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=a(`images/services16/${s.category}/48/${s.name}`);this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`,o=this.add.image(s.x,s.y,i).setInteractive().setScale(.5),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map3gamescene4"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map3scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map3scene4",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class ye extends U{constructor(){super({key:"map3scene4"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=3,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||3,this.progressManager.saveProgress({lastCompletedScene:"map3scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}preload(){this.load.scene("map3gamescene4",a("images/map3gamescene4.png")),this.load.json("map-config4",a("data/map3/map-config4.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.add.rectangle(400,300,800,600,0,.8),this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1),this.setupScore(),this.powerUpText=this.add.text(16,56,this.getPowerUpText(),{fontSize:"24px",fill:"#00ff00",fontFamily:"Arial"});try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config4");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[3]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map3gamescene4");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.sceneTransition.fadeIn()}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map3gamescene4")},2e3)}}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),`Power-ups: ${e.join(" ")}`}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=a(`images/services16/${s.category}/48/${s.name}`);this.load.image(`icon_${s.name}`,i)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=`icon_${s.name}`,o=this.add.image(s.x,s.y,i).setInteractive().setScale(.5),n=this.add.rectangle(s.x,s.y,48,48,65280,0);n.setStrokeStyle(2,65280),o.box=n,this.setupIconInteraction(o,s),this.icons.push(o)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map4gamescene1"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: "+this.score,{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map3scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map4scene1",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class ke extends U{constructor(){super({key:"map4scene1"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=4,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v,this.isActive=!1,this.isPaused=!1,this.draggedIcon=null,this.dropZones=[]}init(e){this.isActive=!0,this.isPaused=!1,this.fromScene=e==null?void 0:e.fromScene,this.score=(e==null?void 0:e.score)||0,this.powerUpBitmask=(e==null?void 0:e.powerUpBitmask)||0,this.currentMap=(e==null?void 0:e.currentMap)||4,this.events.on("sceneCleanup",this.cleanup,this),this.events.on("scenePause",this.pause,this),this.events.on("sceneResume",this.resume,this),this.events.on("sceneEnd",this.end,this),this.sceneTransition.setCurrentScene(this),this.progressManager.saveProgress({lastCompletedScene:"map4scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.cameras.main.fadeIn(500)}preload(){this.load.scene("map4gamescene1",a("images/map4gamescene1.png")),this.load.json("map-config",a("data/map4/map-config.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1);try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config");if(!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[0]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map4gamescene1");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.setupScore(),this.progressManager.saveProgress({lastCompletedScene:"map4scene1",currentMap:this.currentMap})}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map4scene1")},2e3)}this.setupUI(),this.setupDragAndDrop()}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(o=>s.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));if(i&&i.image)console.log("Loading icon from question:",i.image),this.load.image(`icon_${s.name}`,a(i.image));else{const o=`images/services16/${s.category}/48/${s.name}`;console.log("Loading icon with constructed path:",o),this.load.image(`icon_${s.name}`,a(o))}})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);console.log("Creating icon sprite:",s.name),this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map4scene2"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}setupUI(){const e=this.add.container(0,0),t=this.add.rectangle(400,30,800,60,0,.7);this.scoreText=this.add.text(20,20,`Score: ${this.score}`,{fontSize:"24px",fontStyle:"bold",fill:"#fff"});const s=[];this.powerUpBitmask&1&&s.push("❤️"),this.powerUpBitmask&2&&s.push("⚡"),this.powerUpBitmask&4&&s.push("🛡️"),this.powerUpBitmask&8&&s.push("🔥");const i=this.add.text(200,20,s.join(" "),{fontSize:"24px",fill:"#fff"});e.add([t,this.scoreText,i]),e.setDepth(100)}setupDragAndDrop(){const e=this.cache.json.get("map-config");!e||!e.zones||e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.startX,s.startY,`icon_${s.name}`).setInteractive({draggable:!0}).setScale(.8),o=this.add.rectangle(s.x,s.y,64,64,65280,.2).setOrigin(.5).setInteractive();this.dropZones.push({zone:o,correctIcon:s.name}),i.on("dragstart",()=>{this.draggedIcon=i,i.setTint(65280)}),i.on("drag",(n,c,r)=>{i.x=c,i.y=r}),i.on("dragend",()=>{this.checkIconPlacement(i,s)})})})}checkIconPlacement(e,t){let s=!1;this.dropZones.forEach(({zone:i,correctIcon:o})=>{m.Geom.Rectangle.Contains(i.getBounds(),e.x,e.y)&&(o===t.name?(e.setPosition(i.x,i.y),e.setTint(65280),e.input.draggable=!1,this.score+=100,this.scoreText.setText(`Score: ${this.score}`),this.answeredQuestions++,s=!0,this.answeredQuestions===this.dropZones.length&&this.time.delayedCall(1e3,()=>this.transitionToNextScene())):(e.setPosition(t.startX,t.startY),e.setTint(16711680),this.time.delayedCall(500,()=>e.clearTint())))}),s||(e.setPosition(t.startX,t.startY),e.clearTint())}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map4scene1",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.toSpaceInvaders(this,"map4scene2",{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}cleanup(){this.draggedIcon=null,this.dropZones=[]}pause(){this.isPaused=!0}resume(){this.isPaused=!1}end(){this.isActive=!1,this.cleanup()}}class Te extends U{constructor(){super({key:"map4scene2"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=4,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||4,this.progressManager.saveProgress({lastCompletedScene:"map4scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map4gamescene2",a("images/map4gamescene2.png")),this.load.json("map-config2",a("data/map4/map-config2.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1);try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config2");if(console.log("MapConfig loaded:",e),!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[1]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map4gamescene2");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.setupScore(),this.progressManager.saveProgress({lastCompletedScene:"map4scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map4scene2")},2e3)}}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(o=>s.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));if(i&&i.image)console.log("Loading icon from question:",i.image),this.load.image(`icon_${s.name}`,i.image);else{const o=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon with constructed path:",o),this.load.image(`icon_${s.name}`,o)}})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);console.log("Creating icon sprite:",s.name),this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map4scene3"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map4scene2",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map4scene3",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class Se extends U{constructor(){super({key:"map4scene3"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=4,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||4,this.progressManager.saveProgress({lastCompletedScene:"map4scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map4gamescene3",a("images/map4gamescene3.png")),this.load.json("map-config3",a("data/map4/map-config3.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1);try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config3");if(console.log("MapConfig loaded:",e),!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[2]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map4gamescene3");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.setupScore(),this.progressManager.saveProgress({lastCompletedScene:"map4scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map4scene3")},2e3)}}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(n=>s.questionTypes.some(c=>n.question.toLowerCase().includes(c.toLowerCase())));if(i&&i.image)console.log("Loading icon from question:",i.image),this.load.image(`icon_${s.name}`,i.image);else{const n=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon with constructed path:",n),this.load.image(`icon_${s.name}`,n)}const o=`/assets/images/services16/${s.category}/48/${s.name}`;this.load.image(`icon_${s.name}`,o)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);console.log("Creating icon sprite:",s.name),this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"map4scene4"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map4scene3",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"map4scene4",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}class ve extends U{constructor(){super({key:"map4scene4"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=4,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.progressManager=new S,this.sceneTransition=new v}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||4,this.progressManager.saveProgress({lastCompletedScene:"map4scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}preload(){this.load.scene("map4gamescene4",a("images/map4gamescene4.png")),this.load.json("map-config4",a("data/map4/map-config4.json")),this.load.json("questions",a("data/questions.json")),this.load.image("checkMark",a("images/checkmark.png")),this.load.image("xMark",a("images/xmark.png")),this.load.on("loaderror",e=>{if(console.error("Error loading file:",e.key),e.key==="checkMark"){const t=this.add.graphics();t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture("checkMark",40,40),t.destroy()}else if(e.key==="xMark"){const t=this.add.graphics();t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture("xMark",40,40),t.destroy()}})}create(){this.sound&&this.sound.context&&(this.sound.pauseOnBlur=!1);try{this.questions=this.cache.json.get("questions");const e=this.cache.json.get("map-config4");if(console.log("MapConfig loaded:",e),!e||!e.zones)throw new Error("Invalid map config structure");const s=e.zones[3]||e.zones[0];if(!s)throw new Error("No valid zone found in config");const i=this.add.image(s.x||400,s.y||300,"map4gamescene4");i.setOrigin(.5),i.setScale(s.scale||1),this.loadAwsIcons(e),this.setupScore(),this.progressManager.saveProgress({lastCompletedScene:"map4scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score})}catch(e){console.error("Error in create:",e),this.add.text(400,300,"Error loading level. Restarting...",{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),setTimeout(()=>{this.scene.start("map4scene4")},2e3)}}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.questions.find(n=>s.questionTypes.some(c=>n.question.toLowerCase().includes(c.toLowerCase())));if(i&&i.image)console.log("Loading icon from question:",i.image),this.load.image(`icon_${s.name}`,i.image);else{const n=`assets/images/services16/${s.category}/48/${s.name}`;console.log("Loading icon with constructed path:",n),this.load.image(`icon_${s.name}`,n)}const o=`/assets/images/services16/${s.category}/48/${s.name}`;this.load.image(`icon_${s.name}`,o)})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);console.log("Creating icon sprite:",s.name),this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}setupIconInteraction(e,t){e.setTint(16777215),e.isAnswered=!1,e.on("pointerover",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(65280),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.setScale(1.3),e.setTint(16777215),this.hideTooltip())}),this.tweens.add({targets:e,scale:{from:1,to:1.4},duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),e.on("pointerdown",()=>{if(e.isAnswered)return;let s,i=this.questions.filter(o=>t.questionTypes.some(n=>o.question.toLowerCase().includes(n.toLowerCase())));i.length===0&&(i=this.questions),s=m.Utils.Array.GetRandom(i),this.showQuestion(s,e)})}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(1).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}showQuestion(e,t){const s=document.createElement("div");s.className="question-container";const i=document.createElement("div");i.className="overlay";const o=document.createElement("div");o.className="question",o.textContent=e.question,s.appendChild(o),Object.entries(e.options).forEach(([n,c])=>{const r=document.createElement("div");r.className="option";const l=document.createElement("span");l.className="option-letter",l.textContent=n;const p=document.createElement("span");p.className="option-text",p.textContent=c,r.appendChild(l),r.appendChild(p),r.addEventListener("click",()=>{const h=n===e.answer;h&&(this.score+=100,this.scoreText.setText(`Score: ${this.score}`));const u=h?"checkMark":"xMark",d=this.add.image(t.x,t.y,u).setScale(1).setDepth(150);if(t.isAnswered=!0,t.setAlpha(.5),this.tweens.killTweensOf(t),t.setScale(1),t.disableInteractive(),this.answeredQuestions++,e.explanation){const f=document.createElement("div");f.className="explanation",f.textContent=e.explanation,s.appendChild(f)}setTimeout(()=>{document.body.removeChild(i),document.body.removeChild(s),d.destroy(),this.answeredQuestions===5&&(console.log("All 5 questions answered, transitioning to Space Invaders..."),setTimeout(()=>{this.scene.start("space_invaders",{nextScene:"game_over"})},3e3))},2e3)}),s.appendChild(r)}),document.body.appendChild(i),document.body.appendChild(s)}setupScore(){this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"32px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:"map4scene4",currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{nextScene:"game_over",score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}))}}const Me={type:m.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",dom:{createContainer:!0},scale:{mode:m.Scale.FIT,autoCenter:m.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},render:{pixelArt:!0,powerPreference:"high-performance",antialias:!0,antialiasGL:!0},scene:[se,oe,ae,ne,re,ce,he,le,de,pe,fe,ue,me,ge,xe,we,ye,ke,Te,Se,ve,ie]};window.addEventListener("load",()=>{window.game=new m.Game(Me),window.gameState={score:0,currentMap:1,powerUpBitmask:0,lastScene:null},window.progressManager=new S,document.addEventListener("click",function w(){window.game.sound&&window.game.sound.context.state==="suspended"&&window.game.sound.context.resume(),document.removeEventListener("click",w)}),window.addEventListener("beforeunload",()=>{const w=window.game.scene.getScenes(!0)[0];w&&window.progressManager.saveProgress({lastCompletedScene:w.scene.key,score:window.gameState.score,currentMap:window.gameState.currentMap,powerUpBitmask:window.gameState.powerUpBitmask})})});
