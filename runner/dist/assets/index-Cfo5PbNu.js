import{r as V,g as J}from"./phaser-xmrzIA0s.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var Z=V();const l=J(Z),ee="/assets";function c(f){const e=f.startsWith("/")?f:`/${f}`,t=`${ee}${e}`;return console.log("Asset path requested:",{original:f,normalized:e,full:t}),t}class le extends l.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),this.sprite=e.add.sprite(0,0,i),this.add(this.sprite),e.physics.world.enable(this),this.body.setCollideWorldBounds(!0),this.stats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.powerUpBitmask=0,this.powerUpTypes={LIFE:1,CRAFT:2,SPEED:4,BULLETS:8},this.init()}init(){this.sprite.setScale(this.stats.craftSize),this.body.setSize(this.sprite.width*this.stats.craftSize,this.sprite.height*this.stats.craftSize),this.body.setOffset(-this.sprite.width*this.stats.craftSize/2,-this.sprite.height*this.stats.craftSize/2)}update(e,t,s){if(!this.active)return;const i=this.stats.speed*s/1e3;(e.left.isDown||t.left.isDown)&&this.x>40&&(this.x-=i),(e.right.isDown||t.right.isDown)&&this.x<760&&(this.x+=i),(e.up.isDown||t.up.isDown)&&this.y>40&&(this.y-=i),(e.down.isDown||t.down.isDown)&&this.y<560&&(this.y+=i),this.body.setPosition(this.x,this.y)}addPowerUp(e){this.powerUpBitmask|=e,this.updateStats()}updateStats(){this.stats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.powerUpBitmask&this.powerUpTypes.LIFE&&(this.stats.life+=2),this.powerUpBitmask&this.powerUpTypes.CRAFT&&(this.stats.craftSize=1.2,this.sprite.setScale(this.stats.craftSize),this.body.setSize(this.sprite.width*this.stats.craftSize,this.sprite.height*this.stats.craftSize)),this.powerUpBitmask&this.powerUpTypes.SPEED&&(this.stats.speed+=100),this.powerUpBitmask&this.powerUpTypes.BULLETS&&(this.stats.bulletSpeed+=200,this.stats.fireRate+=2)}takeDamage(){return this.stats.life--,this.scene.tweens.add({targets:this.sprite,alpha:0,duration:100,yoyo:!0,repeat:2}),this.stats.life<=0}getStats(){return{...this.stats}}getPowerUpBitmask(){return this.powerUpBitmask}setPowerUpBitmask(e){this.powerUpBitmask=e,this.updateStats()}reset(){this.powerUpBitmask=0,this.updateStats(),this.sprite.setAlpha(1),this.setActive(!0)}}class pe extends l.GameObjects.Container{constructor(e,t,s,i,r){super(e,t,s),e.add.existing(this),this.config=r,this.isInteractive=!0,this.sprite=e.add.sprite(0,0,i),this.add(this.sprite),this.box=e.add.rectangle(0,0,this.sprite.width+20,this.sprite.height+20,3355443,.8),this.add(this.box),this.sendToBack(this.box),this.border=e.add.rectangle(0,0,this.sprite.width+20,this.sprite.height+20,65280,0),this.border.setStrokeStyle(2,65280),this.add(this.border),this.sendToBack(this.border),this.setSize(this.sprite.width+20,this.sprite.height+20),this.setInteractive(),this.on("pointerover",this.onHover.bind(this)),this.on("pointerout",this.onHoverOut.bind(this)),this.on("pointerdown",this.onClick.bind(this)),this.isAnswered=!1,this.isCorrect=!1}onHover(){this.isInteractive&&(this.scene.tweens.add({targets:[this.sprite,this.box,this.border],scaleX:1.1,scaleY:1.1,duration:100}),this.config.tooltip&&this.showTooltip())}onHoverOut(){this.isInteractive&&(this.scene.tweens.add({targets:[this.sprite,this.box,this.border],scaleX:1,scaleY:1,duration:100}),this.hideTooltip())}onClick(){this.isInteractive&&this.emit("iconclick",{id:this.config.id,category:this.config.category,questionType:this.config.questionType})}showTooltip(){if(this.tooltip)return;this.tooltip=this.scene.add.container(0,-60);const e=this.scene.add.rectangle(0,0,200,40,0,.8),t=this.scene.add.text(0,0,this.config.tooltip,{fontSize:"16px",fill:"#ffffff"}).setOrigin(.5);this.tooltip.add([e,t]),this.add(this.tooltip),this.scene.tweens.add({targets:this.tooltip,alpha:{from:0,to:1},duration:200})}hideTooltip(){this.tooltip&&this.scene.tweens.add({targets:this.tooltip,alpha:0,duration:200,onComplete:()=>{this.tooltip.destroy(),this.tooltip=null}})}setAnswered(e){this.isAnswered=!0,this.isCorrect=e,this.isInteractive=!1;const t=e?65280:16711680;this.border.setStrokeStyle(2,t),e?this.showCorrectAnimation():this.showIncorrectAnimation()}showCorrectAnimation(){const e=this.scene.add.particles(this.x,this.y,"particle",{speed:{min:-100,max:100},angle:{min:0,max:360},scale:{start:1,end:0},blendMode:"ADD",lifespan:1e3,gravityY:0,quantity:20,tint:65280});this.scene.time.delayedCall(1e3,()=>{e.destroy()})}showIncorrectAnimation(){this.scene.tweens.add({targets:[this.sprite,this.box],alpha:.5,duration:100,yoyo:!0,repeat:3})}reset(){this.isAnswered=!1,this.isCorrect=!1,this.isInteractive=!0,this.border.setStrokeStyle(2,65280),this.setAlpha(1),this.setScale(1),this.tooltip&&this.hideTooltip()}destroy(){this.tooltip&&this.tooltip.destroy(),super.destroy()}}class de extends l.GameObjects.Rectangle{constructor(e,t=800,s=l.Math.Between(0,100)){super(e,t,s,98,32,16777215),e.add.existing(this);const i=1/l.Math.Between(1,3);this.setScale(i),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:800,to:-100},duration:2e3/this.scale,onComplete:()=>{this.destroy()}})}}class fe extends l.GameObjects.Rectangle{constructor(e,t=800,s=l.Math.Between(32,368)){super(e,t,s,32,32,16711680),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1);const i=1/l.Math.Between(1,3);this.setScale(i),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:820,to:-100},duration:2e3,onComplete:()=>{this.destroy()}}),this.body.setVelocityX(-200)}handleCollision(e,t){this.scene.gameOver()}}class ue extends l.GameObjects.Sprite{constructor(e,t=800,s=l.Math.Between(32,368)){super(e,t,s,"coin"),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1);const i=1/l.Math.Between(1,3);this.setScale(i),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:820,to:-100},duration:2e3,onComplete:()=>{this.destroy()}}),this.scene.anims.create({key:"coin_anim",frames:this.scene.anims.generateFrameNumbers("coin",{start:0,end:7}),frameRate:8,repeat:-1}),this.play({key:"coin_anim",repeat:-1})}collectCoin(e,t){this.scene.score+=50,this.scene.updateScore(),this.scene.playSound("coinCollect"),e.destroy()}}class me extends l.GameObjects.Rectangle{constructor(e,t=800,s=l.Math.Between(100,500)){super(e,t,s,32,32,65280),e.add.existing(this),e.physics.add.existing(this),this.body.setAllowGravity(!1),this.setInteractive(),this.init()}init(){this.scene.tweens.add({targets:this,x:{from:1024,to:-100},duration:2e3,onComplete:()=>{this.destroy()}}),this.setInteractive(),this.on("pointerdown",()=>{console.log("Button Clicked"),this.scene.togglePause()})}}class A{constructor(){this.progress={score:0,powerUpBitmask:0,currentMap:1,lastCompletedScene:null,powerUpStats:{life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2}},this.loadProgress()}loadProgress(){try{const e=localStorage.getItem("gameProgress");if(e){const t=JSON.parse(e);this.progress={...this.progress,...t}}return this.progress}catch(e){return console.error("Error loading progress:",e),this.progress}}saveProgress(e={}){try{return this.progress={...this.progress,...e},this.updatePowerUpStats(),localStorage.setItem("gameProgress",JSON.stringify(this.progress)),!0}catch(t){return console.error("Error saving progress:",t),!1}}updatePowerUpStats(){this.progress.powerUpStats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.progress.powerUpBitmask&1&&(this.progress.powerUpStats.life+=2),this.progress.powerUpBitmask&2&&(this.progress.powerUpStats.craftSize=1.2),this.progress.powerUpBitmask&4&&(this.progress.powerUpStats.speed+=100),this.progress.powerUpBitmask&8&&(this.progress.powerUpStats.bulletSpeed+=200,this.progress.powerUpStats.fireRate+=2)}getPowerUpStats(){return this.progress.powerUpStats}updateScore(e){return this.progress.score+=e,this.saveProgress(),this.progress.score}setCurrentMap(e){this.progress.currentMap=e,this.saveProgress()}getCurrentMap(){return this.progress.currentMap}setLastCompletedScene(e){this.progress.lastCompletedScene=e,this.saveProgress()}getLastCompletedScene(){return this.progress.lastCompletedScene}addPowerUp(e){this.progress.powerUpBitmask|=e,this.updatePowerUpStats(),this.saveProgress()}hasPowerUp(e){return(this.progress.powerUpBitmask&e)!==0}resetProgress(){this.progress={score:0,powerUpBitmask:0,currentMap:1,lastCompletedScene:null,powerUpStats:{life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2}},this.saveProgress()}getProgress(){return{...this.progress}}}const W=new A;class te extends l.Scene{constructor(){super({key:"bootscene"}),this.nextScene=null,this.nextSceneData=null}init(e){this.nextScene=e.nextScene||"mainmenu",this.nextSceneData=e.nextSceneData||{}}preload(){const e=this.cameras.main.width,t=this.cameras.main.height,s=this.add.graphics(),i=this.add.graphics();i.fillStyle(2236962,.8),i.fillRect(e/4,t/2-30,e/2,50);const r=this.add.text(e/2,t/2-50,"Loading...",{font:"20px monospace",fill:"#ffffff"}).setOrigin(.5,.5),o=this.add.text(e/2,t/2+70,"0%",{font:"18px monospace",fill:"#ffffff"}).setOrigin(.5,.5);this.load.on("progress",n=>{s.clear(),s.fillStyle(65280,1),s.fillRect(e/4+10,t/2-20,(e/2-20)*n,30),o.setText(parseInt(n*100)+"%")}),this.load.on("complete",()=>{s.destroy(),i.destroy(),r.destroy(),o.destroy()}),this.load.on("loaderror",n=>{console.warn("Error loading file:",n.key,n.src),this.handleAssetError(n)}),this.loadEssentialAssets()}handleAssetError(e){switch(e.type){case"image":this.createFallbackImage(e.key);break;case"audio":this.createSilentAudio(e.key);break;case"json":this.createFallbackJSON(e.key);break}}createFallbackImage(e){const t=this.add.graphics();if(e.includes("correct_icon"))t.fillStyle(65280),t.fillCircle(0,0,20);else if(e.includes("wrong_icon"))t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10);else if(e.includes("aws_")){t.fillStyle(16750848),t.fillRect(0,0,48,48),t.lineStyle(2,2305854),t.strokeRect(0,0,48,48);const s=this.add.text(24,24,"AWS",{font:"12px Arial",fill:"#232F3E"}).setOrigin(.5);t.generateTexture(e,48,48),s.destroy()}else t.fillStyle(6710886),t.fillRect(0,0,64,64),t.lineStyle(2,16777215),t.strokeRect(0,0,64,64);t.generateTexture(e,64,64),t.destroy()}createSilentAudio(e){const t=this.game.sound.context;if(t){const s=t.createBuffer(2,44100,44100);this.cache.audio.add(e,s),console.log(`Created silent audio fallback for: ${e}`)}}createFallbackJSON(e){e==="questions"&&this.cache.json.add(e,{questions:[{question:"Placeholder question",correct_answer:"Correct",incorrect_answers:["Wrong 1","Wrong 2","Wrong 3"]}]})}loadEssentialAssets(){try{["background","logo","correct_icon","wrong_icon"].forEach(s=>{this.load.image(s,c(`images/${s}.png`))}),["Buzzer","click","correct","wrong","fail","satellite_destroy","laser","theme","dead","jump"].forEach(s=>{this.load.audio(s,c(`sounds/${s}.mp3`))}),this.load.json("questions",c("data/questions.json")),this.load.bitmapFont("arcade",c("fonts/arcade.png"),c("fonts/arcade.xml"))}catch(e){console.error("Error in loadEssentialAssets:",e)}}create(){if(this.add.rectangle(400,300,800,600,0),this.load.isReady())this.add.text(400,300,"Loading Complete!",{font:"32px monospace",fill:"#ffffff"}).setOrigin(.5,.5),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start(this.nextScene||"mainmenu",this.nextSceneData)})});else{const e=this.add.text(400,300,"Still Loading...",{font:"32px monospace",fill:"#ffffff"}).setOrigin(.5,.5);this.load.once("complete",()=>{e.setText("Loading Complete!"),this.time.delayedCall(1e3,()=>{this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start(this.nextScene||"mainmenu",this.nextSceneData)})})})}}}class se extends l.Scene{constructor(){super({key:"gameover"})}init(e){this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1}create(){this.add.rectangle(400,300,800,600,0,.9),this.add.text(400,150,"GAME OVER",{fontSize:"64px",fill:"#ff0000",fontStyle:"bold"}).setOrigin(.5),this.add.text(400,250,`Final Score: ${this.score}`,{fontSize:"32px",fill:"#ffffff"}).setOrigin(.5);const e=[];this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Size+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),this.add.text(400,300,`Power-ups: ${e.join(" ")}`,{fontSize:"24px",fill:"#00ff00"}).setOrigin(.5);const t=this.add.container(400,400),s=this.add.rectangle(0,0,200,50,65280).setInteractive(),i=this.add.text(0,0,"Try Again",{fontSize:"24px",fill:"#000000"}).setOrigin(.5),r=this.add.rectangle(0,70,200,50,6710886).setInteractive(),o=this.add.text(0,70,"Main Menu",{fontSize:"24px",fill:"#ffffff"}).setOrigin(.5);s.on("pointerover",()=>{s.setFillStyle(52224),i.setScale(1.1)}),s.on("pointerout",()=>{s.setFillStyle(65280),i.setScale(1)}),r.on("pointerover",()=>{r.setFillStyle(8947848),o.setScale(1.1)}),r.on("pointerout",()=>{r.setFillStyle(6710886),o.setScale(1)}),s.on("pointerdown",()=>{this.sound.play("button_click"),this.retryGame()}),r.on("pointerdown",()=>{this.sound.play("button_click"),this.returnToMenu()}),t.add([s,i,r,o]);const n=this.getHighScore();this.score>n?(this.setHighScore(this.score),this.add.text(400,500,"New High Score!",{fontSize:"32px",fill:"#ffff00"}).setOrigin(.5)):n>0&&this.add.text(400,500,`High Score: ${n}`,{fontSize:"24px",fill:"#ffffff"}).setOrigin(.5)}retryGame(){W.resetProgress(),this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start("sort_selection",{score:0,powerUpBitmask:0,currentMap:1})})}returnToMenu(){W.resetProgress(),this.cameras.main.fadeOut(500),this.time.delayedCall(500,()=>{this.scene.start("mainmenu")})}getHighScore(){try{const e=localStorage.getItem("highScore");return e?parseInt(e):0}catch(e){return console.error("Error getting high score:",e),0}}setHighScore(e){try{localStorage.setItem("highScore",e.toString())}catch(t){console.error("Error setting high score:",t)}}}const k={IDLE:"idle",TRANSITIONING:"transitioning",FADING:"fading",ERROR:"error"};class N{constructor(){this.state=k.IDLE,this.currentScene=null,this.nextScene=null,this.transitionData=null,this.progressManager=new A,this.transitionHistory=[]}setCurrentScene(e){this.currentScene=e,this.state=k.IDLE}getState(){return this.state}getTransitionHistory(){return this.transitionHistory}fadeIn(e,t=500){if(!e||!e.cameras){console.error("Invalid scene for fadeIn");return}this.state=k.FADING,e.cameras.main.fadeIn(t),e.cameras.main.once("camerafadeincomplete",()=>{this.state=k.IDLE})}fadeOut(e,t,s=500){if(!e||!e.cameras){console.error("Invalid scene for fadeOut");return}this.state=k.FADING,e.cameras.main.fadeOut(s),e.cameras.main.once("camerafadeoutcomplete",()=>{t&&t(),this.state=k.TRANSITIONING})}getNextTransition(e,t){const s=["map1scene1","space_invaders","map1scene2","space_invaders","map1scene3","space_invaders","map1scene4","space_invaders","map2scene1","space_invaders","map2scene2","space_invaders","map2scene3","space_invaders","map2scene4","space_invaders","map3scene1","space_invaders","map3scene2","space_invaders","map3scene3","space_invaders","map3scene4","space_invaders","map4scene1","space_invaders","map4scene2","space_invaders","map4scene3","space_invaders","map4scene4","space_invaders","game_over"];if(e==="bootscene")return"mainmenu";if(e==="mainmenu")return t==="sort_selection"?"sort_selection":t==="space_invaders"?"space_invaders":"map1scene1";if(e==="sort_selection"||e==="game_over")return"mainmenu";const i=s.indexOf(e);return i!==-1&&i<s.length-1?s[i+1]:(console.error("Invalid scene transition:",{fromScene:e,toScene:t}),"mainmenu")}to(e,t,s={}){if(this.state===k.TRANSITIONING){console.warn("Scene transition already in progress");return}if(!e||!e.scene||!t){console.error("Invalid scene parameters"),this.state=k.ERROR;return}if(this.state=k.TRANSITIONING,this.nextScene=t,this.transitionData=s,t.match(/map\d+scene\d+/)){const r=t.match(/map(\d+)scene(\d+)/);if(r){const[o,n,h]=r;this.fadeOut(e,()=>{e.scene.start("trivia_master",{...s,mapNumber:parseInt(n),sceneNumber:parseInt(h),fromScene:e.scene.key}),this.setCurrentScene("trivia_master")});return}}if(!this.getNextTransition(e.scene.key,t)){console.error(`Invalid transition from ${e.scene.key} to ${t}`),this.state=k.ERROR;return}this.progressManager.saveProgress({lastCompletedScene:e.scene.key,score:s.score||0,powerUpBitmask:s.powerUpBitmask||0,currentMap:s.currentMap||1}),this.transitionHistory.push({from:e.scene.key,to:t,timestamp:Date.now(),data:{...s}}),e.events.emit("sceneCleanup"),e.events.emit("sceneEnd"),this.fadeOut(e,()=>{e.scene.start(t,{...s,fromScene:e.scene.key}),this.setCurrentScene(t)})}toSpaceInvaders(e,t,s={}){if(this.state===k.TRANSITIONING){console.warn("Scene transition already in progress");return}const i=this.progressManager.loadProgress(),r={score:s.score||i.score||0,powerUpBitmask:s.powerUpBitmask||i.powerUpBitmask||0,nextScene:t,fromScene:e.scene.key,currentMap:s.currentMap||i.currentMap||1};e.events.emit("scenePause"),this.to(e,"space_invaders",r)}fromSpaceInvaders(e,t={}){const s=t.nextScene;if(!s){console.error("No next scene specified for space invaders transition"),this.state=k.ERROR;return}const i={score:t.score||0,powerUpBitmask:t.powerUpBitmask||0,currentMap:t.currentMap||1,fromScene:"space_invaders"};s==="gameover"?this.toGameOver(e,i):this.to(e,s,i)}toMainMenu(e,t={}){e.events.emit("sceneCleanup"),this.to(e,"mainmenu",t)}toGameOver(e,t={}){const s=this.progressManager.loadProgress(),i={score:t.score||s.score||0,powerUpBitmask:t.powerUpBitmask||s.powerUpBitmask||0,currentMap:t.currentMap||s.currentMap||1,fromScene:e.scene.key};e.events.emit("sceneCleanup"),this.to(e,"gameover",i)}reset(){this.state=k.IDLE,this.nextScene=null,this.transitionData=null}}class ie extends l.Scene{constructor(){super({key:"mainmenu"}),this.menuButtons=[],this.isTransitioning=!1,console.log("MainMenu: Constructor called")}init(e){var t,s;console.log("MainMenu: Init called"),this.progressManager=((t=window.gameManager)==null?void 0:t.progressManager)||new A,this.sceneTransition=((s=window.gameManager)==null?void 0:s.sceneTransition)||new N(this.scene),this.menuButtons=[],this.isTransitioning=!1}preload(){console.log("MainMenu: Preload started"),this.load.image("logo",c("images/logo.png")),this.load.image("background",c("images/background.png"))}create(){console.log("MainMenu: Create started"),this.add.image(400,300,"background").setDisplaySize(800,600),this.add.image(400,150,"logo").setScale(.5),this.createButtons(),console.log("MainMenu: Create completed")}createButtons(){var t;[{text:"New Game",y:277,callback:()=>this.startNewGame()},{text:"Continue",y:347,callback:()=>this.continueGame()},{text:"Sort Selection",y:417,callback:()=>this.startSortSelection()},{text:"Space Invaders",y:487,callback:()=>this.startSpaceInvaders()}].forEach(({text:s,y:i,callback:r})=>{const o=this.add.rectangle(400,i,200,40,3355443).setInteractive({useHandCursor:!0});o.on("pointerover",()=>{o.setFillStyle(6710886)}),o.on("pointerout",()=>{o.setFillStyle(3355443)}),o.on("pointerdown",r),this.add.text(400,i,s,{fontSize:"24px",fill:"#fff",backgroundColor:null}).setOrigin(.5),this.menuButtons.push(o)}),(t=this.progressManager.loadProgress())!=null&&t.lastCompletedScene||this.menuButtons[1].setAlpha(.5).disableInteractive()}startNewGame(){this.isTransitioning||(this.isTransitioning=!0,console.log("Starting new game..."),this.scene.start("trivia_master",{mapNumber:1,sceneNumber:1,isNewGame:!0,score:0,powerUpBitmask:0,currentMap:1}))}continueGame(){if(this.isTransitioning)return;this.isTransitioning=!0,console.log("Continuing game...");const e=this.progressManager.loadProgress();if(e!=null&&e.lastCompletedScene){const t=e.lastCompletedScene.match(/map(\d+)scene(\d+)/);if(t){const[s,i,r]=t;console.log("Continuing from:",{mapNumber:i,sceneNumber:r,savedData:e}),this.scene.start("trivia_master",{mapNumber:parseInt(i),sceneNumber:parseInt(r),score:e.score,powerUpBitmask:e.powerUpBitmask,currentMap:e.currentMap})}else console.warn("Invalid save format, starting new game"),this.startNewGame()}else console.warn("No save data found, starting new game"),this.startNewGame()}startSortSelection(){this.isTransitioning||(this.isTransitioning=!0,this.sceneTransition.to(this,"sort_selection",{fromMainMenu:!0}))}startSpaceInvaders(){this.isTransitioning||(this.isTransitioning=!0,this.sceneTransition.to(this,"space_invaders",{fromMainMenu:!0}))}shutdown(){this.isTransitioning=!1,this.menuButtons.forEach(e=>e.destroy()),this.menuButtons=[]}}class F{constructor(){this.progressManager=new A,this.POWERUP_TYPES={LIFE:1,SHIELD:2,SPEED:4,FIRE:8,BULLET_SPEED:16,CRAFT_SIZE:32,POWER_UP_COLLECT:64,BONUS_POINTS:128},this.BASE_STATS={health:3,shield:0,speed:200,fireRate:2,bulletSpeed:400,craftSize:1,powerUpCollectRadius:50,pointsMultiplier:1},this.powerUpBitmask=this.loadPowerUps(),this.tempPowerUps={fireRate:0,speed:0,shield:0,bulletSpeed:0},this.sceneCorrectAnswers=0}loadPowerUps(){const e=localStorage.getItem("powerUpState");return e?parseInt(e,10):0}savePowerUps(){localStorage.setItem("powerUpState",this.powerUpBitmask.toString()),this.progressManager.saveProgress({powerUpBitmask:this.powerUpBitmask})}applyUpgrade(e){return this.powerUpBitmask|=e,this.savePowerUps(),this.getUpgradedStats()}removeUpgrade(e){return this.powerUpBitmask&=~e,this.savePowerUps(),this.getUpgradedStats()}hasUpgrade(e){return(this.powerUpBitmask&e)!==0}getFireRate(){const e=this.BASE_STATS.fireRate,t=this.hasUpgrade(this.POWERUP_TYPES.FIRE)?e*.5:0,s=this.tempPowerUps.fireRate*.2*e;return e+t+s}handleCorrectAnswer(){return this.sceneCorrectAnswers++,this.sceneCorrectAnswers>=5?(this.sceneCorrectAnswers=0,this.applyRandomPermanentUpgrade()):null}applyRandomPermanentUpgrade(){const e=Object.values(this.POWERUP_TYPES).filter(t=>!this.hasUpgrade(t));if(e.length>0){const t=e[Math.floor(Math.random()*e.length)];return this.applyUpgrade(t),t}return null}getUpgradedStats(){const e={...this.BASE_STATS};return this.hasUpgrade(this.POWERUP_TYPES.LIFE)&&(e.health+=2),this.hasUpgrade(this.POWERUP_TYPES.SHIELD)&&(e.shield+=1),this.hasUpgrade(this.POWERUP_TYPES.SPEED)&&(e.speed*=1.25),this.hasUpgrade(this.POWERUP_TYPES.FIRE)&&(e.fireRate=this.getFireRate()),this.hasUpgrade(this.POWERUP_TYPES.BULLET_SPEED)&&(e.bulletSpeed*=1.5),this.hasUpgrade(this.POWERUP_TYPES.CRAFT_SIZE)&&(e.craftSize*=.8),this.hasUpgrade(this.POWERUP_TYPES.POWER_UP_COLLECT)&&(e.powerUpCollectRadius*=1.5),this.hasUpgrade(this.POWERUP_TYPES.BONUS_POINTS)&&(e.pointsMultiplier*=1.5),e.fireRate+=this.tempPowerUps.fireRate*.2*this.BASE_STATS.fireRate,e.speed+=this.tempPowerUps.speed*50,e.shield+=this.tempPowerUps.shield,e.bulletSpeed+=this.tempPowerUps.bulletSpeed*100,e}getPowerUpText(){const e=[];return Object.entries(this.POWERUP_TYPES).forEach(([t,s])=>{this.hasUpgrade(s)&&e.push(`${t}+`)}),e.join(" ")}reset(){return this.powerUpBitmask=0,this.savePowerUps(),this.getUpgradedStats()}resetSceneProgress(){this.sceneCorrectAnswers=0,this.tempPowerUps={fireRate:0,speed:0,shield:0,bulletSpeed:0}}addTemporaryPowerUp(e,t){return this.tempPowerUps.hasOwnProperty(e)?(this.tempPowerUps[e]++,!0):!1}removeTemporaryPowerUp(e){return this.tempPowerUps.hasOwnProperty(e)&&this.tempPowerUps[e]>0?(this.tempPowerUps[e]--,!0):!1}}class re extends l.Scene{constructor(){super({key:"space_invaders"}),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.powerUpBitmask=0,this.progressManager=null,this.sceneTransition=null,this.bullets=[],this.asteroids=[],this.satellites=[],this.powerUps=[],this.starSprites=[],this.stars=[],this.nextScene=null,this.fromScene=null,this.isPractice=!1,this.baseHealth=3,this.health=3,this.isGameOver=!1,this.tempBonuses={shield:0,speed:0,fireRate:0},this.powerUpManager=new F;const e=200,t=2,s=400;this.upgrades={health:3,shield:this.powerUpBitmask&2?1:0,speed:e+(this.powerUpBitmask&4?e*.25:0),fireRate:t+(this.powerUpBitmask&8?t*.5:0),bulletSpeed:s+(this.powerUpBitmask&8?s*.25:0),craftSize:this.powerUpBitmask&2?.8:1};for(let i=0;i<100;i++)this.stars.push({x:l.Math.Between(0,800),y:l.Math.Between(0,600),speed:l.Math.Between(50,150),char:[".","*","+","·","°"][l.Math.Between(0,4)]})}init(e){this.progressManager=window.progressManager,this.sceneTransition=window.sceneTransition,this.powerUpManager=new F;const t=this.powerUpManager.getUpgradedStats();this.score=(e==null?void 0:e.score)||0,this.baseHealth=t.health,this.health=this.baseHealth,this.upgrades=t,this.nextScene=(e==null?void 0:e.nextScene)||"mainmenu",this.fromScene=e==null?void 0:e.fromScene,this.fromMainMenu=this.fromScene==="mainmenu",this.powerUpManager.resetSceneProgress(),this.resetGame(),this.cameras.main.fadeIn(500)}resetGame(){this.player={x:this.width/2,y:this.height-80,width:60,height:40,lives:this.upgrades.health,shield:this.upgrades.shield,score:0,speed:300,fireRate:this.upgrades.fireRate,bulletSpeed:this.upgrades.bulletSpeed,multiShot:this.upgrades.multiShot},this.bullets=[],this.asteroids=[],this.satellites=[],this.powerUps=[],this.score=0,this.scoreText=null,this.powerUpText=null,this.isGameOver=!1,this.powerUpTypes={LIFE:1,CRAFT:2,SPEED:4,BULLETS:8},this.powerUpStats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.sceneTransition=new N}preload(){this.load.audio("shoot",c("sounds/laser.mp3")),this.load.audio("explosion",c("sounds/dead.mp3")),this.load.audio("powerup",c("sounds/jump.mp3")),this.load.audio("satellite_destroy",c("sounds/satellite_destroy.mp3")),this.load.audio("buzzer",c("sounds/boowomp.mp3"))}create(){this.gameStarted=!1,this.stars.forEach(t=>{const s=this.add.text(t.x,t.y,t.char,{fontFamily:"Courier",fontSize:t.char==="*"?"16px":"12px",fill:"#ffffff"}).setAlpha(.5);s.speed=t.speed,this.starSprites.push(s)});const e=["^","/|\\","<=+=>","\\|/"];this.player=this.add.container(400,500),e.forEach((t,s)=>{const i=this.add.text(0,s*14,t,{fontFamily:"Courier",fontSize:"16px",fill:"#ffffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.player.add(i)}),this.updateShieldVisuals(),this.player.setScale(this.upgrades.craftSize),this.cursors=this.input.keyboard.createCursorKeys(),this.wasdKeys={left:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.A),right:this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.D)},this.spaceKey=this.input.keyboard.addKey(l.Input.Keyboard.KeyCodes.SPACE),this.lastShot=0,this.createHUD(),this.time.delayedCall(500,()=>{this.gameStarted=!0,this.startGameLoop()}),this.cameras.main.fadeIn(500)}createHUD(){this.add.rectangle(400,40,780,60,0,.5).setDepth(100),this.scoreText=this.add.text(16,16,`Score: ${this.score}`,{fontSize:"32px",fill:"#fff",fontFamily:"Courier"}).setDepth(101),this.powerUpText=this.add.text(16,56,`Power-ups: ${this.getPowerUpText()}`,{fontSize:"24px",fill:"#00ff00",fontFamily:"Courier"}).setDepth(101),this.healthText=this.add.text(16,96,`Health: ${this.health}`,{fontSize:"24px",fill:"#ff0000",fontFamily:"Courier"}).setDepth(101),this.upgrades.shield>0&&(this.shieldText=this.add.text(200,96,`Shield: ${this.upgrades.shield}`,{fontSize:"24px",fill:"#0000ff",fontFamily:"Courier"}).setDepth(101))}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Shield+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),e.join(" ")}startGameLoop(){let e=3e3;const t=this.progressManager?this.progressManager.loadProgress():null,s=t&&t.currentMap||1;this.asteroidTimer=this.time.addEvent({delay:e,callback:()=>{this.isGameOver||(this.spawnAsteroid(),e=Math.max(e*.95,800),this.asteroidTimer.delay=e)},loop:!0}),this.powerUpTimer=this.time.addEvent({delay:1e4,callback:()=>{this.isGameOver||this.spawnPowerUp()},loop:!0});const i=Math.max(15e3-s*1e3,8e3);this.satelliteTimer=this.time.addEvent({delay:i,callback:()=>{this.isGameOver||this.spawnSatellite()},loop:!0})}spawnPowerUp(){const e=[{type:"temp_shield",char:"S",color:"#00ffff",duration:15e3},{type:"temp_speed",char:">",color:"#00ff00",duration:1e4},{type:"temp_fire",char:"!",color:"#ffff00",duration:12e3}],t=e[l.Math.Between(0,e.length-1)],s=this.add.text(l.Math.Between(40,760),-20,t.char,{fontFamily:"Courier",fontSize:"24px",fill:t.color}).setOrigin(.5);this.powerUps.push({sprite:s,type:t.type,duration:t.duration,speed:100})}shoot(){const e=this.time.now,t=1e3/this.powerUpManager.getFireRate();if(e-this.lastShot>=t){this.lastShot=e;const s=this.powerUpManager.getUpgradedStats(),i=this.powerUpManager.BASE_STATS.fireRate,r=Math.min(5,Math.max(1,Math.floor((s.fireRate-i)/2)+1));let o;switch(r){case 1:o=[{char:"↑",offset:0}];break;case 2:o=[{char:"↑",offset:-8},{char:"↑",offset:8}];break;case 3:o=[{char:"↗",offset:-16},{char:"↑",offset:0},{char:"↖",offset:16}];break;case 4:o=[{char:"↖",offset:-24},{char:"↑",offset:-8},{char:"↑",offset:8},{char:"↗",offset:24}];break;case 5:o=[{char:"↖",offset:-32},{char:"↖",offset:-16},{char:"↑",offset:0},{char:"↗",offset:16},{char:"↗",offset:32}];break}o.forEach(n=>{const h=this.add.text(this.player.x+n.offset,this.player.y-20,n.char,{fontFamily:"Arial",fontSize:"24px",fill:"#ffffff",stroke:"#00ff00",strokeThickness:2}).setOrigin(.5);h.setBlendMode(l.BlendModes.ADD),h.preFX.addGlow(65280,4),h.setData("speed",-this.upgrades.bulletSpeed),this.bullets.push(h)}),this.sound.play("shoot",{volume:.5})}}update(e,t){if(!this.gameStarted||this.isGameOver)return;this.starSprites.forEach(i=>{i.y+=i.speed*t/1e3,i.y>600&&(i.y=-10,i.x=l.Math.Between(0,800))});const s=this.getPlayerStats();if(this.bullets&&this.bullets.length&&this.updateBullets(t),this.asteroids&&this.asteroids.length&&this.updateAsteroids(t),this.satellites&&this.satellites.length&&this.updateSatellites(t),this.powerUps&&this.powerUps.length&&this.updatePowerUps(t),this.player){const i=s.speed*(t/1e3);(this.cursors.left.isDown||this.wasdKeys.left.isDown)&&(this.player.x=Math.max(30,this.player.x-i)),(this.cursors.right.isDown||this.wasdKeys.right.isDown)&&(this.player.x=Math.min(770,this.player.x+i)),this.spaceKey.isDown&&e>this.lastShot+1e3/s.fireRate&&(this.shoot(),this.lastShot=e)}this.checkCollisions()}applyPowerUps(){this.powerUpStats={life:3,craftSize:1,speed:200,bulletSpeed:400,fireRate:2},this.powerUpBitmask&this.powerUpTypes.LIFE&&(this.powerUpStats.life+=2),this.powerUpBitmask&this.powerUpTypes.CRAFT&&(this.powerUpStats.craftSize=1.2),this.powerUpBitmask&this.powerUpTypes.SPEED&&(this.powerUpStats.speed+=100),this.powerUpBitmask&this.powerUpTypes.BULLETS&&(this.powerUpStats.bulletSpeed+=200,this.powerUpStats.fireRate+=2),this.updatePowerUpText()}updatePowerUpText(){const e=[];this.powerUpBitmask&this.powerUpTypes.LIFE&&e.push("Life+"),this.powerUpBitmask&this.powerUpTypes.CRAFT&&e.push("Size+"),this.powerUpBitmask&this.powerUpTypes.SPEED&&e.push("Speed+"),this.powerUpBitmask&this.powerUpTypes.BULLETS&&e.push("Fire+"),this.powerUpText&&this.powerUpText.setText("Power-ups: "+e.join(" "))}updateBullets(e){for(let t=this.bullets.length-1;t>=0;t--){const s=this.bullets[t];s.y+=s.getData("speed")*e/1e3,s.y<-10&&(s.destroy(),this.bullets.splice(t,1))}}spawnAsteroid(){const e=[[" /==\\ ","|====|"," \\==/ "],["  /\\  ","<====>","  \\/  "],[" /##\\ ","{####}"," \\##/ "],[" /-\\ ","{***}"," \\-/ "]],t=e[l.Math.Between(0,e.length-1)],s=this.add.container(l.Math.Between(40,760),-40);t.forEach((i,r)=>{const o=this.add.text(0,r*16,i,{fontFamily:"Courier",fontSize:"24px",fill:"#cccccc",stroke:"#666666",strokeThickness:1}).setOrigin(.5);s.add(o)}),this.asteroids.push({sprite:s,speed:l.Math.Between(100,200),rotationSpeed:l.Math.Between(-2,2),type:"asteroid"})}updateAsteroids(e){for(let t=this.asteroids.length-1;t>=0;t--){const s=this.asteroids[t];s.sprite.y+=s.speed*e/1e3,s.sprite.rotation+=s.rotationSpeed*e/1e3,s.sprite.y>620&&(s.sprite.destroy(),this.asteroids.splice(t,1))}}spawnSatellite(){const e=[{pattern:"sine",char:"[-o-]",color:"#ff0000"},{pattern:"zigzag",char:"{=o=}",color:"#ff3300"},{pattern:"chase",char:"<-o->",color:"#ff6600"}],t=e[l.Math.Between(0,e.length-1)],s=this.add.text(l.Math.Between(40,760),-20,t.char,{fontFamily:"Courier",fontSize:"20px",fill:t.color,stroke:"#000000",strokeThickness:1}).setOrigin(.5);this.satellites.push({sprite:s,speed:l.Math.Between(150,250),horizontalSpeed:l.Math.Between(-100,100),pattern:t.pattern,type:"satellite",timeOffset:Date.now()})}updateSatellites(e){for(let t=this.satellites.length-1;t>=0;t--){const s=this.satellites[t];switch(s.sprite.y+=s.speed*e/1e3,s.pattern){case"sine":s.sprite.x=s.sprite.x+Math.sin((Date.now()-s.timeOffset)*.003)*(e/1e3)*100;break;case"zigzag":s.direction||(s.direction=1),s.sprite.x+=s.direction*(150*e/1e3),(s.sprite.x<40||s.sprite.x>760)&&(s.direction*=-1);break;case"chase":if(this.player){const o=this.player.x-s.sprite.x;s.sprite.x+=Math.sign(o)*(100*e/1e3)}break}s.sprite.x=l.Math.Clamp(s.sprite.x,40,760),s.sprite.y>620&&(s.sprite.destroy(),this.satellites.splice(t,1))}}updatePowerUps(e){for(let t=this.powerUps.length-1;t>=0;t--){const s=this.powerUps[t];s.sprite.y+=s.speed*(e/1e3),s.sprite.y>this.height+50&&(s.sprite.destroy(),this.powerUps.splice(t,1))}}collectPowerUp(e){switch(this.score+=25,this.scoreText.setText(`Score: ${this.score}`),e.type){case"temp_shield":this.powerUpManager.addTemporaryPowerUp("shield",e.duration),this.updateShieldVisuals(),this.time.delayedCall(e.duration,()=>{this.powerUpManager.removeTemporaryPowerUp("shield"),this.updateShieldVisuals()});break;case"temp_speed":this.powerUpManager.addTemporaryPowerUp("speed",e.duration),this.time.delayedCall(e.duration,()=>{this.powerUpManager.removeTemporaryPowerUp("speed")});break;case"temp_fire":this.powerUpManager.addTemporaryPowerUp("fireRate",e.duration),this.time.delayedCall(e.duration,()=>{this.powerUpManager.removeTemporaryPowerUp("fireRate")});break}this.sound.play("powerup",{volume:.5}),e.sprite.destroy();const t=this.add.text(e.sprite.x,e.sprite.y,"+25",{fontFamily:"Courier",fontSize:"24px",fill:"#00ff00",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:t,y:t.y-50,alpha:0,duration:1e3,onComplete:()=>t.destroy()})}updateBonusText(){const e=[];this.tempBonuses.shield>0&&e.push(`Shield(${this.tempBonuses.shield})`),this.tempBonuses.speed>0&&e.push(`Speed(${this.tempBonuses.speed}×)`),this.tempBonuses.fireRate>0&&e.push(`Fire(${this.tempBonuses.fireRate}×)`),this.powerUpText&&this.powerUpText.setText("Active Bonuses: "+(e.length?e.join(" "):"None"))}getPlayerStats(){return this.powerUpManager.getUpgradedStats()}checkCollisions(){this.bullets=this.bullets.filter(e=>e&&!e.destroyed),this.asteroids=this.asteroids.filter(e=>e&&e.sprite&&!e.sprite.destroyed),this.satellites=this.satellites.filter(e=>e&&e.sprite&&!e.sprite.destroyed);for(let e=this.bullets.length-1;e>=0;e--){const t=this.bullets[e];if(!(!t||t.destroyed)){for(let s=this.asteroids.length-1;s>=0;s--){const i=this.asteroids[s];if(!(!i||!i.sprite||i.sprite.destroyed)&&this.checkOverlap(t,i.sprite)){this.handleCollision(t,i,10);break}}if(!t.destroyed)for(let s=this.satellites.length-1;s>=0;s--){const i=this.satellites[s];if(!(!i||!i.sprite||i.sprite.destroyed)&&this.checkOverlap(t,i.sprite)){this.handleCollision(t,i,20);break}}}}if(this.player&&!this.player.destroyed){for(let e=this.asteroids.length-1;e>=0;e--){const t=this.asteroids[e];!t||!t.sprite||t.sprite.destroyed||this.checkOverlap(this.player,t.sprite)&&(t.sprite.destroy(),this.asteroids.splice(e,1),this.handlePlayerHit())}for(let e=this.satellites.length-1;e>=0;e--){const t=this.satellites[e];!t||!t.sprite||t.sprite.destroyed||this.checkOverlap(this.player,t.sprite)&&(t.sprite.destroy(),this.satellites.splice(e,1),this.handlePlayerHit())}for(let e=this.powerUps.length-1;e>=0;e--){const t=this.powerUps[e];!t||!t.sprite||t.sprite.destroyed||this.checkOverlap(this.player,t.sprite)&&(this.collectPowerUp(t),this.powerUps.splice(e,1))}}}handlePlayerHit(){if(this.getPlayerStats().shield>0){const s=this.player.list.filter(o=>o.shieldLayer);if(s.length-1>=0&&s.slice(-4).forEach(n=>{this.tweens.add({targets:n,alpha:0,scaleX:1.5,scaleY:1.5,duration:300,onComplete:()=>n.destroy()})}),this.tempBonuses.shield>0?this.tempBonuses.shield--:this.upgrades.shield>0&&this.upgrades.shield--,this.shieldText){const o=this.tempBonuses.shield+(this.upgrades.shield||0);o>0?this.shieldText.setText(`Shield: ${o}`):(this.shieldText.destroy(),this.shieldText=null)}this.updateBonusText(),this.showShieldEffect(),this.sound.play("satellite_destroy",{volume:.3});const r=this.add.text(this.player.x,this.player.y-40,"SHIELD BREAK!",{fontFamily:"Courier",fontSize:"24px",fill:"#00ffff",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:r,y:r.y-50,alpha:0,duration:1e3,onComplete:()=>r.destroy()})}else{if(this.health--,this.healthText.setText(`Health: ${this.health}`),this.health<=0){this.isGameOver=!0,this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("mainmenu",{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})});return}this.showDamageEffect(),this.sound.play("explosion",{volume:.4})}}showDamageEffect(){this.player&&this.player.list&&this.player.list.forEach(e=>{e.setFillStyle&&(e.setFillStyle("#ff0000"),this.time.delayedCall(100,()=>{e.setFillStyle("#ffffff")}))})}showShieldEffect(){this.player&&this.player.list&&this.player.list.forEach(e=>{e.setFillStyle&&(e.setFillStyle("#00ffff"),this.time.delayedCall(100,()=>{e.setFillStyle("#ffffff")}))})}checkOverlap(e,t){if(!e||!t)return!1;let s,i;return e.list&&e.list.length>0,s=e.getBounds(),t.list&&t.list.length>0,i=t.getBounds(),!s||!i?!1:l.Geom.Rectangle.Overlaps(s,i)}showGameOver(){if(this.isGameOver||!this.gameStarted)return;this.isGameOver=!0,this.clearGameEntities();const e=this.add.rectangle(0,0,this.game.config.width,this.game.config.height,0,0);e.setOrigin(0).setDepth(1e3),this.tweens.add({targets:e,alpha:.7,duration:500,ease:"Power2",onComplete:()=>{if(this.sceneTransition)if(this.fromMainMenu)this.sceneTransition.toMainMenu(this,{score:this.score,powerUpBitmask:this.powerUpManager.powerUpBitmask,currentMap:this.currentMap});else if(this.nextScene)this.sceneTransition.to(this,this.nextScene,{score:this.score,powerUpBitmask:this.powerUpManager.powerUpBitmask,currentMap:this.currentMap,fromSpaceInvaders:!0});else{const t=this.sceneTransition.getNextTransition(this.scene.key,"space_invaders");this.sceneTransition.to(this,t||"mainmenu",{score:this.score,powerUpBitmask:this.powerUpManager.powerUpBitmask,currentMap:this.currentMap,fromSpaceInvaders:!0})}else this.transitionToScene(this.nextScene||"mainmenu")}})}clearGameEntities(){var e,t,s,i;(e=this.asteroids)==null||e.forEach(r=>{var o;return(o=r.sprite)==null?void 0:o.destroy()}),(t=this.satellites)==null||t.forEach(r=>{var o;return(o=r.sprite)==null?void 0:o.destroy()}),(s=this.bullets)==null||s.forEach(r=>r.destroy()),(i=this.powerUps)==null||i.forEach(r=>{var o;return(o=r.sprite)==null?void 0:o.destroy()}),this.asteroids=[],this.satellites=[],this.bullets=[],this.powerUps=[]}updateShieldVisuals(){this.player.list.forEach(s=>{s.shieldLayer&&s.destroy()});const t=this.getPlayerStats().shield;for(let s=0;s<t;s++){const i=(s+1)*4,r=s<this.upgrades.shield?"#4444ff":"#44ffff",o=this.add.text(0,-2-i,`/${" ".repeat(2+s)}\\`,{fontFamily:"Courier",fontSize:"16px",fill:r,stroke:"#000000",strokeThickness:1}).setOrigin(.5);o.shieldLayer=!0,this.player.add(o);const n=this.add.text(0,44+i,`\\${" ".repeat(2+s)}/`,{fontFamily:"Courier",fontSize:"16px",fill:r,stroke:"#000000",strokeThickness:1}).setOrigin(.5);n.shieldLayer=!0,this.player.add(n);const h=20+s*4,g=this.add.text(-h,20,")",{fontFamily:"Courier",fontSize:"16px",fill:r,stroke:"#000000",strokeThickness:1}).setOrigin(.5);g.shieldLayer=!0,this.player.add(g);const y=this.add.text(h,20,"(",{fontFamily:"Courier",fontSize:"16px",fill:r,stroke:"#000000",strokeThickness:1}).setOrigin(.5);y.shieldLayer=!0,this.player.add(y)}}handleCollision(e,t,s){if(e.destroy(),t.sprite.destroy(),t.type==="satellite"){if(this.score=Math.max(0,this.score-50),this.scoreText.setText(`Score: ${this.score}`),this.health--,this.healthText.setText(`Health: ${this.health}`),this.health<=0){this.isGameOver=!0,this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("mainmenu",{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})});return}this.showDamageEffect(),this.sound.play("satellite_destroy",{volume:.5});const o=this.add.text(t.sprite.x,t.sprite.y,"-50 BAD! -1 HP",{fontFamily:"Courier",fontSize:"24px",fill:"#ff0000",stroke:"#000000",strokeThickness:2}).setOrigin(.5);this.tweens.add({targets:o,y:o.y-50,alpha:0,duration:1e3,onComplete:()=>o.destroy()})}else{const o=["\\   /"," \\*/ ","* * *"," /*\\ ","/   \\"],n=this.add.container(t.sprite.x,t.sprite.y);n.setDepth(100),o.forEach((g,y)=>{const a=this.add.text(0,(y-2)*16,g,{fontFamily:"Courier",fontSize:"24px",fill:"#ffff00",stroke:"#ff4400",strokeThickness:2}).setOrigin(.5);n.add(a),this.tweens.add({targets:a,scaleX:1.5,scaleY:1.5,duration:150,yoyo:!0,ease:"Quad.easeOut"})});const h=["*",".","+","·","°"];for(let g=0;g<8;g++){const y=g/8*Math.PI*2,a=h[Math.floor(Math.random()*h.length)],p=this.add.text(0,0,a,{fontFamily:"Courier",fontSize:"20px",fill:"#ff8800"}).setOrigin(.5);n.add(p),this.tweens.add({targets:p,x:Math.cos(y)*50,y:Math.sin(y)*50,alpha:0,duration:500,ease:"Power2"})}this.tweens.add({targets:n,alpha:0,duration:400,delay:100,onComplete:()=>n.destroy()}),this.sound.play("explosion",{volume:.3})}const i=this.bullets.indexOf(e);i>-1&&this.bullets.splice(i,1);const r=t.type==="asteroid"?this.asteroids.indexOf(t):this.satellites.indexOf(t);if(r>-1&&(t.type==="asteroid"?this.asteroids.splice(r,1):this.satellites.splice(r,1)),this.score+=s*this.powerUpManager.getUpgradedStats().pointsMultiplier,this.scoreText.setText(`Score: ${this.score}`),t.type==="asteroid"&&Math.random()<.1){const o=this.powerUpManager.applyRandomPermanentUpgrade();o&&this.showUpgradeNotification(o)}}showUpgradeNotification(e){const t={[this.powerUpManager.POWERUP_TYPES.LIFE]:"LIFE UPGRADE!",[this.powerUpManager.POWERUP_TYPES.SHIELD]:"SHIELD UPGRADE!",[this.powerUpManager.POWERUP_TYPES.SPEED]:"SPEED UPGRADE!",[this.powerUpManager.POWERUP_TYPES.FIRE]:"FIRE RATE UPGRADE!"},s=this.add.text(400,300,t[e],{fontSize:"32px",fill:"#00ff00",stroke:"#000000",strokeThickness:4}).setOrigin(.5).setDepth(1e3);this.tweens.add({targets:s,y:200,alpha:0,duration:2e3,ease:"Power2",onComplete:()=>s.destroy()})}transitionToNextScene(){var r;if(this.isTransitioning)return;this.isTransitioning=!0;const e=(r=this.nextScene)==null?void 0:r.match(/map(\d+)scene(\d+)/);if(!e){console.error("Invalid next scene format:",this.nextScene);return}const[t,s,i]=e;this.scene.start("trivia_master",{mapNumber:parseInt(s),sceneNumber:parseInt(i),score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}}class oe extends l.Scene{constructor(){super({key:"sort_selection"}),this.score=0,this.currentMap=1,this.selected=null,this.thumbnails=[],this.connections=[],this.sortSpeed=500,this.isTransitioning=!1,this.sortData={thumbnails:[],sortedScenes:[],selected:null},this.gameState={score:0},this.timingInfo={startTime:0,endTime:0,totalTime:0,animationStartTime:0,animationEndTime:0},this.sceneManager=null}init(e){var t,s,i;this.score=(e==null?void 0:e.score)||this.registry.get("score")||0,this.currentMap=(e==null?void 0:e.currentMap)||this.registry.get("currentMap")||1,this.progress=(e==null?void 0:e.progress)||this.registry.get("progress")||0,this.powerUpBitmask=e.powerUpBitmask||0,this.fromScene=e.fromScene,this.registry.set("score",this.score),this.registry.set("currentMap",this.currentMap),this.registry.set("progress",this.progress),(t=this.gameManager)!=null&&t.sceneTransition&&(this.sceneTransition=this.gameManager.sceneTransition),(s=this.gameManager)!=null&&s.progressManager&&(this.progressManager=this.gameManager.progressManager),this.isTransitioning=!1,this.isAnimating=!1,this.registry.events.on("changedata",this.handleRegistryChange,this),(i=window.gameManager)!=null&&i.sceneManager&&(this.sceneManager=window.gameManager.sceneManager)}handleRegistryChange(e,t,s){switch(t){case"score":this.score=s;break;case"currentMap":this.currentMap=s;break;case"progress":this.progress=s;break}}preload(){this.load.image("map1scene164",c("images/map1scene164.png")),this.load.image("map1scene264",c("images/map1scene264.png")),this.load.image("map1scene364",c("images/map1scene364.png")),this.load.image("map1scene464",c("images/map1scene464.png")),this.load.image("map2scene164",c("images/map2scene164.png")),this.load.image("map2scene264",c("images/map2scene264.png")),this.load.image("map2scene364",c("images/map2scene364.png")),this.load.image("map2scene464",c("images/map2scene464.png")),this.load.image("map3scene164",c("images/map3scene164.png")),this.load.image("map3scene264",c("images/map3scene264.png")),this.load.image("map3scene364",c("images/map3scene364.png")),this.load.image("map3scene464",c("images/map3scene464.png")),this.load.image("map4scene364",c("images/map4scene364.png")),this.load.image("map4scene464",c("images/map4scene464.png")),this.load.json("map-config",c("data/map1/map-config.json")),this.load.json("questions",c("data/questions.json")),this.load.bitmapFont("arcade",c("fonts/arcade.png"),c("fonts/arcade.xml")),this.load.json("map-config4",c("data/map1/map-config64.json")),this.load.image("background",c("images/backgrounds/space-background.png")),console.log("Loading sound effects..."),this.load.audio("fail",c("sounds/cartoon_fail.mp3")).on("filecomplete",()=>console.log("Fail sound loaded successfully")).on("loaderror",e=>console.error("Failed to load fail sound:",e)),this.load.audio("buzzer",c("sounds/buzzer.mp3")).on("filecomplete",()=>console.log("Buzzer sound loaded successfully")).on("loaderror",e=>console.error("Failed to load buzzer sound:",e)),this.load.on("complete",()=>{console.log("All assets loaded. Sound cache status:",{fail:this.cache.audio.exists("fail"),buzzer:this.cache.audio.exists("buzzer")})})}createSilentSound(e){if(this.game.sound.context){const t=this.game.sound.context.createBuffer(1,44100,44100);this.cache.audio.add(e,t)}}playSound(e){console.log(`Attempting to play sound: ${e}`);try{this.sound.locked?(console.log("Audio system is locked. Waiting for user interaction..."),this.sound.once("unlocked",()=>{this.playSound(e)})):(this.sound.stopAll(),this.sound.add(e,{volume:.5}).play(),console.log(`Playing sound: ${e}`))}catch(t){console.error(`Error playing sound ${e}:`,t)}}create(){this.add.image(400,300,"background").setAlpha(.3);const t=this.add.graphics();t.fillGradientStyle(0,0,1122884,1122884,.7),t.fillRect(0,0,800,600),this.add.text(20,20,"Score: "+this.score,{fontSize:"24px",fill:"#fff"}),this.statsText=this.add.text(20,150,"",{fontSize:"16px",fill:"#fff",fontFamily:"monospace"});const s=600,i=5;this.add.text(s,i,"Color Key:",{fontSize:"18px",fill:"#fff"}),[{color:16711680,label:"Pivot/Current"},{color:255,label:"Comparing"},{color:65280,label:"Sorted/Default"}].forEach((S,T)=>{const U=i+30+T*25;this.add.rectangle(s,U,20,20,S.color),this.add.text(s+15,U,S.label,{fontSize:"14px",fill:"#fff"}).setOrigin(0,.5)}),this.add.text(400,50,"Sort Selection",{fontSize:"32px",fill:"#fff"}).setOrigin(.5),this.container=this.add.container(425,250);const o=["map1scene164","map1scene264","map1scene364","map1scene464","map2scene164","map2scene264","map2scene364","map2scene464","map3scene164","map3scene264","map3scene364","map3scene464","map4scene364","map4scene464"],n=7,h=64,g=64,y=20,a=20,p=-568/2,d=-148/2;this.initialPositions=[],o.forEach((S,T)=>{const U=Math.floor(T/n),I=T%n,B=p+I*(h+y),C=d+U*(g+a);this.initialPositions[T]={x:B,y:C};const w=this.add.image(B,C,S).setScale(.8).setInteractive();w.on("pointerover",()=>{this.tweens.add({targets:w,scale:1,duration:200})}),w.on("pointerout",()=>{this.tweens.add({targets:w,scale:.8,duration:200})}),this.thumbnails.push(w),this.container.add(w)});const m=[{text:"Bubble Sort",method:"bubble",color:4886754,complexity:"O(n²)",description:"Compares adjacent elements and swaps them if they are in the wrong order."},{text:"Quick Sort",method:"quick",color:5301186,complexity:"O(n log n)",description:"Uses a pivot element to partition the array into smaller sub-arrays."},{text:"Merge Sort",method:"merge",color:14897263,complexity:"O(n log n)",description:"Divides array into smaller arrays, sorts them, and merges them back."},{text:"Insertion Sort",method:"insertion",color:14917968,complexity:"O(n²)",description:"Builds sorted array one item at a time by comparing with previous elements."},{text:"Selection Sort",method:"selection",color:10181046,complexity:"O(n²)",description:"Finds minimum element and places it at the beginning."},{text:"Heap Sort",method:"heap",color:1752220,complexity:"O(n log n)",description:"Uses a binary heap data structure to sort elements."}],x=(S,T,U)=>{const I=this.add.container(S,T-70),B=this.add.rectangle(0,0,320,80,0,.7).setStrokeStyle(1,16777215,.3),C=this.add.text(0,0,`Time Complexity: ${U.complexity}
${U.description}`,{fontSize:"14px",fill:"#ffffff",align:"center",padding:{x:10,y:5},wordWrap:{width:300}}).setOrigin(.5);return I.add([B,C]),I.setDepth(100),I},u=525,b=this.add.container(400,u-110),M=180,L=40,Y=40,j=20,G=3,K=-620/2;m.forEach((S,T)=>{const U=Math.floor(T/G),I=T%G,B=K+I*(M+Y)+M/2,C=U*(L+j),w=this.add.container(B,C),v=this.add.rectangle(0,0,M,L,S.color,.8).setStrokeStyle(2,16777215).setInteractive({useHandCursor:!0});v.name=`${S.method}-sort-button`;const Q=this.add.text(0,0,S.text,{fontSize:"18px",fill:"#ffffff",fontFamily:"Arial"}).setOrigin(.5);w.add([v,Q]),b.add(w),v.on("pointerover",()=>{v.setFillStyle(S.color,1),this.tweens.add({targets:w,scaleX:1.05,scaleY:1.05,duration:100}),w.tooltip=x(w.x+b.x,w.y+b.y,S)}),v.on("pointerout",()=>{v.setFillStyle(S.color,.8),this.tweens.add({targets:w,scaleX:1,scaleY:1,duration:100}),w.tooltip&&(w.tooltip.destroy(),w.tooltip=null)}),v.on("pointerdown",()=>{v.setFillStyle(S.color,.6),this.selectSort(S.method)}),v.on("pointerup",()=>{v.setFillStyle(S.color,1)})});const _=400,R=u+20;this.add.rectangle(400,u+20,600,60,0,.5).setStrokeStyle(1,16777215,.3);const O=this.add.container(180,u+20),P=this.add.rectangle(0,0,100,40,0,.6).setInteractive({useHandCursor:!0}).setStrokeStyle(2,65280,.8),q=this.add.text(0,0,"Back",{fontSize:"18px",fill:"#fff"}).setOrigin(.5),E=this.add.text(0,-30,"Please wait for sorting to finish",{fontSize:"14px",fill:"#ff0000",backgroundColor:"#000000",padding:{x:5,y:2}}).setOrigin(.5).setVisible(!1);O.add([P,q,E]),P.on("pointerover",()=>{if(this.isAnimating){E.setVisible(!0);return}P.setFillStyle(4473924),this.tweens.add({targets:O,scaleX:1.05,scaleY:1.05,duration:100})}),P.on("pointerout",()=>{E.setVisible(!1),!this.isAnimating&&(P.setFillStyle(3355443),this.tweens.add({targets:O,scaleX:1,scaleY:1,duration:100}))}),P.on("pointerdown",()=>{if(this.isAnimating){this.tweens.add({targets:E,alpha:0,duration:200,yoyo:!0,repeat:1});return}P.setFillStyle(2236962),this.backToMenu()}),O.setDepth(50),this.add.text(_-165,R,"Speed:",{fontSize:"18px",fill:"#fff"}).setOrigin(0,.5);const $=this.add.rectangle(_,R,200,10,6710886).setInteractive({useHandCursor:!0}),D=this.add.circle(_,R,10,16777215).setInteractive({useHandCursor:!0}).setDepth(1);let z=!1;const X=200,H=S=>{const T=$.getBounds();D.x=l.Math.Clamp(S,T.left,T.right);const U=(D.x-T.left)/T.width;this.sortSpeed=Math.max(X,1e3-U*700)};D.on("pointerdown",()=>{z=!0}),this.input.on("pointermove",S=>{z&&H(S.x)}),this.input.on("pointerup",()=>{z=!1}),$.on("pointerdown",S=>{H(S.x)}),this.cleanupAnimations=()=>{this.tweens.killAll(),this.thumbnails&&this.thumbnails.forEach(S=>{S.clearTint(),S.setScale(.8)})},this.shuffleThumbnails()}selectSort(e){if(this.isAnimating)return;this.isAnimating=!0,this.selected=e,this.statsText&&this.statsText.destroy(),this.statsText=this.add.text(20,60,"Sorting...",{fontSize:"16px",fill:"#fff",fontFamily:"monospace"}),this.sortStartTime=performance.now();const t=this.thumbnails,s=this.initializeElements(t),i=performance.now(),r=[...s];switch(this.timingInfo={startTime:i,endTime:null,totalTime:0,animationStartTime:null,animationEndTime:null},e){case"bubble":for(let a=0;a<r.length;a++)for(let p=0;p<r.length-a-1;p++)r[p].value>r[p+1].value&&([r[p],r[p+1]]=[r[p+1],r[p]]);break;case"quick":const n=(a,p,d)=>{if(p>=d)return;let m=a[d],x=p-1;for(let u=p;u<d;u++)a[u].value<=m.value&&(x++,[a[x],a[u]]=[a[u],a[x]]);[a[x+1],a[d]]=[a[d],a[x+1]],n(a,p,x),n(a,x+2,d)};n(r,0,r.length-1);break;case"insertion":for(let a=1;a<r.length;a++){let p=r[a],d=a-1;for(;d>=0&&r[d].value>p.value;)r[d+1]=r[d],d--;r[d+1]=p}break;case"selection":for(let a=0;a<r.length-1;a++){let p=a;for(let d=a+1;d<r.length;d++)r[d].value<r[p].value&&(p=d);p!==a&&([r[a],r[p]]=[r[p],r[a]])}break;case"heap":const h=(a,p,d)=>{let m=d;const x=2*d+1,u=2*d+2;x<p&&a[x].value>a[m].value&&(m=x),u<p&&a[u].value>a[m].value&&(m=u),m!==d&&([a[d],a[m]]=[a[m],a[d]],h(a,p,m))};for(let a=Math.floor(r.length/2)-1;a>=0;a--)h(r,r.length,a);for(let a=r.length-1;a>0;a--)[r[0],r[a]]=[r[a],r[0]],h(r,a,0);break;case"merge":const g=(a,p,d,m)=>{const x=[];let u=p,b=d+1,M=0;for(;u<=d&&b<=m;)a[u].value<=a[b].value?x[M++]=a[u++]:x[M++]=a[b++];for(;u<=d;)x[M++]=a[u++];for(;b<=m;)x[M++]=a[b++];for(u=0;u<M;u++)a[p+u]=x[u]},y=(a,p,d)=>{if(p<d){const m=Math.floor((p+d)/2);y(a,p,m),y(a,m+1,d),g(a,p,m,d)}};y(r,0,r.length-1);break}this.timingInfo.endTime=performance.now(),this.timingInfo.totalTime=this.timingInfo.endTime-this.timingInfo.startTime;const o=this.timingInfo.totalTime.toFixed(4);switch(console.log(`${e} Sort Time: ${o}ms`),this.statsText.setText(`Computing sort... ${o}ms`),this.timingInfo.animationStartTime=performance.now(),e){case"bubble":this.animateBubbleSort(s);break;case"quick":this.animateQuickSort(s,0,s.length-1);break;case"merge":this.animateMergeSort(s);break;case"insertion":this.animateInsertionSort(s);break;case"selection":this.animateSelectionSort(s);break;case"heap":this.animateHeapSort(s);break}}initializeElements(e){return e.map((t,s)=>({sprite:t,originalIndex:s,originalX:t.x,currentX:t.x,value:s}))}compareElements(e,t){return e.value!==t.value?e.value-t.value:e.originalIndex-t.originalIndex}async animateSwap(e,t,s){const i=this.initialPositions[t],r=this.initialPositions[s];return[e[t],e[s]]=[e[s],e[t]],e[t].currentX=i.x,e[s].currentX=r.x,new Promise(o=>{let n=0;const h=()=>{n++,n===2&&o()};this.tweens.add({targets:e[t].sprite,x:i.x,y:i.y,duration:this.sortSpeed,onComplete:h}),this.tweens.add({targets:e[s].sprite,x:r.x,y:r.y,duration:this.sortSpeed,onComplete:h})})}async animateBubbleSort(e){for(let t=0;t<e.length;t++){for(let s=0;s<e.length-t-1;s++)e[s].sprite.setTint(255),e[s+1].sprite.setTint(255),await new Promise(i=>this.time.delayedCall(this.sortSpeed/2,i)),e[s].value>e[s+1].value&&(e[s].sprite.setTint(16711680),e[s+1].sprite.setTint(16711680),await this.animateSwap(e,s,s+1)),e[s].sprite.clearTint(),e[s+1].sprite.clearTint();e[e.length-t-1].sprite.setTint(65280)}e[0].sprite.setTint(65280),this.finishSort(e.map(t=>t.sprite))}async animateQuickSort(e,t,s){if(t>=s){t===s&&e[t].sprite.setTint(65280);return}const i=e[s];i.sprite.setTint(16711680);let r=t-1;for(let o=t;o<s;o++)e[o].sprite.setTint(255),await new Promise(n=>this.time.delayedCall(this.sortSpeed/2,n)),e[o].value<=i.value&&(r++,r!==o&&await this.animateSwap(e,r,o),e[r].sprite.setTint(65280)),e[o].sprite.clearTint();r+1!==s&&await this.animateSwap(e,r+1,s),i.sprite.clearTint(),e[r+1].sprite.setTint(65280),await this.animateQuickSort(e,t,r),await this.animateQuickSort(e,r+2,s);for(let o=t;o<=s;o++)e[o].sprite.setTint(65280);t===0&&s===e.length-1&&this.finishSort(e.map(o=>o.sprite))}async animateInsertionSort(e){e[0].sprite.setTint(65280);for(let t=1;t<e.length;t++){const s=e[t];s.sprite.setTint(16711680);let i=t-1;for(await new Promise(r=>this.time.delayedCall(this.sortSpeed/2,r));i>=0&&e[i].value>s.value;)e[i].sprite.setTint(255),await this.animateSwap(e,i+1,i),e[i+1].sprite.setTint(65280),i--;e[i+1].sprite.setTint(65280)}this.finishSort(e.map(t=>t.sprite))}async animateSelectionSort(e){for(let t=0;t<e.length-1;t++){let s=t;e[t].sprite.setTint(16711680);for(let i=t+1;i<e.length;i++)e[i].sprite.setTint(255),await new Promise(r=>this.time.delayedCall(this.sortSpeed/2,r)),e[i].value<e[s].value?(s!==t&&e[s].sprite.clearTint(),s=i,e[s].sprite.setTint(16711680)):e[i].sprite.clearTint();s!==t&&await this.animateSwap(e,t,s),e[t].sprite.setTint(65280)}e[e.length-1].sprite.setTint(65280),this.finishSort(e.map(t=>t.sprite))}async animateHeapSort(e){const t=async(s,i)=>{let r=i;const o=2*i+1,n=2*i+2;e[i].sprite.setTint(16711680),o<s&&e[o].sprite.setTint(255),n<s&&e[n].sprite.setTint(255),await new Promise(h=>this.time.delayedCall(this.sortSpeed/2,h)),o<s&&e[o].value>e[r].value&&(r=o),n<s&&e[n].value>e[r].value&&(r=n),r!==i&&(await this.animateSwap(e,i,r),await t(s,r)),e[i].sprite.clearTint(),o<s&&e[o].sprite.clearTint(),n<s&&e[n].sprite.clearTint()};for(let s=Math.floor(e.length/2)-1;s>=0;s--)await t(e.length,s);for(let s=e.length-1;s>0;s--)await this.animateSwap(e,0,s),e[s].sprite.setTint(65280),await t(s,0);e[0].sprite.setTint(65280),this.finishSort(e.map(s=>s.sprite))}async animateMergeSort(e){if(e.length<=1)return e.length===1&&e[0].sprite.setTint(65280),e;const t=Math.floor(e.length/2),s=e.slice(0,t),i=e.slice(t);s.forEach(h=>h.sprite.setTint(255)),i.forEach(h=>h.sprite.setTint(16711680)),await new Promise(h=>this.time.delayedCall(this.sortSpeed/2,h)),s.forEach(h=>h.sprite.clearTint()),i.forEach(h=>h.sprite.clearTint()),await this.animateMergeSort(s),await this.animateMergeSort(i);let r=0,o=0,n=0;for(;r<s.length&&o<i.length;)s[r].sprite.setTint(255),i[o].sprite.setTint(16711680),await new Promise(h=>this.time.delayedCall(this.sortSpeed/2,h)),s[r].value<=i[o].value?(n!==r&&await this.animateSwap(e,n,r),e[n].sprite.setTint(65280),r++):(n!==o+t&&await this.animateSwap(e,n,o+t),e[n].sprite.setTint(65280),o++),n++;for(;r<s.length;)n!==r&&await this.animateSwap(e,n,r),e[n].sprite.setTint(65280),r++,n++;for(;o<i.length;)n!==o+t&&await this.animateSwap(e,n,o+t),e[n].sprite.setTint(65280),o++,n++;return e.length===this.thumbnails.length&&this.finishSort(e.map(h=>h.sprite)),e}finishSort(e){this.timingInfo.animationEndTime=performance.now();const t=(this.timingInfo.animationEndTime-this.timingInfo.animationStartTime).toFixed(4),s=(this.timingInfo.animationEndTime-this.timingInfo.startTime).toFixed(4);this.timingInfo.totalTime>5e3?this.playSound("fail"):this.timingInfo.totalTime>3e3&&this.playSound("buzzer"),this.statsText.setText(`Sort complete!
Compute time: ${this.computeTime}ms
Animation time: ${t}ms
Total time: ${s}ms`),this.fromScene&&this.time.delayedCall(2e3,()=>{this.sceneManager?this.sceneManager.returnToPreviousScene({score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap}):this.scene.start(this.fromScene,{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})})}shuffleThumbnails(){if(this.isAnimating)return;this.thumbnails.forEach(t=>{t.clearTint(),t.setScale(.8)});const e=Array.from({length:this.thumbnails.length},(t,s)=>s);for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}e.forEach((t,s)=>{const i=this.initialPositions[t];this.tweens.add({targets:this.thumbnails[s],x:i.x,y:i.y,duration:500,ease:"Power2"})}),this.statsText&&this.statsText.setText("Select a sorting algorithm to begin!"),this.selected=null}startGame(){if(!this.selected||this.isTransitioning||this.isAnimating)return;this.cleanupAnimations&&this.cleanupAnimations(),this.isTransitioning=!0;const e=this.sortData.sortedScenes||[];this.registry.set("dynamicScenes",e),this.registry.set("currentSceneIndex",0),this.registry.set("score",this.score),this.registry.set("currentMap",this.currentMap);const t={score:this.score,currentMap:this.currentMap,fromSort:!0,sortedScenes:e,isDynamicScene:!0,sceneIndex:0};this.events.emit("gameStart",t),this.sceneTransition?this.sceneTransition.to(this,"DynamicGameScene",t):(this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("DynamicGameScene",t)}))}backToMenu(){if(this.isTransitioning||this.isAnimating)return;this.cleanupAnimations&&this.cleanupAnimations(),this.isTransitioning=!0;const e={score:this.score,currentMap:this.currentMap,fromSort:!1};this.registry.set("score",this.score),this.registry.set("currentMap",this.currentMap),this.events.emit("backToMenu",e),this.sceneTransition?this.sceneTransition.to(this,"mainmenu",e):(this.cameras.main.fadeOut(500),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start("mainmenu",e)}))}shutdown(){this.cleanupAnimations&&this.cleanupAnimations(),this.isTransitioning=!1,this.isAnimating=!1,this.thumbnails&&(this.thumbnails.forEach(e=>{e.destroy()}),this.thumbnails=[]),this.tweens.killAll(),this.registry.events.off("changedata",this.handleRegistryChange,this),this.events.emit("shutdown")}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{this.questions.find(r=>s.questionTypes.some(o=>r.question.toLowerCase().includes(o.toLowerCase())));const i=`images/services16/${s.category}/48/${s.name}`;console.log("Loading AWS icon:",i),this.load.image(`icon_${s.name}`,c(i))})}),this.load.once("complete",()=>{e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5);this.setupIconInteraction(i,s),this.icons.push(i)})})}),this.load.start()}startScene(e,t={}){this.isTransitioning||(this.isTransitioning=!0,window.gameState.lastScene=this.scene.key,this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start(e,{...t,fromScene:this.scene.key,score:this.score,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask})}))}returnToPreviousScene(e={}){this.isTransitioning||!this.fromScene||(this.isTransitioning=!0,window.gameState.lastScene=this.scene.key,this.cameras.main.fadeOut(500,0,0,0),this.cameras.main.once("camerafadeoutcomplete",()=>{this.scene.start(this.fromScene,{...e,score:this.score,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask})}))}launchScene(e,t={}){this.isTransitioning||(this.isTransitioning=!0,window.gameState.lastScene=this.scene.key,this.scene.launch(e,{...t,fromScene:this.scene.key,score:this.score,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask}),this.scene.bringToTop(e),this.time.delayedCall(100,()=>{this.isTransitioning=!1}))}}class ne extends l.Scene{constructor(e){super(e),this.player=null,this.score=0,this.scoreText=null,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.isTransitioning=!1,this.clickCooldown=!1,this.powerUpBitmask=0,this.currentIconIndex=0,this.isMoving=!1,this.paths=[],this.navigationPoints=[],this.spriteConfig={key:"player-sprite",frameWidth:1019,frameHeight:235}}init(e){super.init(e),this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||1,this.answeredIcons=e.answeredIcons||[],this.currentIconIndex=e.currentIconIndex||0}preload(){this.loadCoreAssets(),this.load.atlas(this.spriteConfig.key,c("images/spritewalk_animation (1)/spritewalk_animation.png"),c("images/spritewalk_animation (1)/spritewalk_animation.json"))}create(){this.createAnimations(),this.setupScene(),this.createPaths(),this.createPlayer(),this.cursors=this.input.keyboard.createCursorKeys(),this.events.on("shutdown",this.onSceneShutdown,this),this.events.on("wake",this.onSceneWake,this),this.events.on("sleep",this.onSceneSleep,this)}createAnimations(){this.anims.create({key:"walk",frames:this.anims.generateFrameNames(this.spriteConfig.key,{prefix:"spritewalk_animation",start:0,end:7,suffix:".png"}),frameRate:8,repeat:-1})}createPaths(){this.navigationPoints=this.icons.map((e,t)=>({x:e.x,y:e.y,name:e.name,index:t,answered:this.answeredIcons.includes(e.name)})),this.paths=[];for(let e=0;e<this.navigationPoints.length-1;e++)this.paths.push({from:e,to:e+1});this.drawPaths()}drawPaths(){this.pathGraphics&&this.pathGraphics.destroy(),this.pathGraphics=this.add.graphics(),this.pathGraphics.lineStyle(4,16776960,.5),this.paths.forEach(e=>{const t=this.navigationPoints[e.from],s=this.navigationPoints[e.to];this.pathGraphics.beginPath(),this.pathGraphics.moveTo(t.x,t.y),this.pathGraphics.lineTo(s.x,s.y),this.pathGraphics.strokePath()})}createPlayer(){const e=this.navigationPoints[this.currentIconIndex];e&&(this.player=this.add.sprite(e.x,e.y,this.spriteConfig.key),this.player.setScale(.5),this.player.setDepth(100))}update(){if(!this.player||this.isMoving)return;this.navigationPoints[this.currentIconIndex];let e=this.currentIconIndex;if(this.cursors.right.isDown||this.cursors.down.isDown){const t=this.paths.find(s=>s.from===this.currentIconIndex);t&&(e=t.to)}else if(this.cursors.left.isDown||this.cursors.up.isDown){const t=this.paths.find(s=>s.to===this.currentIconIndex);t&&(e=t.from)}if(e!==this.currentIconIndex){const t=this.navigationPoints[e];this.moveToIcon(t,e)}if(l.Input.Keyboard.JustDown(this.cursors.space)){const t=this.icons[this.currentIconIndex];t&&!this.navigationPoints[this.currentIconIndex].answered&&this.handleIconClick(t)}}moveToIcon(e,t){this.isMoving||(this.isMoving=!0,e.x>this.player.x?(this.player.play("walk",!0),this.player.setFlipX(!1)):(this.player.play("walk",!0),this.player.setFlipX(!0)),this.tweens.add({targets:this.player,x:e.x,y:e.y,duration:500,ease:"Linear",onComplete:()=>{this.player.anims.stop(),this.isMoving=!1,this.currentIconIndex=t}}))}markIconAsAnswered(e){const t=this.navigationPoints.find(s=>s.name===e);t&&(t.answered=!0,this.answeredIcons.push(e),this.navigationPoints.every(s=>s.answered)&&this.events.emit("allIconsAnswered"))}initScene(e){}setupLoadErrorHandlers(){this.load.on("loaderror",e=>{console.error("Error loading file:",e.key),e.type==="image"?this.handleImageError(e):e.type==="audio"?this.handleAudioError(e):e.type==="json"&&this.handleConfigError(e)})}handleImageError(e){const t=this.add.graphics();e.key.includes("checkmark")?(t.fillStyle(65280),t.fillCircle(0,0,20),t.generateTexture(e.key,40,40)):e.key.includes("xmark")&&(t.lineStyle(4,16711680),t.moveTo(-10,-10),t.lineTo(10,10),t.moveTo(10,-10),t.lineTo(-10,10),t.generateTexture(e.key,40,40)),t.destroy()}handleAudioError(e){if(this.game.sound&&this.game.sound.context){const t=this.game.sound.context.createBuffer(2,44100,44100);this.cache.audio.add(e.key,t)}}handleConfigError(e){e.key.includes("map-config")&&(this.mapConfig={zones:[]})}loadCoreAssets(){this.load.json("map-config",c(`data/map${this.currentMap}/map-config.json`)),this.load.json("questions",c("data/questions.json")),this.load.image("checkmark",c("images/checkmark.png")),this.load.image("xmark",c("images/xmark.png"))}loadSceneAssets(){}onAssetsLoaded(){try{if(this.mapConfig=this.cache.json.get("map-config"),this.questions=this.cache.json.get("questions"),!this.mapConfig||!this.mapConfig.zones)throw new Error(`Invalid map config for map ${this.currentMap}`);this.icons=this.mapConfig.zones.map((e,t)=>({x:e.x,y:e.y,name:e.name,index:t,answered:this.answeredIcons.includes(e.name)})),this.isReady=!0,this.events.emit("scene-ready")}catch(e){console.error("Error loading assets:",e),this.handleLoadError(e)}}setupScene(){this.mapConfig&&this.setupMap(this.mapConfig)}getPowerUpText(){const e=[];return this.powerUpBitmask&1&&e.push("Life+"),this.powerUpBitmask&2&&e.push("Shield+"),this.powerUpBitmask&4&&e.push("Speed+"),this.powerUpBitmask&8&&e.push("Fire+"),e.join(" ")}onSceneCreate(){this.gameManager&&this.gameManager.setCurrentScene(this),console.log(`Scene ${this.scene.key} created`)}onSceneShutdown(){this.events.off("create",this.onSceneCreate,this),this.events.off("shutdown",this.onSceneShutdown,this),this.events.off("wake",this.onSceneWake,this),this.events.off("sleep",this.onSceneSleep,this),this.cleanup()}onSceneWake(){this.isTransitioning=!1,console.log(`Scene ${this.scene.key} resumed`)}onSceneSleep(){console.log(`Scene ${this.scene.key} paused`)}cleanup(){this.scoreText&&this.scoreText.destroy(),this.player&&this.player.destroy(),this.cleanupScene()}cleanupScene(){}handleLoadError(e){console.error("Scene load error:",e),this.add.text(400,300,"Error loading scene. Restarting...",{fontSize:"24px",fill:"#ff0000",backgroundColor:"#000000",padding:{x:20,y:10}}).setOrigin(.5),this.time.delayedCall(2e3,()=>{this.scene.restart()})}updateScore(e){this.score+=e,this.scoreText&&this.scoreText.setText(`Score: ${this.score}`)}saveProgress(){this.progressManager&&this.progressManager.saveProgress({lastCompletedScene:this.scene.key,score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap})}setupMap(e){throw new Error("setupMap must be implemented by child class")}getNextSceneKey(){const e=this.scene.key.toLowerCase(),t=e.match(/map(\d+)/),s=e.match(/scene(\d+)/);if(!t||!s)return console.error("Invalid scene key format:",e),"mainmenu";const i=parseInt(t[1]),r=parseInt(s[1]);return r<4?`map${i}scene${r+1}`:i<4?`map${i+1}scene1`:i===4&&r===4?"gameover":"mainmenu"}transitionToNextScene(){if(this.isTransitioning)return;this.isTransitioning=!0,this.saveProgress();const e=this.getNextSceneKey();this.sceneTransition.toSpaceInvaders(this,e,{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap,fromScene:this.scene.key})}showQuestion(e,t){const s=this.add.rectangle(400,300,800,600,0,.9).setDepth(100),i=this.add.container(400,300).setDepth(101),r=this.add.text(0,-150,e.question,{fontSize:"20px",fill:"#ffffff",align:"center",wordWrap:{width:650},lineSpacing:12}).setOrigin(.5).setDepth(101);i.add(r);const o=r.getBounds(),n=this.add.rectangle(0,o.centerY,o.width+60,o.height+40,3355443).setDepth(100);i.add(n),i.sendToBack(n);const h=[...e.incorrect_answers,e.correct_answer];this.shuffleArray(h);const g=n.y+n.height/2+50,y=80,a=h.map((p,d)=>{const m=this.add.text(0,g+d*y,p,{fontSize:"18px",fill:"#ffffff",align:"center",wordWrap:{width:650}}).setOrigin(.5).setDepth(101),x=m.getBounds(),u=this.add.rectangle(0,g+d*y,x.width+40,x.height+20,6710886).setInteractive().setDepth(100);return u.on("pointerover",()=>{u.setFillStyle(8947848),m.setStyle({fill:"#00ff00"})}),u.on("pointerout",()=>{u.setFillStyle(6710886),m.setStyle({fill:"#ffffff"})}),u.on("pointerdown",()=>{const b=p===e.correct_answer;this.handleAnswer(b,t,i,s,e)}),i.add([u,m]),{button:u,text:m}});this.currentQuestion={container:i,background:s,buttons:a}}handleAnswer(e,t,s,i,r){this.currentQuestion.buttons.forEach(({button:y})=>{y.disableInteractive()}),e?(this.updateScore(100),t.setTint(65280)):t.setTint(16711680);const o=this.add.rectangle(400,500,750,120,e?17408:4456448).setDepth(101),n=this.add.text(400,500,r.explanation,{fontSize:"18px",fill:e?"#00ff00":"#ff0000",align:"center",wordWrap:{width:700},lineSpacing:8}).setOrigin(.5).setDepth(102),h=n.getBounds();o.height=h.height+40,o.y=h.centerY;const g=this.add.image(t.x,t.y,e?"checkmark":"xmark").setScale(.5).setDepth(150);t.isAnswered=!0,t.disableInteractive(),this.answeredQuestions++,this.time.delayedCall(4e3,()=>{s.destroy(),i.destroy(),o.destroy(),n.destroy(),g.destroy(),this.answeredQuestions>=5&&this.transitionToNextScene()})}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}}class ae extends ne{constructor(){super({key:"trivia_master"}),console.log("TriviaMasterScene: Constructor called during scene registration (this is normal)"),this.score=0,this.currentMap=1,this.questions=null,this.icons=[],this.answeredQuestions=0,this.correctAnswers=0,this.isTransitioning=!1,this.powerUpBitmask=0,this.mapNumber=1,this.sceneNumber=1,this.requiredCorrectAnswers=5}init(e){console.log("TriviaMasterScene: Actually starting scene initialization now",e),this.progressManager=new A,this.sceneTransition=new N,this.powerUpManager=new F,this.mapNumber=e.mapNumber||1,this.sceneNumber=e.sceneNumber||1,this.sceneKey=`map${this.mapNumber}scene${this.sceneNumber}`,this.score=e.score||0,this.powerUpBitmask=e.powerUpBitmask||0,this.currentMap=e.currentMap||this.mapNumber,this.answeredQuestions=0,this.correctAnswers=0,this.powerUpManager.resetSceneProgress(),this.progressManager.saveProgress({lastCompletedScene:this.sceneKey,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.loadingText=this.add.text(400,300,"Loading Scene...",{fontSize:"32px",fill:"#fff"}).setOrigin(.5),console.log("TriviaMasterScene: Scene configuration:",{mapNumber:this.mapNumber,sceneNumber:this.sceneNumber,sceneKey:this.sceneKey})}preload(){console.log("TriviaMasterScene: Preload started with map:",this.mapNumber,"scene:",this.sceneNumber);const e=this.add.graphics();e.clear(),e.lineStyle(4,65280),e.beginPath(),e.moveTo(10,25),e.lineTo(20,35),e.lineTo(38,15),e.strokePath(),e.generateTexture("checkMark",48,48),e.clear(),e.lineStyle(4,16711680),e.beginPath(),e.moveTo(15,15),e.lineTo(33,33),e.moveTo(33,15),e.lineTo(15,33),e.strokePath(),e.generateTexture("xMark",48,48),e.destroy();const t=`images/map${this.mapNumber}scene${this.sceneNumber}.png`,s=`data/map${this.mapNumber}/map-config${this.sceneNumber}.json`,i="data/questions.json";console.log("Loading assets from paths:",{mapImage:t,mapConfig:s,questions:i}),this.load.image("mapImage",c(t)),this.load.json("map-config",c(s)),this.load.json("questions",c(i)),this.load.on("filecomplete-json-map-config",(r,o,n)=>{console.log("Map config loaded:",n),n.mapImage&&(console.log("Loading background from config:",n.mapImage),this.load.image("background",c(n.mapImage))),n.zones&&(n.zones.forEach(h=>{h.icons.forEach(g=>{const y=`images/services16/${g.category}/48/${g.name}`;console.log("Loading AWS icon:",y),this.load.image(`icon_${g.name}`,c(y))})}),this.load.start())}),this.load.on("loaderror",this.handleAssetLoadError.bind(this))}handleAssetLoadError(e){if(console.warn("Creating fallback for:",e.key),e.type==="image"){const t=this.add.graphics();t.fillStyle(6710886),t.fillRect(0,0,64,64),t.lineStyle(2,16777215),t.strokeRect(0,0,64,64);const s=this.add.text(32,32,e.key,{font:"10px Arial",fill:"#ffffff",align:"center"}).setOrigin(.5);t.generateTexture(e.key,64,64),t.destroy(),s.destroy(),console.log("Created fallback image for:",e.key)}else if(e.type==="json"){const t={zones:[{x:400,y:300,icons:[]}]};this.cache.json.add(e.key,t),console.log("Created fallback JSON for:",e.key)}else if(e.type==="audio"){const t=new(window.AudioContext||window.webkitAudioContext),s=t.createBuffer(2,44100,44100),i=t.createBufferSource();i.buffer=s,this.cache.audio.add(e.key,s),console.log("Created silent audio fallback for:",e.key)}}create(){console.log("TriviaMasterScene: Create started");try{this.add.rectangle(400,300,800,600,0,.8),this.add.image(400,300,"mapImage").setOrigin(.5),this.questions=this.cache.json.get("questions");const t=this.cache.json.get("map-config");if(!t||!t.zones)throw new Error("Invalid map config structure");this.setupUI(),this.loadAwsIcons(t)}catch(e){console.error("Error in create:",e),this.handleSceneError(e)}}setupUI(){this.scoreText=this.add.text(16,16,`Score: ${this.score}`,{fontSize:"28px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200),this.add.text(400,16,`Map ${this.mapNumber} - Scene ${this.sceneNumber}`,{fontSize:"18px",fill:"#fff",backgroundColor:"#000",padding:{x:10,y:5}}).setOrigin(.5,0).setDepth(200),this.powerUpText=this.add.text(16,56,this.powerUpManager.getPowerUpText(),{fontSize:"18px",fill:"#00ff00",backgroundColor:"#000",padding:{x:10,y:5}}).setScrollFactor(0).setDepth(200)}loadAwsIcons(e){e.zones.forEach(t=>{t.icons.forEach(s=>{const i=this.add.image(s.x,s.y,`icon_${s.name}`).setInteractive().setScale(.5),r=this.add.rectangle(s.x,s.y,48,48,65280,0);r.setStrokeStyle(2,65280),i.box=r,this.setupIconInteraction(i,s),this.icons.push(i)})})}setupIconInteraction(e,t){e.on("pointerover",()=>{e.isAnswered||(e.box.setStrokeStyle(2,16776960),e.setScale(.6),this.showTooltip(t.name,e.x,e.y))}),e.on("pointerout",()=>{e.isAnswered||(e.box.setStrokeStyle(2,65280),e.setScale(.5),this.hideTooltip())}),e.on("pointerdown",()=>{!e.isAnswered&&!this.isTransitioning&&this.handleIconClick(e,t)})}handleIconClick(e,t){const s=this.questions.find(i=>t.questionTypes.some(r=>i.question.toLowerCase().includes(r.toLowerCase())));s&&this.showQuestion(s,e)}showQuestion(e,t){const s=this.add.container(400,300);s.setDepth(100);const i=this.add.rectangle(0,0,800,600,0,.8);s.add(i);const r=this.add.text(0,-170,e.question,{fontSize:"22px",fontWeight:"bold",fill:"#fff",wordWrap:{width:650},align:"center"}).setOrigin(.5);s.add(r);let o=[],n="";if(e.options&&e.answer)o=Object.entries(e.options).map(([h,g])=>({letter:h,text:g,isCorrect:h===e.answer})),n=e.answer,console.log("AWS format question:",{answers:o,correctAnswer:n});else if(e.incorrect_answers&&e.correct_answer)o=[...e.incorrect_answers,e.correct_answer].map(h=>({text:h,isCorrect:h===e.correct_answer})),n=e.correct_answer,console.log("Standard format question:",{answers:o,correctAnswer:n});else{console.error("Invalid question format:",e),s.destroy();return}e.options||this.shuffleArray(o),o.forEach((h,g)=>{const y=g*80-50,a=this.add.rectangle(0,y,600,60,3355443).setInteractive({useHandCursor:!0}),p=h.letter?`${h.letter}. ${h.text}`:h.text,d=this.add.text(0,y,p,{fontSize:"18px",fontWeight:"bold",fill:"#fff",wordWrap:{width:550}}).setOrigin(.5);a.on("pointerover",()=>{a.setFillStyle(6710886),d.setFill("#00ff00")}),a.on("pointerout",()=>{a.setFillStyle(3355443),d.setFill("#fff")}),a.on("pointerdown",()=>{const m=h.isCorrect;console.log("Answer selected:",{text:p,isCorrect:m,format:e.options?"AWS":"Standard"}),this.handleAnswer(m,t,s,e)}),s.add([a,d])})}handleAnswer(e,t,s,i){if(this.answeredQuestions++,e?(this.correctAnswers++,this.score+=100,this.scoreText.setText(`Score: ${this.score}`),this.sound.play("correct")):this.sound.play("wrong"),t.isAnswered=!0,t.setTint(e?65280:16711680),t.disableInteractive(),i.explanation){const r=this.add.text(0,240,i.explanation,{fontSize:"18px",fill:"#fff",wordWrap:{width:650},align:"center"}).setOrigin(.5);s.add(r)}this.time.delayedCall(2e3,()=>{if(s.destroy(),this.answeredQuestions>=5){if(this.correctAnswers>=this.requiredCorrectAnswers){const r=this.powerUpManager.handleCorrectAnswer();r&&this.showUpgradeNotification(r)}this.time.delayedCall(1e3,()=>{this.transitionToNextScene()})}})}showUpgradeNotification(e){const t=this.add.text(400,300,`New Power-Up Unlocked!
${e}`,{fontSize:"32px",fill:"#00ff00",align:"center",backgroundColor:"#000",padding:{x:20,y:10}}).setOrigin(.5).setDepth(1e3);this.tweens.add({targets:t,alpha:{from:1,to:0},duration:2e3,ease:"Power2",onComplete:()=>t.destroy()})}transitionToNextScene(){this.isTransitioning||(this.isTransitioning=!0,this.progressManager.saveProgress({lastCompletedScene:this.sceneKey,currentMap:this.currentMap,powerUpBitmask:this.powerUpBitmask,score:this.score}),this.sceneTransition.to(this,"space_invaders",{score:this.score,powerUpBitmask:this.powerUpBitmask,currentMap:this.currentMap,nextScene:this.getNextSceneKey()}))}getNextSceneKey(){return this.sceneNumber===4?this.mapNumber===4?"gameover":`map${this.mapNumber+1}scene1`:`map${this.mapNumber}scene${this.sceneNumber+1}`}showTooltip(e,t,s){this.tooltip=this.add.text(t,s-60,e,{fontSize:"16px",fill:"#fff",backgroundColor:"#000",padding:{x:5,y:3}}).setOrigin(.5).setDepth(150)}hideTooltip(){this.tooltip&&this.tooltip.destroy()}handleSceneError(e){console.error("Scene error:",e),this.add.text(400,300,`Error loading scene. Restarting...
`+e.message,{fontSize:"24px",fill:"#fff",backgroundColor:"#ff0000",padding:{x:10,y:5}}).setOrigin(.5),console.error("Scene state at error:",{mapNumber:this.mapNumber,sceneNumber:this.sceneNumber,sceneKey:this.sceneKey,assetsLoaded:this.load.isReady()}),this.time.delayedCall(2e3,()=>{this.scene.restart()})}shuffleArray(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}}const he={type:l.AUTO,width:800,height:600,parent:"game-container",backgroundColor:"#000000",dom:{createContainer:!0},scale:{mode:l.Scale.FIT,autoCenter:l.Scale.CENTER_BOTH},physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},render:{pixelArt:!0,powerPreference:"high-performance",antialias:!0,antialiasGL:!0},scene:[te,ie,oe,re,ae,se]};window.addEventListener("load",()=>{window.game=new l.Game(he),window.gameState={score:0,currentMap:1,powerUpBitmask:0,lastScene:null},window.progressManager=new A,document.addEventListener("click",function f(){window.game.sound&&window.game.sound.context.state==="suspended"&&window.game.sound.context.resume(),document.removeEventListener("click",f)}),window.addEventListener("blur",()=>{const f=window.game.scene.getScenes(!0)[0];f&&!f.scene.isTransitioning&&f.scene.pause()}),window.addEventListener("focus",()=>{const f=window.game.scene.getScenes(!0)[0];f&&!f.scene.isTransitioning&&f.scene.resume()}),window.addEventListener("beforeunload",()=>{const f=window.game.scene.getScenes(!0)[0];f&&window.progressManager.saveProgress({lastCompletedScene:f.scene.key,score:window.gameState.score,currentMap:window.gameState.currentMap,powerUpBitmask:window.gameState.powerUpBitmask})})});
